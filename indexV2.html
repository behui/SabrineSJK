<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Sabrine SJK - Th√©rapeute √ânerg√©tique. Reiki Usui, Lahochi, Magn√©tisme, Soins Intuitifs.">
    <meta name="theme-color" content="#8B7355">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Sabrine SJK - Th√©rapeute √ânerg√©tique</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    
    <!-- jsPDF pour la g√©n√©ration de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Bandeau Promo -->
    <div class="promo-banner">
        üéÅ OFFRE D√âCOUVERTE : -20% sur votre premi√®re s√©ance ! üéÅ
    </div>

    <!-- Header & Navigation -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1>Sabrine <span class="brand-accent">SJK</span></h1>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="#accueil" class="nav-link" onclick="scrollToSection(event, 'accueil')">Accueil</a></li>
                    <li><a href="#services" class="nav-link" onclick="scrollToSection(event, 'services')">Services</a></li>
                    <li><a href="#reservation" class="nav-link" onclick="scrollToSection(event, 'reservation')">R√©servation</a></li>
                    <li><a href="#temoignages" class="nav-link" onclick="scrollToSection(event, 'temoignages')">T√©moignages</a></li>
                    <li><a href="#contact" class="nav-link" onclick="scrollToSection(event, 'contact')">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <div id="btnLoginContainer" style="display:block">
                        <a href="#" class="btn btn-primary btn-login" id="btnOpenLogin">
                            <i class="fas fa-sign-in-alt"></i> Connexion
                        </a>
                    </div>
                    
                    <div id="userMenuContainer" style="display:none; position: relative;">
                        <a href="#" class="btn-membre" id="btnUserMenu">
                            <i class="fas fa-user-circle"></i> <span id="userName">Mon Espace</span>
                        </a>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="#" id="btnGoToClientSpace"><i class="fas fa-user"></i> Espace Client</a>
                            <a href="#" id="btnGoToAdminSpace" style="display:none"><i class="fas fa-cog"></i> Espace Admin</a>
                            <a href="#" id="btnLogout"><i class="fas fa-sign-out-alt"></i> D√©connexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="accueil" class="hero">
        <div class="hero-background">
            <img src="https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=1920&q=80" alt="Nature zen" class="hero-bg-img">
        </div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="hero-icon-group">
                <i class="fas fa-spa"></i>
                <i class="fas fa-lotus"></i>
                <i class="fas fa-leaf"></i>
            </div>
            <h2 class="hero-title">Sabrine SJK</h2>
            <p class="hero-subtitle">Th√©rapeute √ânerg√©tique ‚Ä¢ S√©ances Intuitives Guid√©es</p>
            <div class="hero-badges">
                <span class="badge">‚ú® Reiki Usui</span>
                <span class="badge">üåü Lahochi</span>
                <span class="badge">üîÆ Magn√©tisme</span>
            </div>
            <div class="hero-cta">
                <a href="#services" class="btn btn-primary btn-large">D√©couvrir mes soins</a>
                <a href="#reservation" class="btn btn-secondary btn-large">R√©server une s√©ance</a>
            </div>
        </div>
        <div class="scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-section">
        <div class="container">
            <div class="section-header">
                <span class="section-label">‚ú® Mon Approche</span>
                <h2>Ma Fa√ßon de Travailler</h2>
                <p>Simplement, intuitivement, dans le respect total de votre √™tre</p>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <p class="lead">Chaque personne est unique, et mes s√©ances s'adaptent naturellement √† vos besoins.</p>
                    <p>Je me laisse guider par l'intuition, mes ressentis et l'√©nergie du moment pour vous offrir l'accompagnement le plus juste.</p>
                    <div class="highlight-box">
                        <h3><i class="fas fa-star"></i> S√©ances Intuitives Guid√©es</h3>
                        <div class="tools-list">
                            <span class="tool-badge"><i class="fas fa-hands"></i> Magn√©tisme</span>
                            <span class="tool-badge"><i class="fas fa-wind"></i> Souffle</span>
                            <span class="tool-badge"><i class="fas fa-drum"></i> Tambour</span>
                            <span class="tool-badge"><i class="fas fa-gem"></i> Pierres</span>
                        </div>
                    </div>
                    <p class="emphasis"><i class="fas fa-globe"></i> Toutes mes s√©ances peuvent se faire en <strong>pr√©sentiel ou en distanciel</strong></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Publications Section -->
    <section id="publications" class="publications-section">
        <div class="container">
            <div class="section-header">
                <span class="section-label">üìù Actualit√©s</span>
                <h2>Mes Publications</h2>
                <p>D√©couvrez mes diff√©rentes approches et accompagnements</p>
            </div>
            <div id="allPosts" class="publications-public-grid">
                <p style="text-align: center; color: var(--text-color);">Chargement des publications...</p>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="container">
            <div class="section-header">
                <span class="section-label">Soins & Accompagnements</span>
                <h2>Services & Tarifs</h2>
                <p class="section-subtitle">Choisissez le soin qui vous correspond</p>
            </div>
            
            <!-- S√©ances Intuitives -->
            <div class="service-category">
                <h3 class="category-title"><i class="fas fa-star"></i> S√©ances Intuitives Guid√©es</h3>
                <div class="services-grid">
                    <div class="service-card" onclick="openServiceModal('intuitif-adulte')">
                        <div class="service-icon"><i class="fas fa-user"></i></div>
                        <h4>Adultes</h4>
                        <div class="price-group">
                            <div class="price-main">60‚Ç¨</div>
                            <div class="price-sub">50‚Ç¨ distanciel</div>
                        </div>
                        <p class="service-time">env. 1h</p>
                    </div>
                    
                    <div class="service-card" onclick="openServiceModal('intuitif-enfant')">
                        <div class="service-icon"><i class="fas fa-child"></i></div>
                        <h4>Enfants (-12 ans)</h4>
                        <div class="price-group">
                            <div class="price-main">40‚Ç¨</div>
                            <div class="price-sub">30‚Ç¨ distanciel</div>
                        </div>
                        <p class="service-time">Dur√©e adapt√©e</p>
                    </div>
                    
                    <div class="service-card" onclick="openServiceModal('intuitif-animal')">
                        <div class="service-icon"><i class="fas fa-paw"></i></div>
                        <h4>Animaux</h4>
                        <div class="price-group">
                            <div class="price-main">40‚Ç¨</div>
                            <div class="price-sub">30‚Ç¨ distanciel</div>
                        </div>
                        <p class="service-time">Dur√©e adapt√©e</p>
                    </div>
                </div>
            </div>

            <!-- Reiki & Lahochi -->
            <div class="service-category">
                <h3 class="category-title"><i class="fas fa-hands"></i> Reiki & Lahochi</h3>
                <div class="services-grid">
                    <div class="service-card" onclick="openServiceModal('reiki')">
                        <div class="service-icon"><i class="fas fa-spa"></i></div>
                        <h4>Reiki ou Lahochi</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-time">1h √† 1h15</p>
                    </div>
                    
                    <div class="service-card featured" onclick="openServiceModal('forfait-reiki')">
                        <div class="badge">FORFAIT</div>
                        <div class="service-icon"><i class="fas fa-gift"></i></div>
                        <h4>4 S√©ances</h4>
                        <div class="price-group">
                            <div class="price-old">240‚Ç¨</div>
                            <div class="price-main">210‚Ç¨</div>
                            <div class="price-sub">Paiement 3-4x</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Soins √ânerg√©tiques -->
            <div class="service-category">
                <h3 class="category-title"><i class="fas fa-om"></i> Soins √ânerg√©tiques</h3>
                <div class="services-grid">
                    <div class="service-card" onclick="openServiceModal('seance-sonore')">
                        <div class="service-icon"><i class="fas fa-music"></i></div>
                        <h4>S√©ance Sonore</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-time">1h</p>
                        <p class="service-desc">Travail vibratoire chakras</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('magnetisme-cranien')">
                        <div class="service-icon"><i class="fas fa-brain"></i></div>
                        <h4>Magn√©tisme Cr√¢nien</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-time">1h</p>
                        <p class="service-desc">Migraines, anxi√©t√©</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('micro-massage')">
                        <div class="service-icon"><i class="fas fa-hand-holding-heart"></i></div>
                        <h4>Micro-Massage</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-time">1h</p>
                        <p class="service-desc">T√™te, visage, dos, ventre</p>
                    </div>
                </div>
            </div>

            <!-- Accompagnements -->
            <div class="service-category">
                <h3 class="category-title"><i class="fas fa-heart"></i> Accompagnements Profonds</h3>
                <div class="services-grid">
                    <div class="service-card" onclick="openServiceModal('accompagnement-solo')">
                        <div class="service-icon"><i class="fas fa-leaf"></i></div>
                        <h4>S√©ance Seule</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-time">1h</p>
                    </div>

                    <div class="service-card featured" onclick="openServiceModal('accompagnement-forfait')">
                        <div class="badge">FORFAIT</div>
                        <div class="service-icon"><i class="fas fa-gifts"></i></div>
                        <h4>3 S√©ances</h4>
                        <div class="price-group">
                            <div class="price-old">180‚Ç¨</div>
                            <div class="price-main">160‚Ç¨</div>
                            <div class="price-sub">Paiement 3-4x</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- S√©ances Sp√©cifiques -->
            <div class="service-category">
                <h3 class="category-title"><i class="fas fa-plus-circle"></i> S√©ances Sp√©cifiques</h3>
                <div class="services-grid">
                    <div class="service-card" onclick="openServiceModal('verrue')">
                        <div class="service-icon"><i class="fas fa-hand-sparkles"></i></div>
                        <h4>Verrue</h4>
                        <div class="price-main">60‚Ç¨</div>
                        <p class="service-desc">Forfait complet 3 phases</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('accompagnement-operation')">
                        <div class="service-icon"><i class="fas fa-hospital"></i></div>
                        <h4>Accomp. Op√©ration</h4>
                        <div class="price-main">70‚Ç¨</div>
                        <p class="service-desc">Avant, pendant, apr√®s</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('accompagnement-chimio')">
                        <div class="service-icon"><i class="fas fa-hands-helping"></i></div>
                        <h4>Chimio/Radio</h4>
                        <div class="price-main">70‚Ç¨+</div>
                        <p class="service-desc">Coupeur feu inclus</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('coupeur-feu')">
                        <div class="service-icon"><i class="fas fa-fire-extinguisher"></i></div>
                        <h4>Coupeur de Feu</h4>
                        <div class="price-main">Don libre</div>
                        <p class="service-desc">Min. 30‚Ç¨</p>
                    </div>

                    <div class="service-card" onclick="openServiceModal('nettoyage-lieu')">
                        <div class="service-icon"><i class="fas fa-home"></i></div>
                        <h4>Nettoyage Lieux</h4>
                        <div class="price-main">100‚Ç¨</div>
                        <p class="service-desc">Harmonisation √©nerg√©tique</p>
                    </div>
                </div>
            </div>

            <!-- Infos pratiques -->
            <div class="info-box">
                <div class="info-item">
                    <i class="fas fa-credit-card"></i>
                    <span>Paiement 3-4x sur forfaits</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-car"></i>
                    <span>D√©placement 1‚Ç¨/km A/R</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-phone"></i>
                    <span>Sur RDV : <span id="heroPhone">Chargement...</span></span>
                </div>
            </div>

            <div class="disclaimer">
                <i class="fas fa-heart"></i>
                <p>Mes s√©ances accompagnent et soutiennent le bien-√™tre, mais ne remplacent jamais un avis ou suivi m√©dical. Elles agissent en compl√©ment, dans le respect du corps, de l'esprit et du chemin de chacun.</p>
            </div>
        </div>
    </section>

    <!-- Reservation Section -->
    <section id="reservation" class="reservation">
        <div class="container">
            <div class="section-header">
                <span class="section-label">Prenez rendez-vous</span>
                <h2>R√©servation</h2>
            </div>
            
            <div class="reservation-grid">
                <div class="calendar-container">
                    <h3><i class="fas fa-calendar-alt"></i> Disponibilit√©s</h3>
                    <div id="calendar"></div>
                </div>
                
                <div class="booking-form-container">
                    <h3><i class="fas fa-file-alt"></i> Formulaire de R√©servation</h3>
                    <form class="quick-booking-form" id="quickBookingForm">
                        <div class="form-group">
                            <label for="quick-firstname"><i class="fas fa-user"></i> Pr√©nom</label>
                            <input type="text" id="quick-firstname" name="firstname">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-lastname"><i class="fas fa-user"></i> Nom</label>
                            <input type="text" id="quick-lastname" name="lastname">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="quick-email" name="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-phone"><i class="fas fa-phone"></i> T√©l√©phone</label>
                            <input type="tel" id="quick-phone" name="phone">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-date"><i class="fas fa-calendar"></i> Date souhait√©e</label>
                            <input type="date" id="quick-date" name="date">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-time"><i class="fas fa-clock"></i> Heure</label>
                            <select id="quick-time" name="time">
                                <option value="">S√©lectionnez...</option>
                                <option value="09:00">09:00</option>
                                <option value="10:30">10:30</option>
                                <option value="12:00">12:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:30">15:30</option>
                                <option value="17:00">17:00</option>
                                <option value="18:30">18:30</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-service"><i class="fas fa-spa"></i> Type de soin</label>
                            <select id="quick-service" name="service">
                                <option value="">S√©lectionnez...</option>
                                <option value="intuitif-adulte">S√©ance Intuitive Adulte - 60‚Ç¨</option>
                                <option value="intuitif-enfant">S√©ance Intuitive Enfant - 40‚Ç¨</option>
                                <option value="intuitif-animal">S√©ance Intuitive Animal - 40‚Ç¨</option>
                                <option value="reiki">Reiki ou Lahochi - 60‚Ç¨</option>
                                <option value="forfait-reiki">Forfait 3 S√©ances - 160‚Ç¨</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-location"><i class="fas fa-map-marker-alt"></i> Localisation de la s√©ance *</label>
                            <select id="quick-location" name="location" required>
                                <option value="">S√©lectionnez...</option>
                                <option value="cabinet">Au cabinet (180 rue des mimosas, Beauvoisin)</option>
                                <option value="domicile">√Ä mon domicile</option>
                                <option value="distance">√Ä distance (visio/t√©l√©phone)</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="quick-address-group" style="display: none;">
                            <label for="quick-address"><i class="fas fa-home"></i> Votre adresse compl√®te *</label>
                            <input type="text" id="quick-address" name="address" placeholder="Ex: 10 rue de la R√©publique, 30000 N√Æmes">
                            
                            <label for="quick-distance" style="margin-top: 1rem;"><i class="fas fa-road"></i> Distance aller-retour (km) *</label>
                            <input type="number" id="quick-distance" name="distance" placeholder="Ex: 20" min="1" step="1" style="margin-bottom: 0.5rem;">
                            <small style="color: var(--text-light); font-size: 0.85rem; display: block;">
                                <i class="fas fa-info-circle"></i> Frais de d√©placement : 1‚Ç¨/km aller-retour
                            </small>
                        </div>
                        
                        <div id="quick-travel-info" class="travel-info" style="display: none;">
                            <div class="travel-info-content">
                                <i class="fas fa-car"></i>
                                <div class="travel-details">
                                    <strong>Frais de d√©placement</strong>
                                    <p id="quick-travel-cost" style="font-size: 1.2rem; color: var(--primary-color); font-weight: 600; margin: 0;"></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Champ cach√© pour stocker le co√ªt du d√©placement -->
                        <input type="hidden" id="quick-travel-cost-value" value="0">
                        
                        <div class="form-group">
                            <label for="quick-message"><i class="fas fa-comment"></i> Message (optionnel)</label>
                            <textarea id="quick-message" name="message" rows="3" placeholder="Pr√©cisez votre demande..."></textarea>
                        </div>
                        
                        <button type="button" class="btn btn-primary btn-block" onclick="showQuickBookingSummary()">
                            <i class="fas fa-eye"></i> Voir le r√©capitulatif
                        </button>
                    </form>
                    
                    <div class="contact-methods-mini">
                        <p style="text-align: center; margin: 20px 0 10px; font-weight: 600; color: var(--text-color);">Ou contactez-moi directement :</p>
                        <div class="contact-option">
                            <i class="fas fa-phone"></i>
                            <a href="tel:0612345678" id="modalPhoneLink"><span id="modalPhone">Chargement...</span></a>
                        </div>
                        <div class="contact-option">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:contact@sabrinesjk.fr" id="modalEmailLink"><span id="modalEmail">Chargement...</span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="temoignages" class="testimonials">
        <div class="container">
            <div class="section-header">
                <h2>T√©moignages</h2>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"Une exp√©rience incroyable, je me sens lib√©r√©e d'un poids √©norme."</p>
                    <p class="author">- Marie, 34 ans</p>
                </div>
                <div class="testimonial-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"Sabrine a un vrai don, je recommande √† 100%"</p>
                    <p class="author">- Thomas, 42 ans</p>
                </div>
                <div class="testimonial-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"Mes douleurs chroniques ont disparu apr√®s 3 s√©ances"</p>
                    <p class="author">- Sophie, 51 ans</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="section-header">
                <h2>Contact</h2>
                <p>Prenez rendez-vous ou posez vos questions, je vous r√©ponds avec plaisir</p>
            </div>
            
            <div class="contact-grid">
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <h3>T√©l√©phone</h3>
                    <p id="contactPhone">Chargement...</p>
                    <a href="tel:0612345678" id="contactPhoneLink" class="btn btn-secondary">Appeler maintenant</a>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h3>Email</h3>
                    <p id="contactEmail">contact@sabrinesjk.fr</p>
                    <a href="mailto:contact@sabrinesjk.fr" class="btn btn-secondary">Envoyer un email</a>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h3>Adresse</h3>
                    <p id="contactAddress">Beauvoisin<br>30640 Gard</p>
                    <a href="#reservation" class="btn btn-secondary">Prendre RDV</a>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3>Horaires</h3>
                    <p id="contactHours">Lundi - Vendredi<br>9h00 - 18h00</p>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">Sur rendez-vous</p>
                </div>
            </div>
            
            <div class="social-links-center">
                <a href="https://instagram.com/sabrine.sjk" target="_blank" class="social-btn" id="socialInstagramLink">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://facebook.com" target="_blank" class="social-btn" id="socialFacebookLink">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="https://linkedin.com" target="_blank" class="social-btn" id="socialLinkedinLink">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a href="#" class="social-btn" id="socialWhatsappLink">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>Sabrine SJK</h3>
                    <p>Th√©rapeute √ânerg√©tique<br>Beauvoisin, Gard</p>
                </div>
                <div class="footer-col">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="#accueil">Accueil</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#reservation">R√©servation</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact</h4>
                    <ul>
                        <li><i class="fas fa-phone"></i> 06 12 34 56 78</li>
                        <li><i class="fas fa-envelope"></i> contact@sabrinesjk.fr</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Sabrine SJK - Tous droits r√©serv√©s</p>
            </div>
        </div>
    </footer>

    <!-- Modal R√©servation -->
    <div id="bookingModal" class="modal">
        <div class="modal-content modal-large">
            <span class="modal-close" onclick="closeBookingModal()">&times;</span>
            <div class="booking-modal-header">
                <h2><i class="fas fa-calendar-check"></i> R√©server une s√©ance</h2>
                <p id="bookingServiceName"></p>
            </div>
            
            <form id="bookingForm" class="booking-form-detailed">
                <div class="form-step active">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="booking-firstname"><i class="fas fa-user"></i> Pr√©nom</label>
                            <input type="text" id="booking-firstname" name="firstname">
                        </div>
                        <div class="form-group">
                            <label for="booking-lastname"><i class="fas fa-user"></i> Nom</label>
                            <input type="text" id="booking-lastname" name="lastname">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="booking-email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="booking-email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="booking-phone"><i class="fas fa-phone"></i> T√©l√©phone</label>
                            <input type="tel" id="booking-phone" name="phone">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="booking-date"><i class="fas fa-calendar"></i> Date souhait√©e</label>
                            <input type="date" id="booking-date" name="date">
                        </div>
                        <div class="form-group">
                            <label for="booking-time"><i class="fas fa-clock"></i> Heure</label>
                            <select id="booking-time" name="time">
                                <option value="">S√©lectionnez...</option>
                                <option value="09:00">09:00</option>
                                <option value="10:30">10:30</option>
                                <option value="12:00">12:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:30">15:30</option>
                                <option value="17:00">17:00</option>
                                <option value="18:30">18:30</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="booking-location"><i class="fas fa-map-marker-alt"></i> Localisation de la s√©ance *</label>
                        <select id="booking-location" name="location" required>
                            <option value="">S√©lectionnez...</option>
                            <option value="cabinet">Au cabinet (180 rue des mimosas, Beauvoisin)</option>
                            <option value="domicile">√Ä mon domicile</option>
                            <option value="distance">√Ä distance (visio/t√©l√©phone)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="booking-address-group" style="display: none;">
                        <label for="booking-address"><i class="fas fa-home"></i> Votre adresse compl√®te *</label>
                        <input type="text" id="booking-address" name="address" placeholder="Ex: 10 rue de la R√©publique, 30000 N√Æmes">
                        
                        <label for="booking-distance" style="margin-top: 1rem;"><i class="fas fa-road"></i> Distance aller-retour (km) *</label>
                        <input type="number" id="booking-distance" name="distance" placeholder="Ex: 20" min="1" step="1" style="margin-bottom: 0.5rem;">
                        <small style="color: var(--text-light); font-size: 0.85rem; display: block;">
                            <i class="fas fa-info-circle"></i> Frais de d√©placement : 1‚Ç¨/km aller-retour
                        </small>
                    </div>
                    
                    <div id="booking-travel-info" class="travel-info" style="display: none;">
                        <div class="travel-info-content">
                            <i class="fas fa-car"></i>
                            <div class="travel-details">
                                <strong>Frais de d√©placement</strong>
                                <p id="booking-travel-cost" style="font-size: 1.2rem; color: var(--primary-color); font-weight: 600; margin: 0;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Champ cach√© pour stocker le co√ªt du d√©placement -->
                    <input type="hidden" id="booking-travel-cost-value" value="0">
                    
                    <div class="form-group">
                        <label for="booking-message"><i class="fas fa-comment"></i> Message (optionnel)</label>
                        <textarea id="booking-message" name="message" rows="4" placeholder="Pr√©cisez votre demande..."></textarea>
                    </div>
                    
                    <button type="button" class="btn btn-primary btn-block" onclick="showBookingSummary()">
                        <i class="fas fa-eye"></i> Voir le r√©capitulatif
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal R√©capitulatif R√©servation -->
    <div id="bookingSummaryModal" class="modal">
        <div class="modal-content modal-medium">
            <span class="modal-close" onclick="closeBookingSummary()">&times;</span>
            <div class="summary-header">
                <h2><i class="fas fa-clipboard-check"></i> R√©capitulatif de votre r√©servation</h2>
                <p>V√©rifiez les d√©tails avant de confirmer</p>
            </div>
            
            <div class="summary-content">
                <div class="summary-section">
                    <h3><i class="fas fa-spa"></i> Prestation</h3>
                    <div class="summary-item">
                        <span id="summary-service-name"></span>
                        <span id="summary-service-price" class="price-tag"></span>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h3><i class="fas fa-user"></i> Vos informations</h3>
                    <p><strong>Nom :</strong> <span id="summary-client-name"></span></p>
                    <p><strong>Email :</strong> <span id="summary-email"></span></p>
                    <p><strong>T√©l√©phone :</strong> <span id="summary-phone"></span></p>
                </div>
                
                <div class="summary-section">
                    <h3><i class="fas fa-calendar-alt"></i> Date et heure</h3>
                    <p><strong>Date :</strong> <span id="summary-date"></span></p>
                    <p><strong>Heure :</strong> <span id="summary-time"></span></p>
                </div>
                
                <div class="summary-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Localisation</h3>
                    <p id="summary-location-text"></p>
                    <p id="summary-address-text" style="display: none;"></p>
                </div>
                
                <div class="summary-section" id="summary-travel-section" style="display: none;">
                    <h3><i class="fas fa-car"></i> Frais de d√©placement</h3>
                    <div class="summary-item">
                        <span id="summary-travel-details"></span>
                        <span id="summary-travel-price" class="price-tag"></span>
                    </div>
                </div>
                
                <div class="summary-section" id="summary-message-section" style="display: none;">
                    <h3><i class="fas fa-comment"></i> Votre message</h3>
                    <p id="summary-message-text" style="font-style: italic; color: var(--text-color);"></p>
                </div>
                
                <div class="summary-total">
                    <div class="total-line">
                        <span>Prestation</span>
                        <span id="total-service-price"></span>
                    </div>
                    <div class="total-line" id="total-travel-line" style="display: none;">
                        <span>Frais de d√©placement</span>
                        <span id="total-travel-price"></span>
                    </div>
                    <div class="total-line total-ttc">
                        <strong>Total TTC</strong>
                        <strong id="total-ttc-price"></strong>
                    </div>
                </div>
            </div>
            
            <div class="summary-actions">
                <button type="button" class="btn btn-secondary" onclick="closeBookingSummary()">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button type="button" class="btn btn-primary" onclick="confirmAndSendBooking()">
                    <i class="fas fa-paper-plane"></i> Confirmer et envoyer
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Publication Compl√®te -->
    <div id="postModal" class="modal">
        <div class="modal-content post-modal-content">
            <span class="modal-close" onclick="closePostModal()">&times;</span>
            <div id="postModalBody" class="post-modal-body">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>

    <!-- Modal Connexion -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-modal-content">
            <span class="modal-close" onclick="closeLoginModal()">&times;</span>
            <div class="login-header">
                <h2>‚ú® Connexion</h2>
                <p>Acc√©dez √† votre espace personnel</p>
            </div>
            <div id="loginError" class="error-message" style="display: none;"></div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginEmail">üìß Email</label>
                    <input type="email" id="loginEmail" required placeholder="votre@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">üîí Mot de passe</label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe"> Se souvenir de moi
                    </label>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
                
                <div class="divider-text"><span>OU</span></div>
                
                <button type="button" class="btn btn-google btn-block" id="btnGoogleLogin">
                    <i class="fab fa-google"></i> Continuer avec Google
                </button>
                
                <div class="form-footer">
                    <p class="text-center">Pas encore de compte ? <a href="#" id="btnShowRegisterModal" class="link-primary">S'inscrire</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Inscription -->
    <div id="registerModal" class="modal">
        <div class="modal-content login-modal-content">
            <span class="modal-close" onclick="closeRegisterModal()">&times;</span>
            <div class="login-header">
                <h2>‚ú® Cr√©er un compte</h2>
                <p>Rejoignez-nous pour r√©server vos s√©ances</p>
            </div>
            <div id="registerError" class="error-message" style="display: none;"></div>
            <form id="registerForm" class="login-form">
                <div class="form-group">
                    <label for="registerFirstName">üë§ Pr√©nom *</label>
                    <input type="text" id="registerFirstName" required placeholder="Votre pr√©nom" autocomplete="given-name">
                </div>
                <div class="form-group">
                    <label for="registerLastName">üë§ Nom *</label>
                    <input type="text" id="registerLastName" required placeholder="Votre nom" autocomplete="family-name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">üìß Email *</label>
                    <input type="email" id="registerEmail" required placeholder="votre@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">üîí Mot de passe *</label>
                    <input type="password" id="registerPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="registerBirthDate">üéÇ Date de naissance *</label>
                    <input type="date" id="registerBirthDate" required autocomplete="bday">
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-user-plus"></i> Cr√©er mon compte
                </button>
                <div class="form-footer">
                    <p class="text-center">D√©j√† inscrit ? <a href="#" id="btnShowLoginFromRegister" class="link-primary">Se connecter</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Devis -->
    <div id="quoteModal" class="modal">
        <div class="modal-content modal-large">
            <span class="modal-close" onclick="closeQuoteModal()">&times;</span>
            <h2><i class="fas fa-file-invoice"></i> <span id="quoteModalTitle">Nouveau Devis</span></h2>
            
            <form id="quoteForm" class="business-form">
                <input type="hidden" id="quoteId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∞ Devis</label>
                        <input type="text" id="quoteNumber" placeholder="DEV-2025-001">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="quoteDate">
                    </div>
                    <div class="form-group">
                        <label>Validit√© (jours)</label>
                        <input type="number" id="quoteValidity" value="30" min="1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Client existant</label>
                    <select id="quoteSelectClient" onchange="fillClientInfo('quote')">
                        <option value="">-- S√©lectionner ou saisir manuellement --</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Nom du client</label>
                        <input type="text" id="quoteClientName" placeholder="Nom Pr√©nom">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="quoteClientEmail" placeholder="client@email.com">
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="tel" id="quoteClientPhone" placeholder="06 12 34 56 78">
                    </div>
                </div>

                <div class="form-group">
                    <label>Adresse</label>
                    <textarea id="quoteClientAddress" rows="2" placeholder="Adresse compl√®te"></textarea>
                </div>

                <h3>Prestations</h3>
                <div id="quoteItems">
                    <div class="quote-item">
                        <div class="form-group">
                            <select class="item-service-select" onchange="fillServiceInfo(this)">
                                <option value="">-- Choisir une prestation ou saisir manuellement --</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <input type="text" placeholder="Description" class="item-description">
                            </div>
                            <div class="form-group">
                                <input type="number" placeholder="Qt√©" class="item-quantity" value="1" min="1" step="1">
                            </div>
                            <div class="form-group">
                                <input type="number" placeholder="Prix HT" class="item-price" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <select class="item-vat">
                                    <option value="20">TVA 20%</option>
                                    <option value="10">TVA 10%</option>
                                    <option value="5.5">TVA 5.5%</option>
                                    <option value="0">TVA 0%</option>
                                </select>
                            </div>
                            <button type="button" class="btn-icon btn-remove-item" onclick="removeQuoteItem(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="addQuoteItem()">
                    <i class="fas fa-plus"></i> Ajouter une ligne
                </button>

                <div class="totals-section">
                    <div class="total-line">
                        <span>Total HT :</span>
                        <span id="quoteTotalHT">0.00 ‚Ç¨</span>
                    </div>
                    <div class="total-line">
                        <span>TVA :</span>
                        <span id="quoteTotalVAT">0.00 ‚Ç¨</span>
                    </div>
                    <div class="total-line total-ttc">
                        <span>Total TTC :</span>
                        <span id="quoteTotalTTC">0.00 ‚Ç¨</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Statut</label>
                    <select id="quoteStatus">
                        <option value="draft">Brouillon</option>
                        <option value="sent">Envoy√©</option>
                        <option value="accepted">Accept√©</option>
                        <option value="rejected">Refus√©</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeQuoteModal()">Annuler</button>
                    <button type="button" class="btn btn-info" onclick="previewQuote()">
                        <i class="fas fa-eye"></i> Pr√©visualiser
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Facture -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content modal-large">
            <span class="modal-close" onclick="closeInvoiceModal()">&times;</span>
            <h2><i class="fas fa-file-invoice-dollar"></i> <span id="invoiceModalTitle">Nouvelle Facture</span></h2>
            
            <form id="invoiceForm" class="business-form">
                <input type="hidden" id="invoiceId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∞ Facture</label>
                        <input type="text" id="invoiceNumber" placeholder="FA-2025-001">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="invoiceDate">
                    </div>
                    <div class="form-group">
                        <label>√âch√©ance</label>
                        <input type="date" id="invoiceDueDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>Client existant</label>
                    <select id="invoiceSelectClient" onchange="fillClientInfo('invoice')">
                        <option value="">-- S√©lectionner ou saisir manuellement --</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Nom du client</label>
                        <input type="text" id="invoiceClientName" placeholder="Nom Pr√©nom">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="invoiceClientEmail" placeholder="client@email.com">
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="tel" id="invoiceClientPhone" placeholder="06 12 34 56 78">
                    </div>
                </div>

                <div class="form-group">
                    <label>Adresse</label>
                    <textarea id="invoiceClientAddress" rows="2" placeholder="Adresse compl√®te"></textarea>
                </div>

                <h3>Prestations</h3>
                <div id="invoiceItems">
                    <div class="invoice-item">
                        <div class="form-group">
                            <select class="item-service-select" onchange="fillServiceInfo(this)">
                                <option value="">-- Choisir une prestation ou saisir manuellement --</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <input type="text" placeholder="Description" class="item-description">
                            </div>
                            <div class="form-group">
                                <input type="number" placeholder="Qt√©" class="item-quantity" value="1" min="1" step="1">
                            </div>
                            <div class="form-group">
                                <input type="number" placeholder="Prix HT" class="item-price" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <select class="item-vat">
                                    <option value="20">TVA 20%</option>
                                    <option value="10">TVA 10%</option>
                                    <option value="5.5">TVA 5.5%</option>
                                    <option value="0">TVA 0%</option>
                                </select>
                            </div>
                            <button type="button" class="btn-icon btn-remove-item" onclick="removeInvoiceItem(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="addInvoiceItem()">
                    <i class="fas fa-plus"></i> Ajouter une ligne
                </button>

                <div class="totals-section">
                    <div class="total-line">
                        <span>Total HT :</span>
                        <span id="invoiceTotalHT">0.00 ‚Ç¨</span>
                    </div>
                    <div class="total-line">
                        <span>TVA :</span>
                        <span id="invoiceTotalVAT">0.00 ‚Ç¨</span>
                    </div>
                    <div class="total-line total-ttc">
                        <span>Total TTC :</span>
                        <span id="invoiceTotalTTC">0.00 ‚Ç¨</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Statut de paiement</label>
                    <select id="invoiceStatus">
                        <option value="draft">Brouillon</option>
                        <option value="sent">Envoy√©e</option>
                        <option value="paid">Pay√©e</option>
                        <option value="overdue">En retard</option>
                        <option value="cancelled">Annul√©e</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeInvoiceModal()">Annuler</button>
                    <button type="button" class="btn btn-info" onclick="previewInvoice()">
                        <i class="fas fa-eye"></i> Pr√©visualiser
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal D√©pense -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeExpenseModal()">&times;</span>
            <h2><i class="fas fa-receipt"></i> <span id="expenseModalTitle">Nouvelle D√©pense</span></h2>
            
            <form id="expenseForm" class="business-form">
                <input type="hidden" id="expenseId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="expenseDate">
                    </div>
                    <div class="form-group">
                        <label>Cat√©gorie</label>
                        <select id="expenseCategory">
                            <option value="">-- Choisir --</option>
                            <option value="Formation">Formation</option>
                            <option value="Mat√©riel">Mat√©riel</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Abonnements">Abonnements</option>
                            <option value="D√©placements">D√©placements</option>
                            <option value="Fournitures">Fournitures</option>
                            <option value="Assurances">Assurances</option>
                            <option value="Autres">Autres</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="expenseDescription" placeholder="Description de la d√©pense">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Montant HT</label>
                        <input type="number" id="expenseAmountHT" min="0" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>TVA %</label>
                        <select id="expenseVAT">
                            <option value="20">20%</option>
                            <option value="10">10%</option>
                            <option value="5.5">5.5%</option>
                            <option value="0">0%</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Montant TTC</label>
                        <input type="number" id="expenseAmountTTC" min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label>Fournisseur</label>
                    <input type="text" id="expenseSupplier" placeholder="Nom du fournisseur">
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="expenseNotes" rows="3" placeholder="Notes compl√©mentaires..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeExpenseModal()">Annuler</button>
                    <button type="button" class="btn btn-info" onclick="previewExpense()">
                        <i class="fas fa-eye"></i> Pr√©visualiser
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Section Admin -->
    <section id="adminDashboard" class="admin-section" style="display: none;">
        <div class="container">
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('site')">
                    <i class="fas fa-home"></i> Site Client
                </button>
                <button class="admin-tab" onclick="switchAdminTab('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="admin-tab" onclick="switchAdminTab('quotes')">
                    <i class="fas fa-file-invoice"></i> Devis
                </button>
                <button class="admin-tab" onclick="switchAdminTab('invoices')">
                    <i class="fas fa-file-invoice-dollar"></i> Factures
                </button>
                <button class="admin-tab" onclick="switchAdminTab('expenses')">
                    <i class="fas fa-receipt"></i> D√©penses
                </button>
                <button class="admin-tab" onclick="switchAdminTab('treasury')">
                    <i class="fas fa-coins"></i> Tr√©sorerie
                </button>
                <button class="admin-tab" onclick="switchAdminTab('bookings')">
                    <i class="fas fa-calendar-alt"></i> R√©servations
                </button>
                <button class="admin-tab" onclick="switchAdminTab('publications')">
                    <i class="fas fa-feather-alt"></i> Publications
                </button>
                <button class="admin-tab" onclick="switchAdminTab('products')">
                    <i class="fas fa-box-open"></i> Produits & Services
                </button>
                <button class="admin-tab" onclick="switchAdminTab('settings')">
                    <i class="fas fa-cog"></i> Personnalisation
                </button>
            </div>

            <div id="adminTabSite" class="admin-tab-content">
                <p>Retour au site public</p>
                <button class="btn btn-primary" onclick="showPublicSite()">Voir le site</button>
            </div>

            <div id="adminTabDashboard" class="admin-tab-content" style="display: none;">
                <h2>Dashboard Administrateur</h2>
                
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">R√©servations</span>
                            <span class="stat-value" id="statBookings">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Clients</span>
                            <span class="stat-value" id="statClients">0</span>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3><i class="fas fa-calendar-alt"></i> Derni√®res r√©servations</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Service</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="adminBookingsTable">
                            <tr><td colspan="4">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- DEVIS -->
            <div id="adminTabQuotes" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-file-invoice"></i> Gestion des Devis</h2>
                    <button class="btn btn-primary" onclick="openQuoteModal()">
                        <i class="fas fa-plus"></i> Nouveau Devis
                    </button>
                </div>

                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-file-invoice"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Devis en attente</span>
                            <span class="stat-value" id="statQuotesPending">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Devis accept√©s</span>
                            <span class="stat-value" id="statQuotesAccepted">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-euro-sign"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Montant total</span>
                            <span class="stat-value" id="statQuotesTotal">0‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>N¬∞</th>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Montant TTC</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quotesList">
                            <tr><td colspan="6">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- FACTURES -->
            <div id="adminTabInvoices" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Gestion des Factures</h2>
                    <button class="btn btn-primary" onclick="openInvoiceModal()">
                        <i class="fas fa-plus"></i> Nouvelle Facture
                    </button>
                </div>

                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Factures impay√©es</span>
                            <span class="stat-value" id="statInvoicesUnpaid">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Factures pay√©es</span>
                            <span class="stat-value" id="statInvoicesPaid">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-euro-sign"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Chiffre d'affaires</span>
                            <span class="stat-value" id="statInvoicesRevenue">0‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>N¬∞</th>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Montant TTC</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesList">
                            <tr><td colspan="6">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- D√âPENSES -->
            <div id="adminTabExpenses" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-receipt"></i> Gestion des D√©penses</h2>
                    <button class="btn btn-primary" onclick="openExpenseModal()">
                        <i class="fas fa-plus"></i> Nouvelle D√©pense
                    </button>
                </div>

                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-receipt"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">D√©penses du mois</span>
                            <span class="stat-value" id="statExpensesMonth">0‚Ç¨</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Total annuel</span>
                            <span class="stat-value" id="statExpensesYear">0‚Ç¨</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-tags"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Cat√©gorie principale</span>
                            <span class="stat-value" id="statExpensesCategory">-</span>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Cat√©gorie</th>
                                <th>Montant TTC</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expensesList">
                            <tr><td colspan="5">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TR√âSORERIE -->
            <div id="adminTabTreasury" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-coins"></i> Tr√©sorerie</h2>
                </div>

                <div class="stats-row">
                    <div class="stat-card stat-card-success">
                        <div class="stat-icon"><i class="fas fa-arrow-up"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Recettes</span>
                            <span class="stat-value" id="statTreasuryIncome">0‚Ç¨</span>
                        </div>
                    </div>
                    <div class="stat-card stat-card-danger">
                        <div class="stat-icon"><i class="fas fa-arrow-down"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">D√©penses</span>
                            <span class="stat-value" id="statTreasuryExpenses">0‚Ç¨</span>
                        </div>
                    </div>
                    <div class="stat-card stat-card-primary">
                        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Solde</span>
                            <span class="stat-value" id="statTreasuryBalance">0‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3><i class="fas fa-chart-bar"></i> Vue d'ensemble mensuelle</h3>
                    <div class="treasury-chart" id="treasuryChart">
                        <p style="text-align: center; padding: 2rem; color: var(--text-light);">Graphique en d√©veloppement...</p>
                    </div>
                </div>

                <div class="admin-panel">
                    <h3><i class="fas fa-history"></i> Mouvements r√©cents</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody id="treasuryMovements">
                            <tr><td colspan="4">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="adminTabPublications" class="admin-tab-content" style="display: none;">
                <div class="publications-header">
                    <h2><i class="fas fa-feather-alt"></i> Gestion des Publications</h2>
                    <button class="btn btn-primary" onclick="togglePublicationForm()">
                        <i class="fas fa-plus"></i> <span id="btnToggleFormText">Nouvelle Publication</span>
                    </button>
                </div>

                <!-- Formulaire de publication -->
                <div id="publicationFormContainer" class="publication-form-container" style="display: none;">
                    <!-- Assistant IA -->
                    <div class="ai-assistant-section">
                        <h3><i class="fas fa-robot"></i> Assistant IA - G√©n√©ration de texte</h3>
                        <p class="ai-description">Donnez quelques id√©es ou mots-cl√©s, l'IA vous aidera √† r√©diger votre publication</p>
                        
                        <div class="ai-input-group">
                            <textarea id="ai-prompt" rows="3" placeholder="Ex: Parlez des bienfaits du Reiki pour r√©duire le stress et am√©liorer le sommeil..."></textarea>
                            <button type="button" class="btn btn-ai" onclick="generateAIContent()">
                                <i class="fas fa-magic"></i> G√©n√©rer avec l'IA
                            </button>
                        </div>
                        
                        <div id="ai-loading" style="display: none; text-align: center; padding: 1rem;">
                            <i class="fas fa-spinner fa-spin"></i> G√©n√©ration en cours...
                        </div>
                    </div>

                    <hr style="margin: 2rem 0; border: none; border-top: 2px dashed var(--border-color);">

                    <form id="publicationForm" class="publication-form">
                        <input type="hidden" id="publicationId">
                        
                        <div class="form-group">
                            <label for="publication-title"><i class="fas fa-heading"></i> Titre *</label>
                            <input type="text" id="publication-title" placeholder="Titre de votre publication">
                        </div>
                        
                        <div class="form-group">
                            <label for="publication-content">
                                <i class="fas fa-align-left"></i> Contenu *
                                <span style="float: right; font-weight: normal; font-size: 0.85rem; color: var(--text-light);">
                                    <span id="char-count">0</span> caract√®res
                                </span>
                            </label>
                            <textarea id="publication-content" rows="12" placeholder="√âcrivez votre message..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="publication-image"><i class="fas fa-image"></i> Image (URL)</label>
                            <input type="url" id="publication-image" placeholder="https://images.unsplash.com/...">
                            <small style="color: var(--text-light); display: block; margin-top: 5px;">
                                üí° Astuce : Cherchez sur <a href="https://unsplash.com/fr" target="_blank">Unsplash</a> et copiez l'URL de l'image
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="publication-tags"><i class="fas fa-tags"></i> Tags</label>
                            <input type="text" id="publication-tags" placeholder="Bien-√™tre, Reiki, M√©ditation... (s√©par√©s par des virgules)">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Publier
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="cancelPublicationForm()">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                        </div>
                    </form>
                </div>

                <div id="publicationsList" class="publications-admin-grid">
                    <p>Chargement...</p>
                </div>
            </div>

            <!-- Onglet R√©servations -->
            <div id="adminTabBookings" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-calendar-alt"></i> Gestion des R√©servations</h2>
                    <button class="btn btn-primary" onclick="openNewBookingModal()">
                        <i class="fas fa-plus"></i> Nouvelle R√©servation
                    </button>
                </div>

                <div class="stats-row">
                    <div class="stat-card stat-card-primary">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">En attente</span>
                            <span class="stat-value" id="statBookingsPending">0</span>
                        </div>
                    </div>
                    <div class="stat-card stat-card-success">
                        <div class="stat-icon"><i class="fas fa-check"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Confirm√©es</span>
                            <span class="stat-value" id="statBookingsConfirmed">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Total</span>
                            <span class="stat-value" id="statBookingsTotal">0</span>
                        </div>
                    </div>
                </div>

                <!-- Calendrier des r√©servations -->
                <div class="admin-panel">
                    <h3><i class="fas fa-calendar"></i> Calendrier des R√©servations</h3>
                    <div id="adminBookingsCalendar" style="background: white; padding: 20px; border-radius: 12px;"></div>
                </div>

                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Service</th>
                                <th>T√©l√©phone</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminBookingsList">
                            <tr><td colspan="6">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal Nouvelle R√©servation -->
            <div id="newBookingModal" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header gradient-header">
                        <h2><i class="fas fa-calendar-plus"></i> Nouvelle R√©servation</h2>
                        <button class="btn-close" onclick="closeNewBookingModal()">&times;</button>
                    </div>
                    <form id="newBookingForm" onsubmit="createNewBooking(event)" class="modal-form">
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-user"></i> Informations Client</h3>
                            <div class="form-group">
                                <label><i class="fas fa-user-circle"></i> Nom complet</label>
                                <input type="text" id="newClientName" placeholder="Pr√©nom et nom du client">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-envelope"></i> Email</label>
                                    <input type="email" id="newClientEmail" placeholder="client@email.com">
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-phone"></i> T√©l√©phone</label>
                                    <input type="tel" id="newPhone" placeholder="06 12 34 56 78">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-calendar-check"></i> D√©tails de la R√©servation</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> Date</label>
                                    <input type="date" id="newDate">
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-clock"></i> Heure</label>
                                    <input type="time" id="newTime">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-spa"></i> Service</label>
                                <select id="newService">
                                    <option value="">S√©lectionner un service</option>
                                    <optgroup label="S√©ances Intuitives">
                                        <option value="Intuitif Adulte Pr√©sentiel">Adulte Pr√©sentiel - 60‚Ç¨</option>
                                        <option value="Intuitif Adulte Distanciel">Adulte Distanciel - 50‚Ç¨</option>
                                        <option value="Intuitif Enfant Pr√©sentiel">Enfant (-12ans) Pr√©sentiel - 40‚Ç¨</option>
                                        <option value="Intuitif Enfant Distanciel">Enfant (-12ans) Distanciel - 30‚Ç¨</option>
                                        <option value="Intuitif Animal Pr√©sentiel">Animal Pr√©sentiel - 40‚Ç¨</option>
                                        <option value="Intuitif Animal Distanciel">Animal Distanciel - 30‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Reiki & Lahochi">
                                        <option value="Reiki/Lahochi">Reiki ou Lahochi - 60‚Ç¨</option>
                                        <option value="Forfait 4 s√©ances">Forfait 4 s√©ances - 210‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Soins √ânerg√©tiques">
                                        <option value="S√©ance Sonore">S√©ance Sonore √ânerg√©tique - 60‚Ç¨</option>
                                        <option value="Magn√©tisme Cr√¢nien">Magn√©tisme Cr√¢nien + Chakras - 60‚Ç¨</option>
                                        <option value="Micro-Massage">Micro-Massage √ânerg√©tique - 60‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Accompagnements">
                                        <option value="Accompagnement Seul">Accompagnement Holistique (1 s√©ance) - 60‚Ç¨</option>
                                        <option value="Accompagnement Forfait 3">Accompagnement Holistique (forfait 3) - 160‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="S√©ances Sp√©cifiques">
                                        <option value="Verrue">Traitement Verrue (forfait) - 60‚Ç¨</option>
                                        <option value="Accompagnement Op√©ration">Accompagnement Op√©ration - 70‚Ç¨</option>
                                        <option value="Accompagnement Chimio">Accompagnement Chimio/Radio - 70‚Ç¨+</option>
                                        <option value="Coupeur de Feu">Coupeur de Feu - Don libre (min. 30‚Ç¨)</option>
                                        <option value="Nettoyage Lieu">Nettoyage √ânerg√©tique Lieu - 100‚Ç¨</option>
                                    </optgroup>
                                    <option value="Autre">Autre prestation</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-info-circle"></i> Statut</label>
                                <select id="newStatus">
                                    <option value="pending">‚è≥ En attente</option>
                                    <option value="confirmed">‚úÖ Confirm√©e</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-sticky-note"></i> Notes</h3>
                            <div class="form-group">
                                <textarea id="newNotes" rows="3" placeholder="Notes additionnelles, demandes sp√©ciales, informations importantes..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeNewBookingModal()">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                            <button type="button" class="btn btn-info" onclick="previewNewBooking()">
                                <i class="fas fa-eye"></i> Pr√©visualiser
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Cr√©er la r√©servation
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Modal Modification R√©servation -->
            <div id="editBookingModal" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header gradient-header">
                        <h2><i class="fas fa-edit"></i> Modifier la R√©servation</h2>
                        <button class="btn-close" onclick="closeEditBookingModal()">&times;</button>
                    </div>
                    <form id="editBookingForm" onsubmit="saveBooking(event)" class="modal-form">
                        <input type="hidden" id="editBookingId">
                        
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-user"></i> Informations Client</h3>
                            <div class="form-group">
                                <label><i class="fas fa-user-circle"></i> Nom complet</label>
                                <input type="text" id="editClientName" placeholder="Pr√©nom et nom du client">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-envelope"></i> Email</label>
                                    <input type="email" id="editClientEmail" placeholder="client@email.com">
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-phone"></i> T√©l√©phone</label>
                                    <input type="tel" id="editPhone" placeholder="06 12 34 56 78">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-calendar-check"></i> D√©tails de la R√©servation</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> Date</label>
                                    <input type="date" id="editDate">
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-clock"></i> Heure</label>
                                    <input type="time" id="editTime">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-spa"></i> Service</label>
                                <select id="editService">
                                    <option value="">S√©lectionner un service</option>
                                    <optgroup label="S√©ances Intuitives">
                                        <option value="Intuitif Adulte Pr√©sentiel">Adulte Pr√©sentiel - 60‚Ç¨</option>
                                        <option value="Intuitif Adulte Distanciel">Adulte Distanciel - 50‚Ç¨</option>
                                        <option value="Intuitif Enfant Pr√©sentiel">Enfant (-12ans) Pr√©sentiel - 40‚Ç¨</option>
                                        <option value="Intuitif Enfant Distanciel">Enfant (-12ans) Distanciel - 30‚Ç¨</option>
                                        <option value="Intuitif Animal Pr√©sentiel">Animal Pr√©sentiel - 40‚Ç¨</option>
                                        <option value="Intuitif Animal Distanciel">Animal Distanciel - 30‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Reiki & Lahochi">
                                        <option value="Reiki/Lahochi">Reiki ou Lahochi - 60‚Ç¨</option>
                                        <option value="Forfait 4 s√©ances">Forfait 4 s√©ances - 210‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Soins √ânerg√©tiques">
                                        <option value="S√©ance Sonore">S√©ance Sonore √ânerg√©tique - 60‚Ç¨</option>
                                        <option value="Magn√©tisme Cr√¢nien">Magn√©tisme Cr√¢nien + Chakras - 60‚Ç¨</option>
                                        <option value="Micro-Massage">Micro-Massage √ânerg√©tique - 60‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="Accompagnements">
                                        <option value="Accompagnement Seul">Accompagnement Holistique (1 s√©ance) - 60‚Ç¨</option>
                                        <option value="Accompagnement Forfait 3">Accompagnement Holistique (forfait 3) - 160‚Ç¨</option>
                                    </optgroup>
                                    <optgroup label="S√©ances Sp√©cifiques">
                                        <option value="Verrue">Traitement Verrue (forfait) - 60‚Ç¨</option>
                                        <option value="Accompagnement Op√©ration">Accompagnement Op√©ration - 70‚Ç¨</option>
                                        <option value="Accompagnement Chimio">Accompagnement Chimio/Radio - 70‚Ç¨+</option>
                                        <option value="Coupeur de Feu">Coupeur de Feu - Don libre (min. 30‚Ç¨)</option>
                                        <option value="Nettoyage Lieu">Nettoyage √ânerg√©tique Lieu - 100‚Ç¨</option>
                                    </optgroup>
                                    <option value="Autre">Autre prestation</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-info-circle"></i> Statut</label>
                                <select id="editStatus">
                                    <option value="pending">‚è≥ En attente</option>
                                    <option value="confirmed">‚úÖ Confirm√©e</option>
                                    <option value="cancelled">‚ùå Annul√©e</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-sticky-note"></i> Notes</h3>
                            <div class="form-group">
                                <textarea id="editNotes" rows="3" placeholder="Notes additionnelles, demandes sp√©ciales, informations importantes..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeEditBookingModal()">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                            <button type="button" class="btn btn-info" onclick="previewEditBooking()">
                                <i class="fas fa-eye"></i> Pr√©visualiser
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Onglet Produits et Services -->
            <div id="adminTabProducts" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-box-open"></i> Gestion des Produits & Services</h2>
                    <button class="btn btn-primary" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Ajouter un produit/service
                    </button>
                </div>

                <div class="products-grid" id="productsList">
                    <!-- Les produits seront charg√©s ici -->
                </div>
            </div>

            <!-- Modal Produit/Service -->
            <div id="productModal" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header gradient-header">
                        <h2><i class="fas fa-box-open"></i> <span id="productModalTitle">Nouveau Produit/Service</span></h2>
                        <button class="btn-close" onclick="closeProductModal()">&times;</button>
                    </div>
                    
                    <form id="productForm" class="modal-form">
                        <input type="hidden" id="productId">
                        
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-tag"></i> Informations G√©n√©rales</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-list"></i> Type</label>
                                    <select id="productType">
                                        <option value="service">üíÜ Service</option>
                                        <option value="product">üì¶ Produit</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-bookmark"></i> Cat√©gorie</label>
                                    <select id="productCategory">
                                        <option value="soin-energetique">‚ú® Soin √ânerg√©tique</option>
                                        <option value="massage">üíÜ Massage</option>
                                        <option value="meditation">üßò M√©ditation</option>
                                        <option value="consultation">üí¨ Consultation</option>
                                        <option value="formation">üìö Formation</option>
                                        <option value="accessoire">üéÅ Accessoire</option>
                                        <option value="autre">üìå Autre</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-pen"></i> Nom</label>
                                <input type="text" id="productName" placeholder="Ex: Reiki Usui, Lahochi, Bracelet cristal...">
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-align-left"></i> Description</label>
                                <textarea id="productDescription" rows="4" placeholder="Description d√©taill√©e du produit ou service : b√©n√©fices, d√©roulement, particularit√©s..."></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-euro-sign"></i> Tarification & Dur√©e</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-euro-sign"></i> Prix (‚Ç¨)</label>
                                    <input type="number" id="productPrice" min="0" step="0.01" placeholder="60.00">
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-clock"></i> Dur√©e (minutes)</label>
                                    <input type="number" id="productDuration" min="0" step="15" placeholder="60">
                                    <small style="color: var(--text-light); margin-top: 4px; display: block;">üí° Optionnel pour les produits</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-image"></i> Visuel & Affichage</h3>
                            <div class="form-group">
                                <label><i class="fas fa-link"></i> Image (URL)</label>
                                <input type="url" id="productImage" placeholder="https://exemple.com/image.jpg">
                                <small style="color: var(--text-light); margin-top: 4px; display: block;">üí° URL de l'image du produit/service (Imgur, Google Photos, etc.)</small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="productActive" checked>
                                    <span><i class="fas fa-eye"></i> Actif (visible sur le site et dans les r√©servations)</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeProductModal()">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                            <button type="button" class="btn btn-info" onclick="previewProduct()">
                                <i class="fas fa-eye"></i> Pr√©visualiser
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Onglet Personnalisation -->
            <div id="adminTabSettings" class="admin-tab-content" style="display: none;">
                <div class="admin-section-header">
                    <h2><i class="fas fa-cog"></i> Personnalisation</h2>
                    <p>Renseignez les informations de votre soci√©t√© pour personnaliser vos devis et factures</p>
                </div>

                <form id="settingsForm" class="business-form">
                    <h3><i class="fas fa-building"></i> Informations Soci√©t√©</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom de la soci√©t√©</label>
                            <input type="text" id="companyName" placeholder="Sabrine SJK">
                        </div>
                        <div class="form-group">
                            <label>Activit√©</label>
                            <input type="text" id="companyActivity" placeholder="Th√©rapeute √ânerg√©tique">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Adresse compl√®te *</label>
                        <textarea id="companyAddress" rows="3" placeholder="Rue, Code Postal, Ville"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="companyEmail" placeholder="contact@sabrinesjk.fr">
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="tel" id="companyPhone" placeholder="06 12 34 56 78">
                        </div>
                    </div>

                    <h3><i class="fas fa-file-invoice"></i> Informations L√©gales</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>SIRET</label>
                            <input type="text" id="companySiret" placeholder="123 456 789 00012">
                        </div>
                        <div class="form-group">
                            <label>N¬∞ TVA Intracommunautaire</label>
                            <input type="text" id="companyVat" placeholder="FR12345678901">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>IBAN (pour les factures)</label>
                        <input type="text" id="companyIban" placeholder="FR76 1234 5678 9012 3456 7890 123">
                    </div>

                    <div class="form-group">
                        <label>BIC</label>
                        <input type="text" id="companyBic" placeholder="BNPAFRPPXXX">
                    </div>

                    <h3><i class="fas fa-user"></i> Informations Personnelles</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Pr√©nom</label>
                            <input type="text" id="ownerFirstName" placeholder="Sabrine">
                        </div>
                        <div class="form-group">
                            <label>Nom</label>
                            <input type="text" id="ownerLastName" placeholder="SJK">
                        </div>
                    </div>

                    <h3><i class="fas fa-palette"></i> Personnalisation des Documents</h3>

                    <div class="form-group">
                        <label>Mentions l√©gales sur devis/factures</label>
                        <textarea id="companyLegalMentions" rows="3" placeholder="TVA non applicable, art. 293 B du CGI&#10;En cas de retard de paiement..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Conditions de paiement</label>
                        <textarea id="companyPaymentTerms" rows="3" placeholder="Paiement √† 30 jours&#10;R√®glement par virement bancaire, esp√®ces ou ch√®que"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Validit√© des devis (jours)</label>
                        <input type="number" id="quoteValidityDays" value="30" min="1">
                    </div>

                    <h3><i class="fas fa-palette"></i> Apparence du Site</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-font"></i> Police principale</label>
                            <select id="siteFontPrimary">
                                <option value="'Poppins', sans-serif">Poppins (d√©faut)</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Open Sans', sans-serif">Open Sans</option>
                                <option value="'Lato', sans-serif">Lato</option>
                                <option value="'Raleway', sans-serif">Raleway</option>
                                <option value="'Nunito', sans-serif">Nunito</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-heading"></i> Police titres</label>
                            <select id="siteFontSecondary">
                                <option value="'Cormorant Garamond', serif">Cormorant Garamond (d√©faut)</option>
                                <option value="'Playfair Display', serif">Playfair Display</option>
                                <option value="'Merriweather', serif">Merriweather</option>
                                <option value="'Libre Baskerville', serif">Libre Baskerville</option>
                                <option value="'Crimson Text', serif">Crimson Text</option>
                                <option value="'Lora', serif">Lora</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-text-height"></i> Taille texte de base (px)</label>
                            <input type="number" id="siteBaseFontSize" value="16" min="12" max="24" step="1">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-arrows-alt-h"></i> Espacement sections (px)</label>
                            <input type="number" id="siteSectionPadding" value="80" min="40" max="150" step="10">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-border-style"></i> Arrondi des coins (px)</label>
                            <input type="number" id="siteBorderRadius" value="12" min="0" max="30" step="2">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-layer-group"></i> Intensit√© des ombres</label>
                            <select id="siteShadowIntensity">
                                <option value="light">L√©g√®res</option>
                                <option value="medium" selected>Moyennes (d√©faut)</option>
                                <option value="strong">Fortes</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Template de couleurs</label>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem;">
                            Choisissez un th√®me pr√©d√©fini ou personnalisez vos couleurs manuellement
                        </p>
                        <div class="color-templates">
                            <div class="color-template" onclick="applyColorTemplate('purple-pink')" data-template="purple-pink">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);"></div>
                                </div>
                                <span>Violet Rose (d√©faut)</span>
                            </div>
                            <div class="color-template" onclick="applyColorTemplate('blue-teal')" data-template="blue-teal">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #3B82F6 0%, #06B6D4 100%);"></div>
                                </div>
                                <span>Bleu Turquoise</span>
                            </div>
                            <div class="color-template" onclick="applyColorTemplate('green-emerald')" data-template="green-emerald">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);"></div>
                                </div>
                                <span>Vert √âmeraude</span>
                            </div>
                            <div class="color-template" onclick="applyColorTemplate('orange-red')" data-template="orange-red">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #F97316 0%, #EF4444 100%);"></div>
                                </div>
                                <span>Orange Rouge</span>
                            </div>
                            <div class="color-template" onclick="applyColorTemplate('indigo-purple')" data-template="indigo-purple">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);"></div>
                                </div>
                                <span>Indigo Violet</span>
                            </div>
                            <div class="color-template" onclick="applyColorTemplate('rose-pink')" data-template="rose-pink">
                                <div class="template-colors">
                                    <div style="background: linear-gradient(135deg, #F43F5E 0%, #EC4899 100%);"></div>
                                </div>
                                <span>Rose Fuchsia</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Couleur principale (personnalis√©e)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="color" id="siteColorPrimary" value="#8B5CF6" style="height: 45px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
                                <input type="text" id="siteColorPrimaryText" value="#8B5CF6" placeholder="#8B5CF6" style="flex: 1;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Couleur secondaire (personnalis√©e)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="color" id="siteColorSecondary" value="#EC4899" style="height: 45px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
                                <input type="text" id="siteColorSecondaryText" value="#EC4899" placeholder="#EC4899" style="flex: 1;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Logo (URL de l'image)</label>
                        <input type="url" id="siteLogo" placeholder="https://exemple.com/logo.png">
                        <small style="color: var(--text-light); display: block; margin-top: 5px;">
                            üí° Uploadez votre logo sur un service comme <a href="https://imgur.com" target="_blank">Imgur</a> et collez l'URL ici
                        </small>
                    </div>

                    <div class="form-group">
                        <label>Slogan / Phrase d'accroche</label>
                        <input type="text" id="siteSlogan" placeholder="Votre bien-√™tre, ma priorit√©">
                    </div>

                    <h3><i class="fas fa-share-alt"></i> R√©seaux Sociaux</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fab fa-facebook"></i> Facebook</label>
                            <input type="url" id="socialFacebook" placeholder="https://facebook.com/votreprofil">
                        </div>
                        <div class="form-group">
                            <label><i class="fab fa-instagram"></i> Instagram</label>
                            <input type="url" id="socialInstagram" placeholder="https://instagram.com/votreprofil">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fab fa-linkedin"></i> LinkedIn</label>
                            <input type="url" id="socialLinkedin" placeholder="https://linkedin.com/in/votreprofil">
                        </div>
                        <div class="form-group">
                            <label><i class="fab fa-whatsapp"></i> WhatsApp</label>
                            <input type="tel" id="socialWhatsapp" placeholder="06 12 34 56 78">
                        </div>
                    </div>

                    <h3><i class="fas fa-calendar-alt"></i> Gestion des Horaires</h3>

                    <div class="form-group">
                        <label>Jours d'ouverture</label>
                        <div class="checkbox-group" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="dayMonday" checked> Lundi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="dayTuesday" checked> Mardi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="dayWednesday" checked> Mercredi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="dayThursday" checked> Jeudi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="dayFriday" checked> Vendredi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="daySaturday"> Samedi
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="daySunday"> Dimanche
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Horaire d'ouverture</label>
                            <input type="time" id="openingTime" value="09:00">
                        </div>
                        <div class="form-group">
                            <label>Horaire de fermeture</label>
                            <input type="time" id="closingTime" value="18:00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Dur√©e par d√©faut des s√©ances (minutes)</label>
                        <input type="number" id="defaultSessionDuration" value="60" min="15" step="15">
                    </div>

                    <h3><i class="fas fa-envelope"></i> Notifications</h3>

                    <div class="form-group">
                        <label>Email de notification pour les nouvelles r√©servations</label>
                        <input type="email" id="notificationEmail" placeholder="contact@sabrinesjk.fr">
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="autoConfirmBookings">
                            Confirmer automatiquement les r√©servations
                        </label>
                        <small style="color: var(--text-light); display: block; margin-top: 5px;">
                            Si coch√©, les r√©servations seront automatiquement confirm√©es sans validation manuelle
                        </small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="cancelSettings()">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                        <button type="button" class="btn btn-warning" onclick="resetSettings()">
                            <i class="fas fa-undo"></i> R√©initialiser
                        </button>
                        <button type="button" class="btn btn-info" onclick="previewSettings()">
                            <i class="fas fa-eye"></i> Pr√©visualiser
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Enregistrer toutes les modifications
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Section Client -->
    <section id="clientSpace" class="client-section" style="display: none;">
        <div class="container">
            <div class="client-header">
                <h2><i class="fas fa-user-circle"></i> Mon Espace Client</h2>
            </div>

            <div class="client-tabs">
                <button class="client-tab active" onclick="switchClientTab('bookings')">
                    <i class="fas fa-calendar-check"></i> Mes R√©servations
                </button>
                <button class="client-tab" onclick="switchClientTab('newBooking')">
                    <i class="fas fa-calendar-plus"></i> Nouvelle R√©servation
                </button>
                <button class="client-tab" onclick="switchClientTab('documents')">
                    <i class="fas fa-file-pdf"></i> Mes Documents
                </button>
            </div>

            <div id="clientTabBookings" class="client-tab-content">
                <div id="clientBookingsList" class="bookings-grid"></div>
            </div>

            <div id="clientTabNewBooking" class="client-tab-content" style="display: none;">
                <div class="reservation-grid">
                    <div class="calendar-container">
                        <h3><i class="fas fa-calendar-alt"></i> Disponibilit√©s</h3>
                        <div id="calendarClient"></div>
                    </div>
                    
                    <div class="booking-form-container">
                        <h3><i class="fas fa-file-alt"></i> Formulaire de R√©servation</h3>
                        <form class="quick-booking-form" id="clientQuickBookingForm">
                            <div class="form-group">
                                <label for="client-quick-firstname"><i class="fas fa-user"></i> Pr√©nom</label>
                                <input type="text" id="client-quick-firstname" name="firstname">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-lastname"><i class="fas fa-user"></i> Nom</label>
                                <input type="text" id="client-quick-lastname" name="lastname">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-email"><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" id="client-quick-email" name="email">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-phone"><i class="fas fa-phone"></i> T√©l√©phone</label>
                                <input type="tel" id="client-quick-phone" name="phone">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-date"><i class="fas fa-calendar"></i> Date souhait√©e</label>
                                <input type="date" id="client-quick-date" name="date">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-time"><i class="fas fa-clock"></i> Heure</label>
                                <select id="client-quick-time" name="time">
                                    <option value="">S√©lectionnez...</option>
                                    <option value="09:00">09:00</option>
                                    <option value="10:30">10:30</option>
                                    <option value="12:00">12:00</option>
                                    <option value="14:00">14:00</option>
                                    <option value="15:30">15:30</option>
                                    <option value="17:00">17:00</option>
                                    <option value="18:30">18:30</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-service"><i class="fas fa-spa"></i> Type de soin *</label>
                                <select id="client-quick-service" name="service">
                                    <option value="">S√©lectionnez...</option>
                                    <option value="intuitif-adulte">S√©ance Intuitive Adulte - 60‚Ç¨</option>
                                    <option value="intuitif-enfant">S√©ance Intuitive Enfant - 40‚Ç¨</option>
                                    <option value="intuitif-animal">S√©ance Intuitive Animal - 40‚Ç¨</option>
                                    <option value="reiki">Reiki ou Lahochi - 60‚Ç¨</option>
                                    <option value="forfait-reiki">Forfait 3 S√©ances - 160‚Ç¨</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="client-quick-message"><i class="fas fa-comment"></i> Message (optionnel)</label>
                                <textarea id="client-quick-message" name="message" rows="3" placeholder="Pr√©cisez votre demande..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-check"></i> Envoyer la demande
                            </button>
                        </form>
                        
                        <div class="contact-methods-mini">
                            <p style="text-align: center; margin: 20px 0 10px; font-weight: 600; color: var(--text-color);">Ou contactez-moi directement :</p>
                            <div class="contact-option">
                                <i class="fas fa-phone"></i>
                                <a href="tel:0612345678">06 12 34 56 78</a>
                            </div>
                            <div class="contact-option">
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:contact@sabrine.sjk">contact@sabrine.sjk</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="clientTabDocuments" class="client-tab-content" style="display: none;">
                <p>Vos documents seront disponibles ici</p>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/fr.js'></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, setDoc, doc, getDoc, query, where, orderBy, limit, deleteDoc, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6hNLg-Ad2XihTrVD5P-3wI2H3kl6IUVg",
            authDomain: "sandrinesjk.firebaseapp.com",
            projectId: "sandrinesjk",
            storageBucket: "sandrinesjk.firebasestorage.app",
            messagingSenderId: "481099745596",
            appId: "1:481099745596:web:af7fe189c144ba2a44f639"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let currentUserData = null;
        
        // Initialisation EmailJS - D√âSACTIV√â
        // (function(){
        //     emailjs.init("YOUR_PUBLIC_KEY"); // √Ä remplacer par votre cl√© publique EmailJS
        // })();

        // ===== MODALS =====
        window.openLoginModal = () => {
            document.getElementById('loginModal').style.display = 'flex';
        };

        window.closeLoginModal = () => {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').style.display = 'none';
        };

        window.openRegisterModal = () => {
            document.getElementById('registerModal').style.display = 'flex';
        };

        window.closeRegisterModal = () => {
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('registerForm').reset();
            document.getElementById('registerError').style.display = 'none';
        };

        // Services mapping complet - Correspond aux 18 services migr√©s dans Firebase
        const servicesData = {
            // S√©ances Intuitives (6 services : 3 types x 2 formats)
            'intuitif-adulte': { name: 'S√©ance Intuitive Adulte (Pr√©sentiel)', price: 60, duration: '1h' },
            'intuitif-adulte-distance': { name: 'S√©ance Intuitive Adulte (Distanciel)', price: 50, duration: '1h' },
            'intuitif-enfant': { name: 'S√©ance Intuitive Enfant (Pr√©sentiel)', price: 40, duration: '45min' },
            'intuitif-enfant-distance': { name: 'S√©ance Intuitive Enfant (Distanciel)', price: 30, duration: '45min' },
            'intuitif-animal': { name: 'S√©ance Intuitive Animal (Pr√©sentiel)', price: 40, duration: '45min' },
            'intuitif-animal-distance': { name: 'S√©ance Intuitive Animal (Distanciel)', price: 30, duration: '45min' },
            
            // Reiki & Lahochi (2 services)
            'reiki': { name: 'Reiki ou Lahochi', price: 60, duration: '1h-1h15' },
            'forfait-reiki': { name: 'Forfait 4 S√©ances Reiki', price: 210, oldPrice: 240, duration: '4x1h' },
            
            // Soins √ânerg√©tiques Sp√©cialis√©s (3 services)
            'seance-sonore': { name: 'S√©ance Sonore √ânerg√©tique', price: 60, duration: '1h' },
            'magnetisme-cranien': { name: 'Magn√©tisme Cr√¢nien + Harmonisation Chakras', price: 60, duration: '1h' },
            'micro-massage': { name: 'Micro-Massage √ânerg√©tique', price: 60, duration: '1h' },
            
            // Accompagnements Holistiques (2 services)
            'accompagnement-solo': { name: 'Accompagnement Holistique (s√©ance seule)', price: 60, duration: '1h' },
            'accompagnement-forfait': { name: 'Accompagnement Holistique (Forfait 3 s√©ances)', price: 160, oldPrice: 180, duration: '3x1h' },
            
            // S√©ances Sp√©cifiques (5 services)
            'verrue': { name: 'Traitement Verrue (Forfait complet)', price: 60, duration: '3 phases' },
            'accompagnement-operation': { name: 'Accompagnement Op√©ration', price: 70, duration: 'Variable' },
            'accompagnement-chimio': { name: 'Accompagnement Chimio/Radioth√©rapie (Base)', price: 70, duration: 'Variable' },
            'coupeur-feu': { name: 'Coupeur de Feu', price: 30, priceType: 'minimum', duration: '15min' },
            'nettoyage-lieu': { name: 'Nettoyage √ânerg√©tique de Lieux', price: 100, duration: '2h' }
        };
        
        // Variable globale pour stocker les donn√©es de r√©servation en cours
        let currentBookingData = {};

        window.openServiceModal = (serviceId) => {
            const service = servicesData[serviceId];
            if (!service) return;
            
            // Stocker l'ID du service pour utilisation ult√©rieure
            currentBookingData.serviceId = serviceId;
            currentBookingData.service = service;
            
            document.getElementById('bookingServiceName').textContent = `${service.name} - ${service.price}‚Ç¨`;
            document.getElementById('bookingModal').style.display = 'flex';
            
            // Pr√©-remplir si connect√©
            if (currentUserData) {
                document.getElementById('booking-firstname').value = currentUserData.firstName || '';
                document.getElementById('booking-lastname').value = currentUserData.lastName || '';
                document.getElementById('booking-email').value = currentUserData.email || '';
            }
            
            // Set min date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('booking-date').setAttribute('min', today);
        };

        window.closeBookingModal = () => {
            document.getElementById('bookingModal').style.display = 'none';
            document.getElementById('bookingForm').reset();
            document.getElementById('booking-address-group').style.display = 'none';
            document.getElementById('booking-travel-info').style.display = 'none';
        };
        
        // Fonction pour afficher le r√©capitulatif de r√©servation
        window.showBookingSummary = () => {
            // Validation des champs requis
            const firstName = document.getElementById('booking-firstname').value.trim();
            const lastName = document.getElementById('booking-lastname').value.trim();
            const email = document.getElementById('booking-email').value.trim();
            const phone = document.getElementById('booking-phone').value.trim();
            const date = document.getElementById('booking-date').value;
            const time = document.getElementById('booking-time').value;
            const location = document.getElementById('booking-location').value;
            
            if (!firstName || !lastName || !email || !phone || !date || !time || !location) {
                alert('‚ö†Ô∏è Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            if (location === 'domicile') {
                if (!document.getElementById('booking-address').value.trim()) {
                    alert('‚ö†Ô∏è Veuillez renseigner votre adresse pour une s√©ance √† domicile');
                    return;
                }
                if (!document.getElementById('booking-distance').value || parseFloat(document.getElementById('booking-distance').value) <= 0) {
                    alert('‚ö†Ô∏è Veuillez renseigner la distance en km aller-retour');
                    return;
                }
            }
            
            // Collecter toutes les donn√©es
            const address = document.getElementById('booking-address').value.trim();
            const distanceKm = location === 'domicile' ? parseFloat(document.getElementById('booking-distance').value) : 0;
            const message = document.getElementById('booking-message').value.trim();
            const service = currentBookingData.service;
            
            // Calculer le prix de base
            let servicePrice = service.price;
            if (location === 'distance' && service.priceDistance) {
                servicePrice = service.priceDistance;
            }
            
            // Calculer les frais de d√©placement
            let travelCost = 0;
            let travelDetails = '';
            if (location === 'domicile' && distanceKm > 0) {
                travelCost = Math.round(distanceKm);
                travelDetails = `${distanceKm} km aller-retour`;
            }
            
            // Stocker les donn√©es
            currentBookingData = {
                ...currentBookingData,
                firstName,
                lastName,
                email,
                phone,
                date,
                time,
                location,
                address,
                message,
                servicePrice,
                travelCost,
                travelDetails
            };
            
            // Remplir le modal de r√©capitulatif
            document.getElementById('summary-service-name').textContent = service.name;
            document.getElementById('summary-service-price').textContent = servicePrice + '‚Ç¨';
            document.getElementById('summary-client-name').textContent = `${firstName} ${lastName}`;
            document.getElementById('summary-email').textContent = email;
            document.getElementById('summary-phone').textContent = phone;
            
            // Formater la date en fran√ßais
            const dateObj = new Date(date + 'T00:00:00');
            const dateFormatted = dateObj.toLocaleDateString('fr-FR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('summary-date').textContent = dateFormatted;
            document.getElementById('summary-time').textContent = time;
            
            // Localisation
            let locationText = '';
            if (location === 'cabinet') {
                locationText = 'üìç Au cabinet (180 rue des mimosas, Beauvoisin)';
            } else if (location === 'domicile') {
                locationText = 'üìç √Ä votre domicile';
                document.getElementById('summary-address-text').textContent = address;
                document.getElementById('summary-address-text').style.display = 'block';
            } else {
                locationText = 'üìç √Ä distance (visio/t√©l√©phone)';
            }
            document.getElementById('summary-location-text').textContent = locationText;
            
            // Frais de d√©placement
            if (travelCost > 0) {
                document.getElementById('summary-travel-section').style.display = 'block';
                document.getElementById('summary-travel-details').textContent = travelDetails;
                document.getElementById('summary-travel-price').textContent = travelCost + '‚Ç¨';
                document.getElementById('total-travel-line').style.display = 'flex';
                document.getElementById('total-travel-price').textContent = travelCost + '‚Ç¨';
            } else {
                document.getElementById('summary-travel-section').style.display = 'none';
                document.getElementById('total-travel-line').style.display = 'none';
            }
            
            // Message
            if (message) {
                document.getElementById('summary-message-section').style.display = 'block';
                document.getElementById('summary-message-text').textContent = message;
            } else {
                document.getElementById('summary-message-section').style.display = 'none';
            }
            
            // Total
            const totalTTC = servicePrice + travelCost;
            document.getElementById('total-service-price').textContent = servicePrice + '‚Ç¨';
            document.getElementById('total-ttc-price').textContent = totalTTC + '‚Ç¨';
            
            // Afficher le modal
            document.getElementById('bookingSummaryModal').style.display = 'flex';
        };
        
        window.closeBookingSummary = () => {
            document.getElementById('bookingSummaryModal').style.display = 'none';
        };
        
        // Fonction similaire pour le quick booking
        window.showQuickBookingSummary = () => {
            // Rediriger vers showBookingSummary en adaptant les IDs
            alert('‚ö†Ô∏è Veuillez utiliser le formulaire de r√©servation d√©taill√© pour voir le r√©capitulatif. Cliquez sur une prestation pour ouvrir le formulaire complet.');
        };
        
        // Fonction pour confirmer et envoyer la r√©servation
        window.confirmAndSendBooking = async () => {
            try {
                const btn = event.target;
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enregistrement en cours...';
                
                const data = currentBookingData;
                const totalTTC = data.servicePrice + data.travelCost;
                
                // Construire le message d√©taill√© pour les notes
                let locationText = '';
                if (data.location === 'cabinet') {
                    locationText = 'Au cabinet (180 rue des mimosas, Beauvoisin)';
                } else if (data.location === 'domicile') {
                    locationText = `√Ä domicile - ${data.address}`;
                    if (data.travelDetails) {
                        locationText += `\n${data.travelDetails}\nFrais de d√©placement: ${data.travelCost}‚Ç¨`;
                    }
                } else {
                    locationText = '√Ä distance (visio/t√©l√©phone)';
                }
                
                const dateObj = new Date(data.date + 'T00:00:00');
                const dateFormatted = dateObj.toLocaleDateString('fr-FR', { 
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                });
                
                // Construire les notes compl√®tes
                let fullNotes = `üìç ${locationText}\n`;
                if (data.message) {
                    fullNotes += `\nüí¨ Message du client:\n${data.message}`;
                }
                
                // Enregistrer dans Firestore
                const bookingData = {
                    clientName: `${data.firstName} ${data.lastName}`,
                    clientEmail: data.email,
                    phone: data.phone,
                    date: data.date,
                    dateFormatted: dateFormatted,
                    time: data.time,
                    serviceName: data.service.name,
                    servicePrice: data.servicePrice,
                    location: data.location,
                    locationText: locationText,
                    address: data.address || '',
                    travelCost: data.travelCost,
                    travelDetails: data.travelDetails || '',
                    totalTTC: totalTTC,
                    notes: fullNotes,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Enregistrer la r√©servation
                await addDoc(collection(db, 'bookings'), bookingData);
                
                // Note: Envoi d'emails d√©sactiv√© pour l'instant
                // Les r√©servations sont visibles dans l'espace client et l'espace admin
                
                // Fermer les modals et r√©initialiser
                closeBookingSummary();
                closeBookingModal();
                
                // Message de succ√®s
                alert('‚úÖ Demande de r√©servation enregistr√©e !\n\nVotre demande est maintenant en attente de confirmation.\n\nVous pouvez la consulter dans votre espace client.\nJe vous recontacterai rapidement pour confirmer votre rendez-vous.');
                
            } catch (error) {
                console.error('Erreur lors de l\'enregistrement:', error);
                alert('‚ùå Une erreur est survenue lors de l\'enregistrement de votre r√©servation.\n\nVeuillez r√©essayer ou nous contacter directement par t√©l√©phone.');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Confirmer et envoyer';
            }
        };

        // ===== UI UPDATES =====
        function updateUIForUser(userData) {
            document.getElementById('btnLoginContainer').style.display = 'none';
            document.getElementById('userMenuContainer').style.display = 'block';
            document.getElementById('userName').textContent = userData.name || userData.email;
            
            // Afficher les bons boutons selon le r√¥le
            if (userData.role === 'admin') {
                document.getElementById('btnGoToAdminSpace').style.display = 'block';
                document.getElementById('btnGoToClientSpace').style.display = 'none';
            } else {
                document.getElementById('btnGoToAdminSpace').style.display = 'none';
                document.getElementById('btnGoToClientSpace').style.display = 'block';
            }
        }

        function updateUIForLogout() {
            document.getElementById('btnLoginContainer').style.display = 'block';
            document.getElementById('userMenuContainer').style.display = 'none';
            showPublicSite();
        }

        // ===== NAVIGATION =====
        const publicSections = ['accueil', 'services', 'reservation', 'temoignages', 'contact'];

        function hideAll() {
            publicSections.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            document.querySelectorAll('.about-section, .publications-section, .gallery, .testimonials, footer').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('clientSpace').style.display = 'none';
        }

        window.showPublicSite = () => {
            hideAll();
            publicSections.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'block';
            });
            document.querySelectorAll('.about-section, .publications-section, .testimonials, footer').forEach(el => {
                el.style.display = 'block';
            });
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.scrollToSection = (event, sectionId) => {
            event.preventDefault();
            
            // Toujours afficher le site public quand on clique sur un lien de navigation
            showPublicSite();
            
            // Scroller vers la section
            setTimeout(() => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        };

        window.showAdminDashboard = () => {
            hideAll();
            document.getElementById('adminDashboard').style.display = 'block';
            loadAdminData();
        };

        window.showClientSpace = async (email) => {
            hideAll();
            document.getElementById('clientSpace').style.display = 'block';
            await loadClientData(email);
        };

        window.switchAdminTab = (tab) => {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(c => c.style.display = 'none');
            
            const tabMapping = {
                'site': 'adminTabSite',
                'dashboard': 'adminTabDashboard',
                'quotes': 'adminTabQuotes',
                'invoices': 'adminTabInvoices',
                'expenses': 'adminTabExpenses',
                'treasury': 'adminTabTreasury',
                'bookings': 'adminTabBookings',
                'publications': 'adminTabPublications',
                'products': 'adminTabProducts',
                'settings': 'adminTabSettings'
            };
            
            document.querySelector(`[onclick="switchAdminTab('${tab}')"]`).classList.add('active');
            document.getElementById(tabMapping[tab]).style.display = 'block';
            
            if (tab === 'publications') {
                loadPublications();
            } else if (tab === 'quotes') {
                loadQuotes();
                loadClientsDropdown();
                loadServicesDropdown();
            } else if (tab === 'invoices') {
                loadInvoices();
                loadClientsDropdown();
                loadServicesDropdown();
            } else if (tab === 'expenses') {
                loadExpenses();
            } else if (tab === 'treasury') {
                loadTreasury();
            } else if (tab === 'bookings') {
                loadAdminBookings();
            } else if (tab === 'products') {
                loadProducts();
            } else if (tab === 'settings') {
                loadSettings();
            }
        };

        window.switchClientTab = (tab) => {
            document.querySelectorAll('.client-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.client-tab-content').forEach(c => c.style.display = 'none');
            
            document.querySelector(`[onclick="switchClientTab('${tab}')"]`).classList.add('active');
            document.getElementById(`clientTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).style.display = 'block';
            
            // Si on ouvre l'onglet nouvelle r√©servation, initialiser le calendrier client
            if (tab === 'newBooking') {
                setTimeout(() => {
                    initClientCalendar();
                }, 100);
            }
        };

        // ===== PUBLICATIONS =====
        window.togglePublicationForm = () => {
            const formContainer = document.getElementById('publicationFormContainer');
            const btnText = document.getElementById('btnToggleFormText');
            
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
                btnText.textContent = 'Masquer le formulaire';
                document.getElementById('publicationForm').reset();
                document.getElementById('publicationId').value = '';
                formContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                formContainer.style.display = 'none';
                btnText.textContent = 'Nouvelle Publication';
            }
        };

        window.cancelPublicationForm = () => {
            document.getElementById('publicationFormContainer').style.display = 'none';
            document.getElementById('btnToggleFormText').textContent = 'Nouvelle Publication';
            document.getElementById('publicationForm').reset();
        };

        window.editPublication = (postId) => {
            const formContainer = document.getElementById('publicationFormContainer');
            formContainer.style.display = 'block';
            document.getElementById('btnToggleFormText').textContent = 'Masquer le formulaire';
            loadPublicationForEdit(postId);
            formContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        };

        async function loadPublicationForEdit(postId) {
            try {
                const docSnap = await getDoc(doc(db, 'publications', postId));
                if (docSnap.exists()) {
                    const post = docSnap.data();
                    document.getElementById('publicationId').value = postId;
                    document.getElementById('publication-title').value = post.title || '';
                    document.getElementById('publication-content').value = post.content || '';
                    document.getElementById('publication-image').value = post.image || '';
                    document.getElementById('publication-tags').value = (post.tags || []).join(', ');
                }
            } catch (error) {
                console.error('Erreur chargement publication:', error);
            }
        }

        async function loadPublications() {
            try {
                const q = query(collection(db, 'publications'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                
                const container = document.getElementById('publicationsList');
                container.innerHTML = snapshot.empty ? '<p>Aucune publication. Cr√©ez-en une !</p>' : '';
                
                snapshot.forEach(docSnap => {
                    const post = docSnap.data();
                    const card = document.createElement('div');
                    card.className = 'publication-admin-card';
                    card.innerHTML = `
                        ${post.image ? `<img src="${post.image}" alt="${post.title}">` : ''}
                        <div class="publication-admin-content">
                            <h4>${post.title}</h4>
                            <p>${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</p>
                            ${post.tags && post.tags.length ? `<div class="post-tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>` : ''}
                            <div class="publication-admin-actions">
                                <button class="btn-icon" onclick="editPublication('${docSnap.id}')" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon" onclick="deletePublication('${docSnap.id}')" title="Supprimer" style="color: #dc3545;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Erreur chargement publications:', error);
            }
        }



        async function loadAllPublicPosts() {
            try {
                console.log('üîç Chargement des publications...');
                const q = query(collection(db, 'publications'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                console.log(`üìö ${snapshot.size} publication(s) trouv√©e(s)`);
                
                const container = document.getElementById('allPosts');
                if (!container) {
                    console.error('‚ùå Conteneur #allPosts introuvable');
                    return;
                }
                
                container.innerHTML = snapshot.empty ? '<p style="text-align: center; color: var(--text-color);">Aucune publication pour le moment</p>' : '';
                
                snapshot.forEach(docSnap => {
                    const post = docSnap.data();
                    const card = document.createElement('div');
                    card.className = 'publication-public-card';
                    card.style.cursor = 'pointer';
                    card.onclick = () => openPostModal(docSnap.id, post);
                    
                    // Formater la date
                    let dateStr = '';
                    if (post.createdAt) {
                        const date = new Date(post.createdAt);
                        dateStr = date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
                    }
                    
                    card.innerHTML = `
                        ${post.image ? `<div class="post-image" style="background-image: url('${post.image}')"></div>` : ''}
                        <div class="post-content">
                            <h3>${post.title}</h3>
                            <p class="post-excerpt">${post.content.substring(0, 180)}${post.content.length > 180 ? '...' : ''}</p>
                            ${post.tags && post.tags.length ? `<div class="post-tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>` : ''}
                            <div class="post-meta">
                                <span><i class="fas fa-user"></i> ${post.author || 'Sabrine SJK'}</span>
                                ${dateStr ? `<span><i class="fas fa-calendar"></i> ${dateStr}</span>` : ''}
                            </div>
                        </div>
                        <div class="read-more-overlay">
                            <i class="fas fa-book-open"></i> Lire la suite
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Erreur chargement publications publiques:', error);
                document.getElementById('allPosts').innerHTML = '<p style="text-align: center; color: var(--text-color);">Erreur de chargement des publications</p>';
            }
        }

        // Modal pour afficher les publications compl√®tes
        window.openPostModal = (postId, post) => {
            const modal = document.getElementById('postModal');
            const modalBody = document.getElementById('postModalBody');
            
            // Formater la date
            let dateStr = '';
            if (post.createdAt) {
                const date = new Date(post.createdAt);
                dateStr = date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
            }
            
            // Formater le contenu (convertir les sauts de ligne en paragraphes)
            const formattedContent = post.content.split('\n\n').map(para => 
                para.trim() ? `<p>${para.replace(/\n/g, '<br>')}</p>` : ''
            ).join('');
            
            modalBody.innerHTML = `
                ${post.image ? `<div class="post-modal-image" style="background-image: url('${post.image}')"></div>` : ''}
                <div class="post-modal-header">
                    <h2>${post.title}</h2>
                    <div class="post-modal-meta">
                        <span><i class="fas fa-user"></i> ${post.author || 'Sabrine SJK'}</span>
                        ${dateStr ? `<span><i class="fas fa-calendar"></i> ${dateStr}</span>` : ''}
                    </div>
                    ${post.tags && post.tags.length ? `<div class="post-tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>` : ''}
                </div>
                <div class="post-modal-content">
                    ${formattedContent}
                </div>
            `;
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        };

        window.closePostModal = () => {
            document.getElementById('postModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        window.deletePublication = async (postId) => {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette publication ?')) return;
            
            try {
                await deleteDoc(doc(db, 'publications', postId));
                alert('‚úÖ Publication supprim√©e');
                loadPublications();
                loadAllPublicPosts();
            } catch (error) {
                console.error('Erreur suppression:', error);
                alert('‚ùå Erreur lors de la suppression');
            }
        };

        // ===== GESTION DEVIS =====
        window.openQuoteModal = (id = null) => {
            document.getElementById('quoteModal').style.display = 'flex';
            document.getElementById('quoteModalTitle').textContent = id ? 'Modifier le devis' : 'Nouveau Devis';
            if (!id) {
                document.getElementById('quoteForm').reset();
                document.getElementById('quoteId').value = '';
                document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
            }
        };

        window.closeQuoteModal = () => {
            document.getElementById('quoteModal').style.display = 'none';
        };

        window.addQuoteItem = () => {
            const template = document.querySelector('.quote-item').cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = input.placeholder.includes('Qt√©') ? '1' : '');
            template.querySelector('.item-service-select').value = '';
            document.getElementById('quoteItems').appendChild(template);
            loadServicesDropdown();
        };

        window.removeQuoteItem = (btn) => {
            if (document.querySelectorAll('.quote-item').length > 1) {
                btn.closest('.quote-item').remove();
                calculateQuoteTotals();
            }
        };

        function calculateQuoteTotals() {
            let totalHT = 0;
            let totalVAT = 0;

            document.querySelectorAll('.quote-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const vat = parseFloat(item.querySelector('.item-vat').value) || 0;
                
                const lineHT = qty * price;
                const lineVAT = lineHT * (vat / 100);
                
                totalHT += lineHT;
                totalVAT += lineVAT;
            });

            document.getElementById('quoteTotalHT').textContent = totalHT.toFixed(2) + ' ‚Ç¨';
            document.getElementById('quoteTotalVAT').textContent = totalVAT.toFixed(2) + ' ‚Ç¨';
            document.getElementById('quoteTotalTTC').textContent = (totalHT + totalVAT).toFixed(2) + ' ‚Ç¨';
        }

        document.addEventListener('input', (e) => {
            if (e.target.closest('#quoteItems')) calculateQuoteTotals();
            if (e.target.closest('#invoiceItems')) calculateInvoiceTotals();
        });

        async function loadQuotes() {
            try {
                const q = query(collection(db, 'quotes'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                
                const tbody = document.getElementById('quotesList');
                tbody.innerHTML = snapshot.empty ? '<tr><td colspan="6">Aucun devis</td></tr>' : '';
                
                let pending = 0, accepted = 0, total = 0;
                
                snapshot.forEach(docSnap => {
                    const quote = docSnap.data();
                    const tr = document.createElement('tr');
                    
                    const statusClass = {
                        'draft': 'status-pending',
                        'sent': 'status-pending',
                        'accepted': 'status-confirmed',
                        'rejected': 'status-rejected'
                    }[quote.status] || 'status-pending';
                    
                    const statusText = {
                        'draft': 'Brouillon',
                        'sent': 'Envoy√©',
                        'accepted': 'Accept√©',
                        'rejected': 'Refus√©'
                    }[quote.status] || quote.status;
                    
                    tr.innerHTML = `
                        <td>${quote.number}</td>
                        <td>${quote.date}</td>
                        <td>${quote.clientName}</td>
                        <td>${quote.totalTTC.toFixed(2)} ‚Ç¨</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-icon" onclick="generateQuotePDF('${docSnap.id}')" title="G√©n√©rer PDF">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="btn-icon" onclick="editQuote('${docSnap.id}')" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteQuote('${docSnap.id}')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                    
                    if (quote.status === 'sent' || quote.status === 'draft') pending++;
                    if (quote.status === 'accepted') accepted++;
                    total += quote.totalTTC || 0;
                });
                
                document.getElementById('statQuotesPending').textContent = pending;
                document.getElementById('statQuotesAccepted').textContent = accepted;
                document.getElementById('statQuotesTotal').textContent = total.toFixed(0) + '‚Ç¨';
            } catch (error) {
                console.error('Erreur chargement devis:', error);
            }
        }

        window.deleteQuote = async (id) => {
            if (!confirm('Supprimer ce devis ?')) return;
            try {
                await deleteDoc(doc(db, 'quotes', id));
                loadQuotes();
            } catch (error) {
                console.error('Erreur suppression:', error);
            }
        };

        // ===== G√âN√âRATION PDF DEVIS =====
        window.generateQuotePDF = async (id) => {
            try {
                const docSnap = await getDoc(doc(db, 'quotes', id));
                if (!docSnap.exists()) {
                    alert('Devis introuvable');
                    return;
                }
                
                // Charger les settings
                const settingsSnap = await getDoc(doc(db, 'settings', 'company'));
                const settings = settingsSnap.exists() ? settingsSnap.data() : {};
                
                const quote = docSnap.data();
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                // Configuration des couleurs
                const primaryColor = [138, 43, 226];
                const darkGray = [60, 60, 60];
                const lightGray = [240, 240, 240];
                
                // En-t√™te
                pdf.setFillColor(...primaryColor);
                pdf.rect(0, 0, 210, 40, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont('helvetica', 'bold');
                pdf.text(settings.companyName || 'Sabrine SJK', 15, 18);
                
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text(settings.companyActivity || 'Th√©rapeute √ânerg√©tique', 15, 26);
                if (settings.companyEmail) pdf.text(`Email: ${settings.companyEmail}`, 15, 32);
                if (settings.companyPhone) pdf.text(`T√©l: ${settings.companyPhone}`, 15, 37);
                
                // Num√©ro de devis
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(16);
                pdf.setFont('helvetica', 'bold');
                pdf.text(`DEVIS N¬∞ ${quote.number}`, 105, 52, { align: 'center' });
                
                // Informations soci√©t√© √† gauche
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                let yPos = 60;
                if (settings.companyAddress) {
                    const addressLines = pdf.splitTextToSize(settings.companyAddress, 80);
                    pdf.text(addressLines, 15, yPos);
                    yPos += addressLines.length * 4;
                }
                if (settings.companySiret) pdf.text(`SIRET: ${settings.companySiret}`, 15, yPos);
                
                // Informations devis √† droite
                pdf.setFontSize(10);
                pdf.text(`Date: ${quote.date}`, 130, 60);
                pdf.text(`Validit√©: ${quote.validity || settings.quoteValidityDays || 30} jours`, 130, 66);
                
                // Informations client
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Client', 15, 85);
                
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                yPos = 92;
                pdf.text(quote.clientName, 15, yPos);
                if (quote.clientAddress) {
                    const clientAddressLines = pdf.splitTextToSize(quote.clientAddress, 80);
                    pdf.text(clientAddressLines, 15, yPos + 5);
                    yPos += clientAddressLines.length * 4 + 5;
                } else {
                    yPos += 5;
                }
                if (quote.clientEmail) pdf.text(quote.clientEmail, 15, yPos);
                if (quote.clientPhone) pdf.text(quote.clientPhone, 15, yPos + 5);
                
                // Tableau des prestations
                const tableData = quote.items.map(item => [
                    item.description,
                    item.quantity.toString(),
                    `${parseFloat(item.priceHT).toFixed(2)} ‚Ç¨`,
                    `${item.vat}%`,
                    `${(item.quantity * item.priceHT).toFixed(2)} ‚Ç¨`
                ]);
                
                pdf.autoTable({
                    startY: 115,
                    head: [['Description', 'Qt√©', 'Prix HT', 'TVA', 'Total HT']],
                    body: tableData,
                    theme: 'striped',
                    headStyles: { 
                        fillColor: primaryColor, 
                        textColor: 255, 
                        fontStyle: 'bold',
                        halign: 'center'
                    },
                    styles: { fontSize: 9, cellPadding: 3 },
                    columnStyles: {
                        0: { cellWidth: 80, halign: 'left' },
                        1: { cellWidth: 20, halign: 'center' },
                        2: { cellWidth: 28, halign: 'right' },
                        3: { cellWidth: 18, halign: 'center' },
                        4: { cellWidth: 28, halign: 'right' }
                    }
                });
                
                // Totaux
                const finalY = pdf.lastAutoTable.finalY + 10;
                
                pdf.setFillColor(...lightGray);
                pdf.rect(125, finalY, 70, 27, 'F');
                
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text('Total HT:', 130, finalY + 8);
                pdf.text(`${quote.totalHT.toFixed(2)} ‚Ç¨`, 190, finalY + 8, { align: 'right' });
                
                pdf.text('TVA:', 130, finalY + 16);
                pdf.text(`${quote.totalVAT.toFixed(2)} ‚Ç¨`, 190, finalY + 16, { align: 'right' });
                
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text('Total TTC:', 130, finalY + 24);
                pdf.text(`${quote.totalTTC.toFixed(2)} ‚Ç¨`, 190, finalY + 24, { align: 'right' });
                
                // Conditions et mentions l√©gales
                let conditionsY = finalY + 40;
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Conditions de paiement:', 15, conditionsY);
                
                pdf.setFont('helvetica', 'normal');
                conditionsY += 6;
                if (settings.companyPaymentTerms) {
                    const termsLines = pdf.splitTextToSize(settings.companyPaymentTerms, 180);
                    pdf.text(termsLines, 15, conditionsY);
                    conditionsY += termsLines.length * 4 + 4;
                } else {
                    pdf.text('Paiement par virement bancaire, esp√®ces ou ch√®que', 15, conditionsY);
                    conditionsY += 8;
                }
                
                pdf.setFont('helvetica', 'italic');
                pdf.setFontSize(8);
                if (settings.companyLegalMentions) {
                    const legalLines = pdf.splitTextToSize(settings.companyLegalMentions, 180);
                    pdf.text(legalLines, 15, conditionsY);
                    conditionsY += legalLines.length * 4;
                }
                
                if (quote.notes) {
                    conditionsY += 6;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Notes:', 15, conditionsY);
                    const splitNotes = pdf.splitTextToSize(quote.notes, 180);
                    pdf.text(splitNotes, 15, conditionsY + 4);
                }
                
                // Pied de page
                const pageHeight = pdf.internal.pageSize.height;
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                const footerText = `${settings.companyName || 'Sabrine SJK'} - ${settings.companyActivity || 'Th√©rapeute √ânerg√©tique'}${settings.companySiret ? ' - SIRET: ' + settings.companySiret : ''}`;
                pdf.text(footerText, 105, pageHeight - 10, { align: 'center' });
                
                // T√©l√©charger le PDF
                pdf.save(`Devis_${quote.number}.pdf`);
                
            } catch (error) {
                console.error('Erreur g√©n√©ration PDF:', error);
                alert('Erreur lors de la g√©n√©ration du PDF');
            }
        };

        // ===== GESTION FACTURES =====
        window.openInvoiceModal = (id = null) => {
            document.getElementById('invoiceModal').style.display = 'flex';
            document.getElementById('invoiceModalTitle').textContent = id ? 'Modifier la facture' : 'Nouvelle Facture';
            if (!id) {
                document.getElementById('invoiceForm').reset();
                document.getElementById('invoiceId').value = '';
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('invoiceDate').value = today;
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 30);
                document.getElementById('invoiceDueDate').value = dueDate.toISOString().split('T')[0];
            }
        };

        window.closeInvoiceModal = () => {
            document.getElementById('invoiceModal').style.display = 'none';
        };

        window.addInvoiceItem = () => {
            const template = document.querySelector('.invoice-item').cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = input.placeholder.includes('Qt√©') ? '1' : '');
            template.querySelector('.item-service-select').value = '';
            document.getElementById('invoiceItems').appendChild(template);
            loadServicesDropdown();
        };

        window.removeInvoiceItem = (btn) => {
            if (document.querySelectorAll('.invoice-item').length > 1) {
                btn.closest('.invoice-item').remove();
                calculateInvoiceTotals();
            }
        };

        function calculateInvoiceTotals() {
            let totalHT = 0;
            let totalVAT = 0;

            document.querySelectorAll('.invoice-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const vat = parseFloat(item.querySelector('.item-vat').value) || 0;
                
                const lineHT = qty * price;
                const lineVAT = lineHT * (vat / 100);
                
                totalHT += lineHT;
                totalVAT += lineVAT;
            });

            document.getElementById('invoiceTotalHT').textContent = totalHT.toFixed(2) + ' ‚Ç¨';
            document.getElementById('invoiceTotalVAT').textContent = totalVAT.toFixed(2) + ' ‚Ç¨';
            document.getElementById('invoiceTotalTTC').textContent = (totalHT + totalVAT).toFixed(2) + ' ‚Ç¨';
        }

        async function loadInvoices() {
            try {
                const q = query(collection(db, 'invoices'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                
                const tbody = document.getElementById('invoicesList');
                tbody.innerHTML = snapshot.empty ? '<tr><td colspan="6">Aucune facture</td></tr>' : '';
                
                let unpaid = 0, paid = 0, revenue = 0;
                
                snapshot.forEach(docSnap => {
                    const invoice = docSnap.data();
                    const tr = document.createElement('tr');
                    
                    const statusClass = {
                        'draft': 'status-pending',
                        'sent': 'status-pending',
                        'paid': 'status-confirmed',
                        'overdue': 'status-rejected',
                        'cancelled': 'status-rejected'
                    }[invoice.status] || 'status-pending';
                    
                    const statusText = {
                        'draft': 'Brouillon',
                        'sent': 'Envoy√©e',
                        'paid': 'Pay√©e',
                        'overdue': 'En retard',
                        'cancelled': 'Annul√©e'
                    }[invoice.status] || invoice.status;
                    
                    tr.innerHTML = `
                        <td>${invoice.number}</td>
                        <td>${invoice.date}</td>
                        <td>${invoice.clientName}</td>
                        <td>${invoice.totalTTC.toFixed(2)} ‚Ç¨</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-icon" onclick="generateInvoicePDF('${docSnap.id}')" title="G√©n√©rer PDF">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="btn-icon" onclick="editInvoice('${docSnap.id}')" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteInvoice('${docSnap.id}')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                    
                    if (invoice.status !== 'paid' && invoice.status !== 'cancelled') unpaid++;
                    if (invoice.status === 'paid') {
                        paid++;
                        revenue += invoice.totalTTC || 0;
                    }
                });
                
                document.getElementById('statInvoicesUnpaid').textContent = unpaid;
                document.getElementById('statInvoicesPaid').textContent = paid;
                document.getElementById('statInvoicesRevenue').textContent = revenue.toFixed(0) + '‚Ç¨';
            } catch (error) {
                console.error('Erreur chargement factures:', error);
            }
        }

        window.deleteInvoice = async (id) => {
            if (!confirm('Supprimer cette facture ?')) return;
            try {
                await deleteDoc(doc(db, 'invoices', id));
                loadInvoices();
            } catch (error) {
                console.error('Erreur suppression:', error);
            }
        };

        // ===== G√âN√âRATION PDF FACTURE =====
        window.generateInvoicePDF = async (id) => {
            try {
                const docSnap = await getDoc(doc(db, 'invoices', id));
                if (!docSnap.exists()) {
                    alert('Facture introuvable');
                    return;
                }
                
                // Charger les settings
                const settingsSnap = await getDoc(doc(db, 'settings', 'company'));
                const settings = settingsSnap.exists() ? settingsSnap.data() : {};
                
                const invoice = docSnap.data();
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                // Configuration des couleurs
                const primaryColor = [138, 43, 226];
                const darkGray = [60, 60, 60];
                const lightGray = [240, 240, 240];
                const greenColor = [34, 139, 34];
                
                // En-t√™te
                pdf.setFillColor(...primaryColor);
                pdf.rect(0, 0, 210, 40, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont('helvetica', 'bold');
                pdf.text(settings.companyName || 'Sabrine SJK', 15, 18);
                
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text(settings.companyActivity || 'Th√©rapeute √ânerg√©tique', 15, 26);
                if (settings.companyEmail) pdf.text(`Email: ${settings.companyEmail}`, 15, 32);
                if (settings.companyPhone) pdf.text(`T√©l: ${settings.companyPhone}`, 15, 37);
                
                // Num√©ro de facture
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(18);
                pdf.setFont('helvetica', 'bold');
                pdf.text(`FACTURE N¬∞ ${invoice.number}`, 105, 52, { align: 'center' });
                
                // Statut de paiement
                if (invoice.status === 'paid') {
                    pdf.setTextColor(...greenColor);
                    pdf.setFontSize(12);
                    pdf.text('‚úì PAY√âE', 105, 60, { align: 'center' });
                }
                
                // Informations soci√©t√© √† gauche
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                let yPos = 70;
                if (settings.companyAddress) {
                    const addressLines = pdf.splitTextToSize(settings.companyAddress, 80);
                    pdf.text(addressLines, 15, yPos);
                    yPos += addressLines.length * 4;
                }
                if (settings.companySiret) pdf.text(`SIRET: ${settings.companySiret}`, 15, yPos);
                
                // Informations facture √† droite
                pdf.setFontSize(10);
                pdf.text(`Date: ${invoice.date}`, 130, 70);
                pdf.text(`√âch√©ance: ${invoice.dueDate}`, 130, 76);
                
                // Informations client
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Factur√© √†', 15, 90);
                
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                yPos = 97;
                pdf.text(invoice.clientName, 15, yPos);
                if (invoice.clientAddress) {
                    const clientAddressLines = pdf.splitTextToSize(invoice.clientAddress, 80);
                    pdf.text(clientAddressLines, 15, yPos + 5);
                    yPos += clientAddressLines.length * 4 + 5;
                } else {
                    yPos += 5;
                }
                if (invoice.clientEmail) pdf.text(invoice.clientEmail, 15, yPos);
                if (invoice.clientPhone) pdf.text(invoice.clientPhone, 15, yPos + 5);
                
                // Tableau des prestations
                const tableData = invoice.items.map(item => [
                    item.description,
                    item.quantity.toString(),
                    `${parseFloat(item.priceHT).toFixed(2)} ‚Ç¨`,
                    `${item.vat}%`,
                    `${(item.quantity * item.priceHT).toFixed(2)} ‚Ç¨`
                ]);
                
                pdf.autoTable({
                    startY: 120,
                    head: [['Description', 'Qt√©', 'Prix HT', 'TVA', 'Total HT']],
                    body: tableData,
                    theme: 'striped',
                    headStyles: { 
                        fillColor: primaryColor, 
                        textColor: 255, 
                        fontStyle: 'bold',
                        halign: 'center'
                    },
                    styles: { fontSize: 9, cellPadding: 3 },
                    columnStyles: {
                        0: { cellWidth: 80, halign: 'left' },
                        1: { cellWidth: 20, halign: 'center' },
                        2: { cellWidth: 28, halign: 'right' },
                        3: { cellWidth: 18, halign: 'center' },
                        4: { cellWidth: 28, halign: 'right' }
                    }
                });
                
                // Totaux
                const finalY = pdf.lastAutoTable.finalY + 10;
                
                pdf.setFillColor(...lightGray);
                pdf.rect(125, finalY, 70, 20, 'F');
                
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text('Total HT:', 130, finalY + 8);
                pdf.text(`${invoice.totalHT.toFixed(2)} ‚Ç¨`, 190, finalY + 8, { align: 'right' });
                
                pdf.text('TVA:', 130, finalY + 15);
                pdf.text(`${invoice.totalVAT.toFixed(2)} ‚Ç¨`, 190, finalY + 15, { align: 'right' });
                
                // Total TTC mis en √©vidence
                pdf.setFillColor(...primaryColor);
                pdf.rect(125, finalY + 22, 70, 10, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text('Total TTC:', 130, finalY + 29);
                pdf.text(`${invoice.totalTTC.toFixed(2)} ‚Ç¨`, 190, finalY + 29, { align: 'right' });
                
                // Informations de paiement
                let paymentY = finalY + 45;
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Modalit√©s de paiement:', 15, paymentY);
                
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(9);
                paymentY += 6;
                
                if (settings.companyIban) {
                    pdf.text(`Virement bancaire: ${settings.companyIban}`, 15, paymentY);
                    paymentY += 5;
                }
                if (settings.companyBic) {
                    pdf.text(`BIC: ${settings.companyBic}`, 15, paymentY);
                    paymentY += 5;
                }
                pdf.text(`√âch√©ance de paiement: ${invoice.dueDate}`, 15, paymentY);
                paymentY += 8;
                
                // Mentions l√©gales
                pdf.setFontSize(8);
                pdf.setFont('helvetica', 'italic');
                if (settings.companyLegalMentions) {
                    const legalLines = pdf.splitTextToSize(settings.companyLegalMentions, 180);
                    pdf.text(legalLines, 15, paymentY);
                    paymentY += legalLines.length * 4;
                } else {
                    pdf.text('TVA non applicable, article 293 B du CGI', 15, paymentY);
                    paymentY += 4;
                }
                
                if (invoice.notes) {
                    paymentY += 6;
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Notes:', 15, paymentY);
                    const splitNotes = pdf.splitTextToSize(invoice.notes, 180);
                    pdf.text(splitNotes, 15, paymentY + 4);
                }
                
                // Pied de page
                const pageHeight = pdf.internal.pageSize.height;
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                const footerText = `${settings.companyName || 'Sabrine SJK'} - ${settings.companyActivity || 'Th√©rapeute √ânerg√©tique'}${settings.companySiret ? ' - SIRET: ' + settings.companySiret : ''}`;
                pdf.text(footerText, 105, pageHeight - 10, { align: 'center' });
                
                // T√©l√©charger le PDF
                pdf.save(`Facture_${invoice.number}.pdf`);
                
            } catch (error) {
                console.error('Erreur g√©n√©ration PDF:', error);
                alert('Erreur lors de la g√©n√©ration du PDF');
            }
        };

        // ===== GESTION D√âPENSES =====
        window.openExpenseModal = (id = null) => {
            document.getElementById('expenseModal').style.display = 'flex';
            document.getElementById('expenseModalTitle').textContent = id ? 'Modifier la d√©pense' : 'Nouvelle D√©pense';
            if (!id) {
                document.getElementById('expenseForm').reset();
                document.getElementById('expenseId').value = '';
                document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            }
        };

        window.closeExpenseModal = () => {
            document.getElementById('expenseModal').style.display = 'none';
        };

        async function loadExpenses() {
            try {
                const q = query(collection(db, 'expenses'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                
                const tbody = document.getElementById('expensesList');
                tbody.innerHTML = snapshot.empty ? '<tr><td colspan="5">Aucune d√©pense</td></tr>' : '';
                
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                let monthTotal = 0, yearTotal = 0;
                const categories = {};
                
                snapshot.forEach(docSnap => {
                    const expense = docSnap.data();
                    const expenseDate = new Date(expense.date);
                    const tr = document.createElement('tr');
                    
                    tr.innerHTML = `
                        <td>${expense.date}</td>
                        <td>${expense.description}</td>
                        <td><span class="badge">${expense.category}</span></td>
                        <td>${expense.amountTTC.toFixed(2)} ‚Ç¨</td>
                        <td>
                            <button class="btn-icon" onclick="editExpense('${docSnap.id}')" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteExpense('${docSnap.id}')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                    
                    if (expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear) {
                        monthTotal += expense.amountTTC || 0;
                    }
                    if (expenseDate.getFullYear() === currentYear) {
                        yearTotal += expense.amountTTC || 0;
                    }
                    
                    categories[expense.category] = (categories[expense.category] || 0) + expense.amountTTC;
                });
                
                document.getElementById('statExpensesMonth').textContent = monthTotal.toFixed(0) + '‚Ç¨';
                document.getElementById('statExpensesYear').textContent = yearTotal.toFixed(0) + '‚Ç¨';
                
                const topCategory = Object.keys(categories).sort((a, b) => categories[b] - categories[a])[0];
                document.getElementById('statExpensesCategory').textContent = topCategory || '-';
            } catch (error) {
                console.error('Erreur chargement d√©penses:', error);
            }
        }

        window.deleteExpense = async (id) => {
            if (!confirm('Supprimer cette d√©pense ?')) return;
            try {
                await deleteDoc(doc(db, 'expenses', id));
                loadExpenses();
                loadTreasury();
            } catch (error) {
                console.error('Erreur suppression:', error);
            }
        };

        // ===== TR√âSORERIE =====
        async function loadTreasury() {
            try {
                const invoicesSnap = await getDocs(query(collection(db, 'invoices'), where('status', '==', 'paid')));
                const expensesSnap = await getDocs(collection(db, 'expenses'));
                
                let income = 0, expenses = 0;
                
                invoicesSnap.forEach(doc => {
                    income += doc.data().totalTTC || 0;
                });
                
                expensesSnap.forEach(doc => {
                    expenses += doc.data().amountTTC || 0;
                });
                
                const balance = income - expenses;
                
                document.getElementById('statTreasuryIncome').textContent = income.toFixed(0) + '‚Ç¨';
                document.getElementById('statTreasuryExpenses').textContent = expenses.toFixed(0) + '‚Ç¨';
                document.getElementById('statTreasuryBalance').textContent = balance.toFixed(0) + '‚Ç¨';
                
                // Mouvements r√©cents
                const movements = [];
                invoicesSnap.forEach(doc => {
                    const data = doc.data();
                    movements.push({
                        date: data.date,
                        type: 'Recette',
                        description: `Facture ${data.number} - ${data.clientName}`,
                        amount: data.totalTTC
                    });
                });
                expensesSnap.forEach(doc => {
                    const data = doc.data();
                    movements.push({
                        date: data.date,
                        type: 'D√©pense',
                        description: data.description,
                        amount: -data.amountTTC
                    });
                });
                
                movements.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tbody = document.getElementById('treasuryMovements');
                tbody.innerHTML = movements.length === 0 ? '<tr><td colspan="4">Aucun mouvement</td></tr>' : '';
                
                movements.slice(0, 20).forEach(mov => {
                    const tr = document.createElement('tr');
                    const amountClass = mov.amount > 0 ? 'text-success' : 'text-danger';
                    const amountSign = mov.amount > 0 ? '+' : '';
                    
                    tr.innerHTML = `
                        <td>${mov.date}</td>
                        <td><span class="badge">${mov.type}</span></td>
                        <td>${mov.description}</td>
                        <td class="${amountClass}">${amountSign}${mov.amount.toFixed(2)} ‚Ç¨</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Erreur chargement tr√©sorerie:', error);
            }
        }

        // ===== GESTION R√âSERVATIONS ADMIN =====
        let adminBookingsCalendar = null;

        async function loadAdminBookings() {
            try {
                const q = query(collection(db, 'bookings'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                
                const tbody = document.getElementById('adminBookingsList');
                tbody.innerHTML = snapshot.empty ? '<tr><td colspan="7">Aucune r√©servation</td></tr>' : '';
                
                let pending = 0, confirmed = 0;
                const calendarEvents = [];
                
                snapshot.forEach(docSnap => {
                    const booking = docSnap.data();
                    const tr = document.createElement('tr');
                    
                    const statusClass = {
                        'pending': 'status-pending',
                        'confirmed': 'status-confirmed',
                        'cancelled': 'status-rejected'
                    }[booking.status] || 'status-pending';
                    
                    const statusText = {
                        'pending': 'En attente',
                        'confirmed': 'Confirm√©e',
                        'cancelled': 'Annul√©e'
                    }[booking.status] || booking.status;
                    
                    const hasInvoice = booking.invoiceGenerated ? ' style="opacity: 0.5;" disabled' : '';
                    const invoiceIcon = booking.invoiceGenerated ? '‚úì' : '';
                    
                    // Formater la date
                    const dateDisplay = booking.date ? new Date(booking.date).toLocaleDateString('fr-FR') : 'N/A';
                    const timeDisplay = booking.time || '';
                    
                    // Info localisation et montant
                    const locationInfo = booking.locationText || booking.location || '-';
                    const totalInfo = booking.totalTTC ? `${booking.totalTTC}‚Ç¨` : (booking.servicePrice ? `${booking.servicePrice}‚Ç¨` : '-');
                    
                    tr.innerHTML = `
                        <td>${dateDisplay} ${timeDisplay}</td>
                        <td>
                            <strong>${booking.clientName || booking.clientEmail}</strong><br>
                            <small style="color: var(--text-light);">${booking.clientEmail || ''}</small>
                        </td>
                        <td>
                            ${booking.serviceName || 'N/A'}<br>
                            <small style="color: var(--text-light);">${locationInfo}</small>
                        </td>
                        <td>${booking.phone || '-'}</td>
                        <td><strong style="color: var(--primary-color);">${totalInfo}</strong></td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-icon" onclick="viewBookingDetails('${docSnap.id}')" title="Voir d√©tails">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="generateBookingPDF('${docSnap.id}')" title="G√©n√©rer PDF" style="color: #d32f2f;">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="btn-icon" onclick="editBooking('${docSnap.id}')" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="createInvoiceFromBooking('${docSnap.id}')" title="Cr√©er une facture"${hasInvoice}>
                                <i class="fas fa-file-invoice-dollar"></i>${invoiceIcon}
                            </button>
                            <button class="btn-icon" onclick="updateBookingStatus('${docSnap.id}', 'confirmed')" title="Confirmer" style="color: #10b981;">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon" onclick="updateBookingStatus('${docSnap.id}', 'cancelled')" title="Annuler" style="color: #ef4444;">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteBooking('${docSnap.id}')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                    
                    if (booking.status === 'pending') pending++;
                    if (booking.status === 'confirmed') confirmed++;
                    
                    // Ajouter au calendrier
                    if (booking.date && booking.time) {
                        const eventColor = booking.status === 'confirmed' ? '#10b981' : booking.status === 'cancelled' ? '#ef4444' : '#f59e0b';
                        calendarEvents.push({
                            id: docSnap.id,
                            title: `${booking.serviceName || 'R√©servation'} - ${booking.clientName}`,
                            start: `${booking.date}T${booking.time}`,
                            backgroundColor: eventColor,
                            borderColor: eventColor,
                            extendedProps: {
                                clientName: booking.clientName,
                                phone: booking.phone,
                                status: booking.status,
                                totalTTC: booking.totalTTC || booking.servicePrice
                            }
                        });
                    }
                });
                
                document.getElementById('statBookingsPending').textContent = pending;
                document.getElementById('statBookingsConfirmed').textContent = confirmed;
                document.getElementById('statBookingsTotal').textContent = snapshot.size;
                
                // Initialiser ou mettre √† jour le calendrier
                initAdminBookingsCalendar(calendarEvents);
            } catch (error) {
                console.error('Erreur chargement r√©servations:', error);
                const tbody = document.getElementById('adminBookingsList');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: red;">Erreur de chargement des r√©servations</td></tr>';
                }
            }
        }

        function initAdminBookingsCalendar(events) {
            const calendarEl = document.getElementById('adminBookingsCalendar');
            if (!calendarEl) return;
            
            if (adminBookingsCalendar) {
                adminBookingsCalendar.removeAllEvents();
                adminBookingsCalendar.addEventSource(events);
            } else if (typeof FullCalendar !== 'undefined') {
                adminBookingsCalendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'fr',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    buttonText: {
                        today: "Aujourd'hui",
                        month: 'Mois',
                        week: 'Semaine',
                        day: 'Jour'
                    },
                    firstDay: 1,
                    height: 'auto',
                    events: events,
                    eventClick: (info) => {
                        editBooking(info.event.id);
                    },
                    dateClick: (info) => {
                        openNewBookingModal();
                        document.getElementById('newDate').value = info.dateStr;
                    }
                });
                adminBookingsCalendar.render();
            }
        }

        window.updateBookingStatus = async (id, status) => {
            try {
                await updateDoc(doc(db, 'bookings', id), { status });
                
                // Si la r√©servation est confirm√©e et n'a pas encore de facture, proposer d'en cr√©er une
                if (status === 'confirmed') {
                    const bookingDoc = await getDoc(doc(db, 'bookings', id));
                    const booking = bookingDoc.data();
                    
                    if (!booking.invoiceGenerated) {
                        const createInvoice = confirm('Voulez-vous cr√©er une facture pour cette r√©servation confirm√©e ?');
                        if (createInvoice) {
                            await createInvoiceFromBooking(id);
                        }
                    }
                }
                
                loadAdminBookings();
            } catch (error) {
                console.error('Erreur mise √† jour:', error);
            }
        };

        window.deleteBooking = async (id) => {
            if (!confirm('Supprimer cette r√©servation ?')) return;
            try {
                await deleteDoc(doc(db, 'bookings', id));
                loadAdminBookings();
            } catch (error) {
                console.error('Erreur suppression:', error);
            }
        };

        window.openNewBookingModal = () => {
            document.getElementById('newBookingModal').style.display = 'flex';
            document.getElementById('newBookingForm').reset();
            // Pr√©-remplir avec la date et l'heure actuelle
            const now = new Date();
            document.getElementById('newDate').value = now.toISOString().split('T')[0];
            document.getElementById('newTime').value = '10:00';
        };

        window.closeNewBookingModal = () => {
            document.getElementById('newBookingModal').style.display = 'none';
            document.getElementById('newBookingForm').reset();
        };

        window.createNewBooking = async (event) => {
            event.preventDefault();
            
            const bookingData = {
                clientName: document.getElementById('newClientName').value,
                clientEmail: document.getElementById('newClientEmail').value,
                phone: document.getElementById('newPhone').value,
                date: document.getElementById('newDate').value,
                time: document.getElementById('newTime').value,
                serviceName: document.getElementById('newService').value,
                status: document.getElementById('newStatus').value,
                notes: document.getElementById('newNotes').value,
                createdBy: 'admin',
                createdAt: new Date().toISOString()
            };
            
            try {
                const docRef = await addDoc(collection(db, 'bookings'), bookingData);
                
                // Si confirm√©e, proposer de cr√©er une facture
                if (bookingData.status === 'confirmed') {
                    const createInvoice = confirm('Voulez-vous cr√©er une facture pour cette r√©servation ?');
                    if (createInvoice) {
                        await createInvoiceFromBooking(docRef.id);
                    }
                }
                
                closeNewBookingModal();
                loadAdminBookings();
                alert('‚úÖ R√©servation cr√©√©e avec succ√®s !');
            } catch (error) {
                console.error('Erreur cr√©ation r√©servation:', error);
                alert('‚ùå Erreur lors de la cr√©ation de la r√©servation');
            }
        };

        window.editBooking = async (id) => {
            try {
                const docSnap = await getDoc(doc(db, 'bookings', id));
                if (docSnap.exists()) {
                    const booking = docSnap.data();
                    
                    document.getElementById('editBookingId').value = id;
                    document.getElementById('editClientName').value = booking.clientName || '';
                    document.getElementById('editClientEmail').value = booking.clientEmail || '';
                    document.getElementById('editPhone').value = booking.phone || '';
                    document.getElementById('editDate').value = booking.date || '';
                    document.getElementById('editTime').value = booking.time || '';
                    document.getElementById('editService').value = booking.serviceName || '';
                    document.getElementById('editStatus').value = booking.status || 'pending';
                    document.getElementById('editNotes').value = booking.notes || '';
                    
                    document.getElementById('editBookingModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Erreur chargement r√©servation:', error);
                alert('‚ùå Erreur lors du chargement de la r√©servation');
            }
        };

        window.closeEditBookingModal = () => {
            document.getElementById('editBookingModal').style.display = 'none';
            document.getElementById('editBookingForm').reset();
        };

        window.saveBooking = async (event) => {
            event.preventDefault();
            
            const id = document.getElementById('editBookingId').value;
            const updatedBooking = {
                clientName: document.getElementById('editClientName').value,
                clientEmail: document.getElementById('editClientEmail').value,
                phone: document.getElementById('editPhone').value,
                date: document.getElementById('editDate').value,
                time: document.getElementById('editTime').value,
                serviceName: document.getElementById('editService').value,
                status: document.getElementById('editStatus').value,
                notes: document.getElementById('editNotes').value,
                updatedAt: new Date().toISOString()
            };
            
            try {
                await updateDoc(doc(db, 'bookings', id), updatedBooking);
                closeEditBookingModal();
                loadAdminBookings();
                alert('‚úÖ R√©servation modifi√©e avec succ√®s !');
            } catch (error) {
                console.error('Erreur modification r√©servation:', error);
                alert('‚ùå Erreur lors de la modification');
            }
        };

        // ===== G√âN√âRATION PDF R√âSERVATION =====
        window.generateBookingPDF = async (bookingId) => {
            try {
                const bookingDoc = await getDoc(doc(db, 'bookings', bookingId));
                if (!bookingDoc.exists()) {
                    alert('‚ùå R√©servation introuvable');
                    return;
                }
                
                const booking = bookingDoc.data();
                
                // Charger les param√®tres de la soci√©t√©
                const settingsDoc = await getDoc(doc(db, 'settings', 'company'));
                const settings = settingsDoc.exists() ? settingsDoc.data() : {};
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Couleurs
                const primaryColor = [139, 92, 246];
                const secondaryColor = [236, 72, 153];
                const textColor = [51, 51, 51];
                
                // En-t√™te avec d√©grad√©
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 40, 'F');
                
                // Titre
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont('helvetica', 'bold');
                doc.text('CONFIRMATION DE R√âSERVATION', 105, 20, { align: 'center' });
                
                // Statut
                const statusText = booking.status === 'confirmed' ? 'CONFIRM√âE' : 
                                  booking.status === 'cancelled' ? 'ANNUL√âE' : 'EN ATTENTE';
                const statusColor = booking.status === 'confirmed' ? [16, 185, 129] :
                                   booking.status === 'cancelled' ? [239, 68, 68] : [245, 158, 11];
                
                doc.setFontSize(14);
                doc.text(statusText, 105, 32, { align: 'center' });
                
                // Informations soci√©t√©
                doc.setTextColor(...textColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(settings.companyName || 'Sabrine SJK', 20, 50);
                doc.setFont('helvetica', 'normal');
                doc.text(settings.companyActivity || 'Th√©rapeute √ânerg√©tique', 20, 55);
                
                if (settings.companyAddress) {
                    const addressLines = doc.splitTextToSize(settings.companyAddress, 80);
                    doc.text(addressLines, 20, 60);
                }
                
                doc.text(settings.companyEmail || '', 20, 75);
                doc.text(settings.companyPhone || '', 20, 80);
                
                // Informations client
                doc.setFont('helvetica', 'bold');
                doc.text('CLIENT', 130, 50);
                doc.setFont('helvetica', 'normal');
                doc.text(booking.clientName || '', 130, 55);
                doc.text(booking.clientEmail || '', 130, 60);
                doc.text(booking.phone || '', 130, 65);
                
                // Ligne de s√©paration
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(0.5);
                doc.line(20, 90, 190, 90);
                
                // D√©tails de la r√©servation
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('D√âTAILS DE LA R√âSERVATION', 20, 100);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                // Tableau des informations
                const details = [
                    ['Date', booking.date || 'N/A'],
                    ['Heure', booking.time || 'N/A'],
                    ['Service', booking.serviceName || 'N/A'],
                    ['Dur√©e estim√©e', '60 minutes']
                ];
                
                let yPos = 110;
                details.forEach(([label, value]) => {
                    doc.setFont('helvetica', 'bold');
                    doc.text(label + ':', 30, yPos);
                    doc.setFont('helvetica', 'normal');
                    doc.text(value, 80, yPos);
                    yPos += 8;
                });
                
                // Notes si pr√©sentes
                if (booking.notes) {
                    doc.setFont('helvetica', 'bold');
                    doc.text('Notes:', 30, yPos + 5);
                    doc.setFont('helvetica', 'normal');
                    const notesLines = doc.splitTextToSize(booking.notes, 140);
                    doc.text(notesLines, 30, yPos + 12);
                    yPos += notesLines.length * 5 + 15;
                }
                
                // Informations importantes
                doc.setFillColor(249, 250, 251);
                doc.rect(20, yPos + 10, 170, 40, 'F');
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...primaryColor);
                doc.text('üìã INFORMATIONS IMPORTANTES', 25, yPos + 20);
                
                doc.setFontSize(9);
                doc.setTextColor(...textColor);
                doc.setFont('helvetica', 'normal');
                doc.text('‚Ä¢ Merci d\'arriver 5 minutes avant l\'heure pr√©vue', 25, yPos + 28);
                doc.text('‚Ä¢ En cas d\'emp√™chement, pr√©venez-nous au moins 24h √† l\'avance', 25, yPos + 34);
                doc.text('‚Ä¢ Pr√©voyez une tenue confortable', 25, yPos + 40);
                
                // Pied de page
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text('Ce document a √©t√© g√©n√©r√© automatiquement le ' + new Date().toLocaleDateString('fr-FR'), 105, 280, { align: 'center' });
                
                if (settings.companyLegalMentions) {
                    const legalLines = doc.splitTextToSize(settings.companyLegalMentions, 170);
                    doc.text(legalLines, 105, 285, { align: 'center' });
                }
                
                // Sauvegarder le PDF
                const fileName = `Reservation_${booking.clientName?.replace(/\s+/g, '_')}_${booking.date}.pdf`;
                doc.save(fileName);
                
            } catch (error) {
                console.error('Erreur g√©n√©ration PDF:', error);
                alert('‚ùå Erreur lors de la g√©n√©ration du PDF');
            }
        };

        // ===== CR√âER R√âSERVATION DEPUIS FACTURE =====
        async function createBookingFromInvoice(invoiceId, invoiceData) {
            try {
                // Extraire le premier service de la facture
                const firstItem = invoiceData.items && invoiceData.items.length > 0 ? invoiceData.items[0] : null;
                const serviceName = firstItem ? firstItem.description : 'Prestation';
                
                const bookingData = {
                    clientName: invoiceData.clientName,
                    clientEmail: invoiceData.clientEmail,
                    phone: invoiceData.clientPhone || '',
                    date: invoiceData.date,
                    time: '10:00', // Heure par d√©faut
                    serviceName: serviceName,
                    status: 'confirmed',
                    notes: `Cr√©√© depuis facture ${invoiceData.number}`,
                    invoiceId: invoiceId,
                    invoiceNumber: invoiceData.number,
                    createdAt: new Date().toISOString()
                };
                
                await addDoc(collection(db, 'bookings'), bookingData);
                console.log('‚úÖ R√©servation cr√©√©e depuis la facture');
            } catch (error) {
                console.error('Erreur cr√©ation r√©servation:', error);
            }
        }

        // ===== CR√âER FACTURE DEPUIS R√âSERVATION =====
        window.createInvoiceFromBooking = async (bookingId) => {
            try {
                const bookingDoc = await getDoc(doc(db, 'bookings', bookingId));
                if (!bookingDoc.exists()) {
                    alert('‚ùå R√©servation introuvable');
                    return;
                }
                
                const booking = bookingDoc.data();
                
                // R√©cup√©rer le prix du service
                const servicePrices = {
                    'Reiki': 60,
                    'Lahochi': 70,
                    'Massage': 50,
                    'Meditation': 40,
                    'M√©ditation guid√©e': 40,
                    'Consultation': 55,
                    'Massage bien-√™tre': 50,
                    'Autre': 50
                };
                
                const serviceName = booking.serviceName || booking.service || 'Prestation';
                const servicePrice = servicePrices[serviceName] || 50;
                
                // G√©n√©rer le num√©ro de facture
                const invoicesSnap = await getDocs(collection(db, 'invoices'));
                const invoiceNumber = 'F' + String(invoicesSnap.size + 1).padStart(5, '0');
                
                // Cr√©er la facture
                const invoiceData = {
                    number: invoiceNumber,
                    date: booking.date || new Date().toISOString().split('T')[0],
                    dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    clientName: booking.clientName,
                    clientEmail: booking.clientEmail,
                    clientPhone: booking.phone || '',
                    clientAddress: '',
                    items: [{
                        description: serviceName,
                        quantity: 1,
                        unitPrice: servicePrice,
                        vatRate: 0,
                        total: servicePrice
                    }],
                    totalHT: servicePrice,
                    totalVAT: 0,
                    totalTTC: servicePrice,
                    status: 'draft',
                    bookingId: bookingId,
                    createdAt: new Date().toISOString()
                };
                
                await addDoc(collection(db, 'invoices'), invoiceData);
                
                // Mettre √† jour la r√©servation avec l'info de facturation
                await updateDoc(doc(db, 'bookings', bookingId), {
                    invoiceGenerated: true,
                    invoiceNumber: invoiceNumber
                });
                
                alert(`‚úÖ Facture ${invoiceNumber} cr√©√©e avec succ√®s !`);
                switchAdminTab('invoices');
                loadInvoices();
            } catch (error) {
                console.error('Erreur cr√©ation facture:', error);
                alert('‚ùå Erreur lors de la cr√©ation de la facture');
            }
        };

        // ===== GESTION PERSONNALISATION =====
        async function loadSettings() {
            try {
                const docRef = doc(db, 'settings', 'company');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const settings = docSnap.data();
                    
                    // Informations soci√©t√©
                    document.getElementById('companyName').value = settings.companyName || '';
                    document.getElementById('companyActivity').value = settings.companyActivity || '';
                    document.getElementById('companyAddress').value = settings.companyAddress || '';
                    document.getElementById('companyEmail').value = settings.companyEmail || '';
                    document.getElementById('companyPhone').value = settings.companyPhone || '';
                    document.getElementById('companySiret').value = settings.companySiret || '';
                    document.getElementById('companyVat').value = settings.companyVat || '';
                    document.getElementById('companyIban').value = settings.companyIban || '';
                    document.getElementById('companyBic').value = settings.companyBic || '';
                    document.getElementById('ownerFirstName').value = settings.ownerFirstName || '';
                    document.getElementById('ownerLastName').value = settings.ownerLastName || '';
                    document.getElementById('companyLegalMentions').value = settings.companyLegalMentions || '';
                    document.getElementById('companyPaymentTerms').value = settings.companyPaymentTerms || '';
                    document.getElementById('quoteValidityDays').value = settings.quoteValidityDays || 30;
                    
                    // Apparence du site
                    if (settings.siteColorPrimary) {
                        document.getElementById('siteColorPrimary').value = settings.siteColorPrimary;
                        document.getElementById('siteColorPrimaryText').value = settings.siteColorPrimary;
                    }
                    if (settings.siteColorSecondary) {
                        document.getElementById('siteColorSecondary').value = settings.siteColorSecondary;
                        document.getElementById('siteColorSecondaryText').value = settings.siteColorSecondary;
                    }
                    document.getElementById('siteLogo').value = settings.siteLogo || '';
                    document.getElementById('siteSlogan').value = settings.siteSlogan || '';
                    
                    // Typographie et espacements
                    if (document.getElementById('siteFontPrimary')) {
                        document.getElementById('siteFontPrimary').value = settings.siteFontPrimary || "'Poppins', sans-serif";
                        document.getElementById('siteFontSecondary').value = settings.siteFontSecondary || "'Cormorant Garamond', serif";
                        document.getElementById('siteBaseFontSize').value = settings.siteBaseFontSize || 16;
                        document.getElementById('siteSectionPadding').value = settings.siteSectionPadding || 80;
                        document.getElementById('siteBorderRadius').value = settings.siteBorderRadius || 12;
                        document.getElementById('siteShadowIntensity').value = settings.siteShadowIntensity || 'medium';
                    }
                    
                    // Activer le template s√©lectionn√©
                    if (settings.colorTemplate) {
                        document.querySelector(`[data-template="${settings.colorTemplate}"]`)?.classList.add('active');
                    } else {
                        document.querySelector('[data-template="purple-pink"]')?.classList.add('active');
                    }
                    
                    // R√©seaux sociaux
                    document.getElementById('socialFacebook').value = settings.socialFacebook || '';
                    document.getElementById('socialInstagram').value = settings.socialInstagram || '';
                    document.getElementById('socialLinkedin').value = settings.socialLinkedin || '';
                    document.getElementById('socialWhatsapp').value = settings.socialWhatsapp || '';
                    
                    // Horaires
                    if (settings.workingDays) {
                        document.getElementById('dayMonday').checked = settings.workingDays.monday !== false;
                        document.getElementById('dayTuesday').checked = settings.workingDays.tuesday !== false;
                        document.getElementById('dayWednesday').checked = settings.workingDays.wednesday !== false;
                        document.getElementById('dayThursday').checked = settings.workingDays.thursday !== false;
                        document.getElementById('dayFriday').checked = settings.workingDays.friday !== false;
                        document.getElementById('daySaturday').checked = settings.workingDays.saturday === true;
                        document.getElementById('daySunday').checked = settings.workingDays.sunday === true;
                    }
                    document.getElementById('openingTime').value = settings.openingTime || '09:00';
                    document.getElementById('closingTime').value = settings.closingTime || '18:00';
                    document.getElementById('defaultSessionDuration').value = settings.defaultSessionDuration || 60;
                    
                    // Notifications
                    document.getElementById('notificationEmail').value = settings.notificationEmail || '';
                    document.getElementById('autoConfirmBookings').checked = settings.autoConfirmBookings || false;
                }
            } catch (error) {
                console.error('Erreur chargement param√®tres:', error);
            }
        }

        // ===== ALIMENTER DROPDOWNS =====
        async function loadClientsDropdown() {
            try {
                // R√©cup√©rer tous les clients des r√©servations et utilisateurs
                const bookingsSnap = await getDocs(collection(db, 'bookings'));
                const usersSnap = await getDocs(collection(db, 'users'));
                
                const clientsMap = new Map();
                
                bookingsSnap.forEach(doc => {
                    const data = doc.data();
                    const key = data.clientEmail || data.phone;
                    if (key && !clientsMap.has(key)) {
                        clientsMap.set(key, {
                            name: data.clientName || `${data.firstname || ''} ${data.lastname || ''}`.trim(),
                            email: data.clientEmail || data.email,
                            phone: data.phone,
                            address: data.address || ''
                        });
                    }
                });
                
                usersSnap.forEach(doc => {
                    const data = doc.data();
                    if (data.role !== 'admin' && data.email) {
                        if (!clientsMap.has(data.email)) {
                            clientsMap.set(data.email, {
                                name: data.displayName || `${data.firstname || ''} ${data.lastname || ''}`.trim(),
                                email: data.email,
                                phone: data.phone || '',
                                address: data.address || ''
                            });
                        }
                    }
                });
                
                // Alimenter les dropdowns
                const quoteSelect = document.getElementById('quoteSelectClient');
                const invoiceSelect = document.getElementById('invoiceSelectClient');
                
                if (quoteSelect) {
                    quoteSelect.innerHTML = '<option value="">-- S√©lectionner ou saisir manuellement --</option>';
                    clientsMap.forEach((client, key) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${client.name} - ${client.email || client.phone}`;
                        option.dataset.name = client.name;
                        option.dataset.email = client.email;
                        option.dataset.phone = client.phone;
                        option.dataset.address = client.address;
                        quoteSelect.appendChild(option);
                    });
                }
                
                if (invoiceSelect) {
                    invoiceSelect.innerHTML = '<option value="">-- S√©lectionner ou saisir manuellement --</option>';
                    clientsMap.forEach((client, key) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${client.name} - ${client.email || client.phone}`;
                        option.dataset.name = client.name;
                        option.dataset.email = client.email;
                        option.dataset.phone = client.phone;
                        option.dataset.address = client.address;
                        invoiceSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Erreur chargement clients:', error);
            }
        }

        async function loadServicesDropdown() {
            try {
                // Charger les services depuis Firebase
                const productsSnap = await getDocs(collection(db, 'products'));
                const services = [];
                
                productsSnap.forEach(docSnap => {
                    const product = docSnap.data();
                    // N'afficher que les produits/services actifs
                    if (product.active !== false) {
                        services.push({
                            name: product.name,
                            price: product.price || 0,
                            description: product.description || ''
                        });
                    }
                });
                
                // Si aucun service en base, utiliser les services par d√©faut
                if (services.length === 0) {
                    services.push(
                        { name: 'Reiki Usui - S√©ance 1h', price: 60, description: 'S√©ance de Reiki Usui d\'1 heure' },
                        { name: 'Lahochi - S√©ance 1h', price: 60, description: 'S√©ance de Lahochi d\'1 heure' },
                        { name: 'Soin Intuitif - S√©ance 1h', price: 60, description: 'Soin intuitif personnalis√© d\'1 heure' },
                        { name: 'Magn√©tisme - S√©ance 45min', price: 50, description: 'S√©ance de magn√©tisme de 45 minutes' },
                        { name: 'Pack 3 s√©ances Reiki', price: 150, description: 'Forfait 3 s√©ances de Reiki' },
                        { name: 'Pack 5 s√©ances mixtes', price: 250, description: 'Forfait 5 s√©ances (Reiki + Lahochi + Magn√©tisme)' }
                    );
                }
                
                // Alimenter tous les dropdowns de prestations
                document.querySelectorAll('.item-service-select').forEach(select => {
                    select.innerHTML = '<option value="">-- Choisir une prestation ou saisir manuellement --</option>';
                    services.forEach(service => {
                        const option = document.createElement('option');
                        option.value = service.name;
                        option.textContent = `${service.name} - ${service.price}‚Ç¨`;
                        option.dataset.price = service.price;
                        option.dataset.description = service.description;
                        select.appendChild(option);
                    });
                });
            } catch (error) {
                console.error('Erreur chargement services:', error);
            }
        }

        // ===== AUTO-REMPLISSAGE =====
        window.fillClientInfo = (formType) => {
            const selectId = formType === 'quote' ? 'quoteSelectClient' : 'invoiceSelectClient';
            const select = document.getElementById(selectId);
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const prefix = formType === 'quote' ? 'quote' : 'invoice';
                document.getElementById(`${prefix}ClientName`).value = selectedOption.dataset.name || '';
                document.getElementById(`${prefix}ClientEmail`).value = selectedOption.dataset.email || '';
                document.getElementById(`${prefix}ClientPhone`).value = selectedOption.dataset.phone || '';
                document.getElementById(`${prefix}ClientAddress`).value = selectedOption.dataset.address || '';
            }
        };

        window.fillServiceInfo = (selectElement) => {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            
            if (selectedOption.value) {
                const parent = selectElement.closest('.quote-item, .invoice-item');
                const descInput = parent.querySelector('.item-description');
                const priceInput = parent.querySelector('.item-price');
                
                descInput.value = selectedOption.dataset.description || selectedOption.value;
                priceInput.value = selectedOption.dataset.price || '';
                
                // D√©clencher le calcul des totaux
                if (parent.closest('#quoteItems')) {
                    calculateQuoteTotals();
                } else if (parent.closest('#invoiceItems')) {
                    calculateInvoiceTotals();
                }
            }
        };

        // ===== IA POUR PUBLICATIONS (VERSION AM√âLIOR√âE) =====
        window.generateAIContent = () => {
            const prompt = document.getElementById('ai-prompt').value.trim();
            if (!prompt) {
                alert('‚ö†Ô∏è Veuillez entrer quelques mots-cl√©s ou id√©es pour g√©n√©rer du contenu');
                return;
            }
            
            document.getElementById('ai-loading').style.display = 'block';
            
            // G√©n√©ration avec templates intelligents
            setTimeout(() => {
                const generatedContent = generateContentFromPrompt(prompt);
                const suggestedTitle = generateTitleFromPrompt(prompt);
                
                document.getElementById('publication-content').value = generatedContent;
                
                // Sugg√©rer un titre si le champ est vide
                if (!document.getElementById('publication-title').value) {
                    document.getElementById('publication-title').value = suggestedTitle;
                }
                
                // Mise √† jour du compteur de caract√®res
                document.getElementById('char-count').textContent = generatedContent.length;
                
                document.getElementById('ai-loading').style.display = 'none';
                
                alert('‚ú® Contenu g√©n√©r√© avec succ√®s ! Vous pouvez le personnaliser avant publication.');
            }, 1800);
        };

        function generateTitleFromPrompt(prompt) {
            const keywords = prompt.toLowerCase();
            
            if (keywords.includes('reiki')) return 'üåü Les Bienfaits du Reiki';
            if (keywords.includes('lahochi')) return 'üåà D√©couvrez le Lahochi';
            if (keywords.includes('stress') || keywords.includes('anxi√©t√©')) return 'üßò‚Äç‚ôÄÔ∏è G√©rer le Stress Naturellement';
            if (keywords.includes('sommeil') || keywords.includes('insomnie')) return 'üò¥ Retrouver un Sommeil R√©parateur';
            if (keywords.includes('m√©ditation')) return 'üßò Les Vertus de la M√©ditation';
            if (keywords.includes('massage')) return 'üíÜ‚Äç‚ôÄÔ∏è Les Bienfaits du Massage √ânerg√©tique';
            if (keywords.includes('chakra')) return 'üíé Harmoniser ses Chakras';
            if (keywords.includes('√©nergie')) return '‚ú® L\'√ânergie de Gu√©rison';
            
            // Titre g√©n√©rique bas√© sur les premiers mots
            const words = prompt.split(' ').slice(0, 5).join(' ');
            return words.charAt(0).toUpperCase() + words.slice(1);
        }

        function generateContentFromPrompt(prompt) {
            const keywords = prompt.toLowerCase();
            let content = '';
            
            // Templates bas√©s sur les mots-cl√©s
            if (keywords.includes('reiki')) {
                content = `üåü Le Reiki : Une √ânergie de Gu√©rison Profonde\n\n` +
                    `Le Reiki est une pratique √©nerg√©tique japonaise ancestrale qui favorise l'harmonisation du corps, de l'esprit et de l'√¢me. ` +
                    `Cette technique douce permet de:\n\n` +
                    `‚ú® R√©duire le stress et l'anxi√©t√©\n` +
                    `‚ú® Am√©liorer la qualit√© du sommeil\n` +
                    `‚ú® Renforcer le syst√®me immunitaire\n` +
                    `‚ú® Apaiser les douleurs physiques et √©motionnelles\n\n` +
                    `Pendant une s√©ance, l'√©nergie universelle circule √† travers mes mains pour r√©√©quilibrer vos centres √©nerg√©tiques. ` +
                    `Vous ressentirez une profonde relaxation et un bien-√™tre durable.\n\n` +
                    `üí´ Prenez soin de vous, offrez-vous un moment de paix int√©rieure.\n\n` +
                    `#Reiki #Bien√ätre #EnergieDeGu√©rison #RelaxationProfonde`;
            } else if (keywords.includes('lahochi') || keywords.includes('la ho chi')) {
                content = `üåà Lahochi : L'√ânergie de Lumi√®re Divine\n\n` +
                    `Le Lahochi est une technique √©nerg√©tique puissante qui travaille sur les plans physique, √©motionnel, mental et spirituel. ` +
                    `Cette √©nergie de haute fr√©quence permet de:\n\n` +
                    `üíé Lib√©rer les blocages √©nerg√©tiques\n` +
                    `üíé Acc√©l√©rer le processus de gu√©rison\n` +
                    `üíé Harmoniser les chakras\n` +
                    `üíé √âlever votre taux vibratoire\n\n` +
                    `Lors d'une s√©ance, vous pourrez ressentir chaleur, picotements ou une sensation de l√©g√®ret√©. ` +
                    `Chaque personne vit une exp√©rience unique adapt√©e √† ses besoins du moment.\n\n` +
                    `‚ú® Reconnectez-vous √† votre essence divine.\n\n` +
                    `#Lahochi #SoinEnerg√©tique #Gu√©risonHolistique #√âl√©vationVibratoire`;
            } else if (keywords.includes('stress') || keywords.includes('anxi√©t√©')) {
                content = `üßò‚Äç‚ôÄÔ∏è Lib√©rez-vous du Stress et de l'Anxi√©t√©\n\n` +
                    `Dans notre monde moderne, le stress et l'anxi√©t√© font partie du quotidien de nombreuses personnes. ` +
                    `Les soins √©nerg√©tiques offrent une solution naturelle et efficace pour retrouver votre √©quilibre.\n\n` +
                    `Comment les soins peuvent vous aider:\n\n` +
                    `üå∏ Calmer le mental et les pens√©es envahissantes\n` +
                    `üå∏ Rel√¢cher les tensions physiques accumul√©es\n` +
                    `üå∏ Retrouver un sommeil r√©parateur\n` +
                    `üå∏ Renforcer votre ancrage et votre s√©r√©nit√©\n\n` +
                    `Chaque s√©ance est un moment privil√©gi√© pour vous reconnecter √† vous-m√™me, ` +
                    `dans un espace s√©curisant et bienveillant.\n\n` +
                    `üíö Vous m√©ritez la paix int√©rieure.\n\n` +
                    `#GestionDuStress #Anxi√©t√© #Bien√ätreMental #Soins√ânerg√©tiques`;
            } else if (keywords.includes('sommeil') || keywords.includes('insomnie')) {
                content = `üò¥ Retrouvez un Sommeil R√©parateur\n\n` +
                    `Le sommeil est essentiel √† notre sant√© physique et mentale. Les troubles du sommeil peuvent affecter ` +
                    `toute notre qualit√© de vie. Les soins √©nerg√©tiques sont une approche douce pour:\n\n` +
                    `üåô Apaiser le mental avant le coucher\n` +
                    `üåô Lib√©rer les tensions accumul√©es\n` +
                    `üåô R√©√©quilibrer votre √©nergie vitale\n` +
                    `üåô Favoriser un sommeil profond et r√©cup√©rateur\n\n` +
                    `De nombreuses personnes constatent une am√©lioration significative de leur sommeil ` +
                    `d√®s les premi√®res s√©ances.\n\n` +
                    `‚ú® Offrez-vous des nuits paisibles et r√©paratrices.\n\n` +
                    `#Sommeil #Insomnie #SommeilR√©parateur #Bien√ätre`;
            } else if (keywords.includes('massage')) {
                content = `üíÜ‚Äç‚ôÄÔ∏è Les Bienfaits du Massage √ânerg√©tique\n\n` +
                    `Le massage √©nerg√©tique combine les techniques de toucher th√©rapeutique et le travail sur les √©nergies ` +
                    `pour une exp√©rience de bien-√™tre compl√®te.\n\n` +
                    `B√©n√©fices imm√©diats:\n\n` +
                    `üå∫ D√©tente musculaire profonde\n` +
                    `üå∫ Am√©lioration de la circulation √©nerg√©tique\n` +
                    `üå∫ Lib√©ration des tensions √©motionnelles\n` +
                    `üå∫ Sensation de l√©g√®ret√© et de vitalit√©\n\n` +
                    `Chaque massage est adapt√© √† vos besoins sp√©cifiques, dans le respect de votre corps et de vos limites.\n\n` +
                    `üí´ Accordez-vous ce moment de d√©tente absolue.\n\n` +
                    `#Massage√ânerg√©tique #D√©tente #Bien√ätre #RelaxationProfonde`;
            } else if (keywords.includes('m√©ditation') || keywords.includes('meditation')) {
                content = `üßò La M√©ditation : Un Chemin vers la Paix Int√©rieure\n\n` +
                    `La m√©ditation guid√©e est un outil puissant pour cultiver la pr√©sence, la conscience et la s√©r√©nit√©. ` +
                    `Dans nos s√©ances, vous apprendrez √†:\n\n` +
                    `üåü Calmer le flot des pens√©es\n` +
                    `üåü Vous ancrer dans le moment pr√©sent\n` +
                    `üåü D√©velopper votre intuition\n` +
                    `üåü Cr√©er un espace de paix en vous\n\n` +
                    `Que vous soyez d√©butant ou pratiquant confirm√©, je vous guide avec douceur vers un √©tat de ` +
                    `relaxation profonde et de connexion √† votre essence.\n\n` +
                    `‚ú® D√©couvrez le pouvoir transformateur de la m√©ditation.\n\n` +
                    `#M√©ditation #Mindfulness #PleinConsciece #PaixInt√©rieure`;
            } else if (keywords.includes('chakra')) {
                content = `üíé Harmoniser vos Chakras pour un √âquilibre Optimal\n\n` +
                    `Les chakras sont des centres √©nerg√©tiques essentiels √† notre bien-√™tre global. Lorsqu'ils sont ` +
                    `√©quilibr√©s et harmonis√©s, l'√©nergie circule librement.\n\n` +
                    `Un travail sur les chakras permet de:\n\n` +
                    `üîÆ Restaurer l'√©quilibre √©nerg√©tique\n` +
                    `üîÆ Lib√©rer les blocages √©motionnels\n` +
                    `üîÆ Renforcer votre vitalit√©\n` +
                    `üîÆ Aligner corps, esprit et √¢me\n\n` +
                    `Chaque s√©ance commence par un bilan √©nerg√©tique pour identifier les chakras n√©cessitant ` +
                    `une attention particuli√®re.\n\n` +
                    `üåà Retrouvez votre alignement int√©rieur.\n\n` +
                    `#Chakras #√âquilibre√ânerg√©tique #Gu√©risonHolistique #Bien√ätre`;
            } else if (keywords.includes('douleur') || keywords.includes('douleurs')) {
                content = `üåø Soulager les Douleurs par l'√ânergie\n\n` +
                    `Les douleurs physiques ont souvent une composante √©nerg√©tique et √©motionnelle. Les soins √©nerg√©tiques ` +
                    `travaillent sur ces diff√©rents plans pour un soulagement durable.\n\n` +
                    `Comment l'√©nergie peut vous aider:\n\n` +
                    `üíö Apaiser les tensions musculaires\n` +
                    `üíö R√©duire l'inflammation\n` +
                    `üíö Lib√©rer les m√©moires corporelles\n` +
                    `üíö Favoriser la r√©g√©n√©ration naturelle\n\n` +
                    `Les soins √©nerg√©tiques compl√®tent parfaitement un suivi m√©dical classique et peuvent acc√©l√©rer ` +
                    `le processus de gu√©rison.\n\n` +
                    `‚ú® Votre corps a un pouvoir d'auto-gu√©rison extraordinaire.\n\n` +
                    `#SoulagerLesDouleurs #Gu√©risonNaturelle #Soins√ânerg√©tiques #Bien√ätre`;
            } else {
                content = `‚ú® ${prompt}\n\n` +
                    `Dans ma pratique de th√©rapeute √©nerg√©tique, je vous accompagne avec bienveillance sur votre chemin de gu√©rison et d'√©volution personnelle.\n\n` +
                    `Les soins √©nerg√©tiques permettent de:\n\n` +
                    `üåü Lib√©rer les blocages √©motionnels\n` +
                    `üåü Harmoniser votre √©nergie vitale\n` +
                    `üåü Retrouver √©quilibre et s√©r√©nit√©\n` +
                    `üåü Renforcer votre connexion √† vous-m√™me\n\n` +
                    `Chaque s√©ance est unique et adapt√©e √† vos besoins sp√©cifiques. Je suis l√† pour vous guider ` +
                    `dans ce processus de transformation en toute s√©curit√©.\n\n` +
                    `üí´ Prenez soin de vous, vous le m√©ritez.\n\n` +
                    `#Soins√ânerg√©tiques #Bien√ätre #Gu√©risonHolistique #D√©veloppementPersonnel`;
            }
            
            return content;
        }

        // ===== DATA LOADING =====
        async function loadAdminData() {
            try {
                const bookingsSnap = await getDocs(collection(db, 'bookings'));
                const clientsSnap = await getDocs(collection(db, 'users'));
                
                document.getElementById('statBookings').textContent = bookingsSnap.size;
                document.getElementById('statClients').textContent = clientsSnap.size;
                
                const tbody = document.getElementById('adminBookingsTable');
                tbody.innerHTML = bookingsSnap.empty ? '<tr><td colspan="4">Aucune r√©servation</td></tr>' : '';
                
                bookingsSnap.forEach(docSnap => {
                    const booking = docSnap.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${booking.date || 'N/A'}</td>
                        <td>${booking.clientName || booking.clientEmail}</td>
                        <td>${booking.service || 'N/A'}</td>
                        <td><span class="status-badge status-${booking.status || 'pending'}">${booking.status || 'En attente'}</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Erreur chargement admin:', error);
            }
        }

        async function loadClientData(email) {
            try {
                const q = query(collection(db, 'bookings'), where('clientEmail', '==', email));
                const snapshot = await getDocs(q);
                
                // Trier c√¥t√© client par date de cr√©ation (plus r√©cent en premier)
                const bookings = [];
                snapshot.forEach(docSnap => {
                    bookings.push({ id: docSnap.id, data: docSnap.data() });
                });
                bookings.sort((a, b) => {
                    const dateA = a.data.createdAt?.toDate?.() || new Date(a.data.createdAt || 0);
                    const dateB = b.data.createdAt?.toDate?.() || new Date(b.data.createdAt || 0);
                    return dateB - dateA;
                });
                
                const container = document.getElementById('clientBookingsList');
                container.innerHTML = bookings.length === 0 ? '<p style="text-align: center; padding: 2rem; color: var(--text-color);">Aucune r√©servation pour le moment</p>' : '';
                
                bookings.forEach(item => {
                    const booking = item.data;
                    const bookingId = item.id;
                    const card = document.createElement('div');
                    card.className = 'booking-card';
                    
                    // Statut en fran√ßais
                    let statusText = 'En attente';
                    let statusClass = 'pending';
                    if (booking.status === 'confirmed') {
                        statusText = 'Confirm√©e';
                        statusClass = 'confirmed';
                    } else if (booking.status === 'cancelled') {
                        statusText = 'Annul√©e';
                        statusClass = 'cancelled';
                    } else if (booking.status === 'completed') {
                        statusText = 'Termin√©e';
                        statusClass = 'completed';
                    }
                    
                    // Formater la date
                    let dateFormatted = 'Date √† confirmer';
                    if (booking.date) {
                        try {
                            dateFormatted = new Date(booking.date).toLocaleDateString('fr-FR', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });
                        } catch (e) {
                            dateFormatted = booking.date;
                        }
                    }
                    
                    // Ic√¥ne et texte de localisation
                    let locationIcon = 'üìç';
                    let locationText = 'Lieu √† confirmer';
                    if (booking.location === 'cabinet') {
                        locationIcon = 'üè†';
                        locationText = 'Au cabinet';
                    } else if (booking.location === 'domicile') {
                        locationIcon = 'üöó';
                        locationText = booking.address ? `√Ä domicile - ${booking.address}` : '√Ä domicile';
                    } else if (booking.location === 'distance') {
                        locationIcon = 'üìû';
                        locationText = '√Ä distance (visio/t√©l√©phone)';
                    }
                    
                    card.innerHTML = `
                        <div class="booking-header">
                            <span class="booking-number">#${bookingId.substring(0, 8)}</span>
                            <span class="booking-status status-${statusClass}">${statusText}</span>
                        </div>
                        <h3>${booking.serviceName || 'Service'}</h3>
                        <p><i class="fas fa-calendar"></i> ${dateFormatted}</p>
                        <p><i class="fas fa-clock"></i> ${booking.time || 'Heure √† confirmer'}</p>
                        <p style="margin: 0.5rem 0;">${locationIcon} ${locationText}</p>
                        ${booking.servicePrice ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                                <p style="margin: 0.25rem 0; font-size: 0.95rem;"><strong>Prix service:</strong> ${booking.servicePrice}‚Ç¨</p>
                                ${booking.travelCost ? `<p style="margin: 0.25rem 0; font-size: 0.95rem;"><strong>Frais d√©placement:</strong> ${booking.travelCost}‚Ç¨</p>` : ''}
                                ${booking.totalTTC ? `<p style="font-weight: 600; color: var(--primary-color); font-size: 1.1rem; margin-top: 0.5rem;"><i class="fas fa-euro-sign"></i> Total TTC: ${booking.totalTTC}‚Ç¨</p>` : ''}
                            </div>
                        ` : ''}
                        ${booking.status === 'pending' ? `
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;" onclick="alert('Fonction √† venir')">Modifier</button>
                                <button class="btn" style="flex: 1; font-size: 0.9rem; background: #dc3545;" onclick="alert('Fonction √† venir')">Annuler</button>
                            </div>
                        ` : ''}
                    `;
                    container.appendChild(card);
                });

                // Initialiser le calendrier client si on est dans l'espace client
                setTimeout(() => {
                    initClientCalendar();
                }, 200);
            } catch (error) {
                console.error('Erreur chargement client:', error);
                const container = document.getElementById('clientBookingsList');
                if (container) {
                    container.innerHTML = '<p style="text-align: center; padding: 2rem; color: red;">Erreur de chargement des r√©servations</p>';
                }
            }
        }

        // ===== AI ASSISTANT =====
        // Fonction de comptage de caract√®res
        function updateCharCount() {
            const content = document.getElementById('publication-content').value;
            document.getElementById('char-count').textContent = content.length;
        }

        // Mettre √† jour le compteur en temps r√©el
        document.getElementById('publication-content')?.addEventListener('input', updateCharCount);

        // ===== AUTH EVENTS =====
        // ===== TEMPLATES DE COULEURS =====
        window.applyColorTemplate = (templateName) => {
            const templates = {
                'purple-pink': { primary: '#8B5CF6', secondary: '#EC4899' },
                'blue-teal': { primary: '#3B82F6', secondary: '#06B6D4' },
                'green-emerald': { primary: '#10B981', secondary: '#059669' },
                'orange-red': { primary: '#F97316', secondary: '#EF4444' },
                'indigo-purple': { primary: '#6366F1', secondary: '#8B5CF6' },
                'rose-pink': { primary: '#F43F5E', secondary: '#EC4899' }
            };
            
            const template = templates[templateName];
            if (template) {
                document.getElementById('siteColorPrimary').value = template.primary;
                document.getElementById('siteColorPrimaryText').value = template.primary;
                document.getElementById('siteColorSecondary').value = template.secondary;
                document.getElementById('siteColorSecondaryText').value = template.secondary;
                
                // Highlight le template s√©lectionn√©
                document.querySelectorAll('.color-template').forEach(t => t.classList.remove('active'));
                document.querySelector(`[data-template="${templateName}"]`)?.classList.add('active');
            }
        };

        // ===== FONCTIONS DE PR√âVISUALISATION =====
        
        // Pr√©visualisation Devis
        window.previewQuote = () => {
            const quoteData = {
                number: document.getElementById('quoteNumber').value || 'DEV-XXXX',
                date: document.getElementById('quoteDate').value || new Date().toLocaleDateString('fr-FR'),
                validity: document.getElementById('quoteValidity').value || '30',
                clientName: document.getElementById('quoteClientName').value || '[Nom du client]',
                clientEmail: document.getElementById('quoteClientEmail').value || '[Email]',
                clientPhone: document.getElementById('quoteClientPhone').value || '[T√©l√©phone]',
                clientAddress: document.getElementById('quoteClientAddress').value || '[Adresse]',
                status: document.getElementById('quoteStatus').value || 'draft'
            };
            
            const items = [];
            document.querySelectorAll('.quote-item').forEach(item => {
                const desc = item.querySelector('.item-description').value || '[Description]';
                const qty = item.querySelector('.item-quantity').value || 1;
                const price = item.querySelector('.item-price').value || 0;
                const vat = item.querySelector('.item-vat').value || 20;
                items.push({ description: desc, quantity: qty, price: price, vat: vat });
            });
            
            let itemsHTML = items.map(item => 
                `<tr>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>${parseFloat(item.price).toFixed(2)} ‚Ç¨</td>
                    <td>${item.vat}%</td>
                </tr>`
            ).join('');
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        üìã Pr√©visualisation du Devis
                    </h2>
                    <div style="margin: 20px 0;">
                        <p><strong>N¬∞ Devis:</strong> ${quoteData.number}</p>
                        <p><strong>Date:</strong> ${quoteData.date}</p>
                        <p><strong>Validit√©:</strong> ${quoteData.validity} jours</p>
                        <p><strong>Statut:</strong> ${quoteData.status}</p>
                    </div>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Client</h3>
                        <p><strong>Nom:</strong> ${quoteData.clientName}</p>
                        <p><strong>Email:</strong> ${quoteData.clientEmail}</p>
                        <p><strong>T√©l√©phone:</strong> ${quoteData.clientPhone}</p>
                        <p><strong>Adresse:</strong> ${quoteData.clientAddress}</p>
                    </div>
                    <h3>Prestations</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #8B5CF6; color: white;">
                                <th style="padding: 10px; text-align: left;">Description</th>
                                <th style="padding: 10px; text-align: center;">Qt√©</th>
                                <th style="padding: 10px; text-align: right;">Prix HT</th>
                                <th style="padding: 10px; text-align: center;">TVA</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Enregistrer" pour cr√©er le devis.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=900,height=700');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Pr√©visualisation Facture
        window.previewInvoice = () => {
            const invoiceData = {
                number: document.getElementById('invoiceNumber').value || 'FA-XXXX',
                date: document.getElementById('invoiceDate').value || new Date().toLocaleDateString('fr-FR'),
                dueDate: document.getElementById('invoiceDueDate').value || '√Ä d√©finir',
                clientName: document.getElementById('invoiceClientName').value || '[Nom du client]',
                clientEmail: document.getElementById('invoiceClientEmail').value || '[Email]',
                clientPhone: document.getElementById('invoiceClientPhone').value || '[T√©l√©phone]',
                clientAddress: document.getElementById('invoiceClientAddress').value || '[Adresse]',
                status: document.getElementById('invoiceStatus').value || 'draft'
            };
            
            const items = [];
            document.querySelectorAll('.invoice-item').forEach(item => {
                const desc = item.querySelector('.item-description').value || '[Description]';
                const qty = item.querySelector('.item-quantity').value || 1;
                const price = item.querySelector('.item-price').value || 0;
                const vat = item.querySelector('.item-vat').value || 20;
                items.push({ description: desc, quantity: qty, price: price, vat: vat });
            });
            
            let itemsHTML = items.map(item => 
                `<tr>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>${parseFloat(item.price).toFixed(2)} ‚Ç¨</td>
                    <td>${item.vat}%</td>
                </tr>`
            ).join('');
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        üí∞ Pr√©visualisation de la Facture
                    </h2>
                    <div style="margin: 20px 0;">
                        <p><strong>N¬∞ Facture:</strong> ${invoiceData.number}</p>
                        <p><strong>Date:</strong> ${invoiceData.date}</p>
                        <p><strong>√âch√©ance:</strong> ${invoiceData.dueDate}</p>
                        <p><strong>Statut:</strong> ${invoiceData.status}</p>
                    </div>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Client</h3>
                        <p><strong>Nom:</strong> ${invoiceData.clientName}</p>
                        <p><strong>Email:</strong> ${invoiceData.clientEmail}</p>
                        <p><strong>T√©l√©phone:</strong> ${invoiceData.clientPhone}</p>
                        <p><strong>Adresse:</strong> ${invoiceData.clientAddress}</p>
                    </div>
                    <h3>Prestations</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #8B5CF6; color: white;">
                                <th style="padding: 10px; text-align: left;">Description</th>
                                <th style="padding: 10px; text-align: center;">Qt√©</th>
                                <th style="padding: 10px; text-align: right;">Prix HT</th>
                                <th style="padding: 10px; text-align: center;">TVA</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Enregistrer" pour cr√©er la facture.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=900,height=700');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Pr√©visualisation D√©pense
        window.previewExpense = () => {
            const expenseData = {
                date: document.getElementById('expenseDate').value || new Date().toLocaleDateString('fr-FR'),
                category: document.getElementById('expenseCategory').value || '[Cat√©gorie]',
                description: document.getElementById('expenseDescription').value || '[Description]',
                amountHT: document.getElementById('expenseAmountHT').value || '0.00',
                vat: document.getElementById('expenseVAT').value || '20',
                amountTTC: document.getElementById('expenseAmountTTC').value || '0.00',
                supplier: document.getElementById('expenseSupplier').value || '[Fournisseur]',
                notes: document.getElementById('expenseNotes').value || '[Aucune note]'
            };
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        üßæ Pr√©visualisation de la D√©pense
                    </h2>
                    <div style="margin: 20px 0;">
                        <p><strong>Date:</strong> ${expenseData.date}</p>
                        <p><strong>Cat√©gorie:</strong> ${expenseData.category}</p>
                        <p><strong>Description:</strong> ${expenseData.description}</p>
                    </div>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Montants</h3>
                        <p><strong>Montant HT:</strong> ${parseFloat(expenseData.amountHT).toFixed(2)} ‚Ç¨</p>
                        <p><strong>TVA:</strong> ${expenseData.vat}%</p>
                        <p><strong>Montant TTC:</strong> ${parseFloat(expenseData.amountTTC).toFixed(2)} ‚Ç¨</p>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <p><strong>Fournisseur:</strong> ${expenseData.supplier}</p>
                        <p><strong>Notes:</strong> ${expenseData.notes}</p>
                    </div>
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Enregistrer" pour cr√©er la d√©pense.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=900,height=700');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Pr√©visualisation Nouvelle R√©servation
        window.previewNewBooking = () => {
            const bookingData = {
                clientName: document.getElementById('newClientName').value || '[Nom du client]',
                clientEmail: document.getElementById('newClientEmail').value || '[Email]',
                phone: document.getElementById('newPhone').value || '[T√©l√©phone]',
                date: document.getElementById('newDate').value || '√Ä d√©finir',
                time: document.getElementById('newTime').value || '√Ä d√©finir',
                service: document.getElementById('newService').selectedOptions[0]?.text || '[Service]',
                status: document.getElementById('newStatus').value || 'pending',
                notes: document.getElementById('newNotes').value || 'Aucune note'
            };
            
            const statusColors = {
                pending: '#F59E0B',
                confirmed: '#10B981',
                cancelled: '#EF4444'
            };
            
            const statusLabels = {
                pending: 'En attente',
                confirmed: 'Confirm√©e',
                cancelled: 'Annul√©e'
            };
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        üìÖ Pr√©visualisation de la R√©servation
                    </h2>
                    <div style="background: ${statusColors[bookingData.status]}; color: white; padding: 10px; border-radius: 8px; margin: 20px 0; text-align: center; font-weight: bold;">
                        Statut: ${statusLabels[bookingData.status]}
                    </div>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Informations Client</h3>
                        <p><strong>Nom:</strong> ${bookingData.clientName}</p>
                        <p><strong>Email:</strong> ${bookingData.clientEmail}</p>
                        <p><strong>T√©l√©phone:</strong> ${bookingData.phone}</p>
                    </div>
                    <div style="background: #e0e7ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">D√©tails de la S√©ance</h3>
                        <p><strong>Service:</strong> ${bookingData.service}</p>
                        <p><strong>Date:</strong> ${bookingData.date}</p>
                        <p><strong>Heure:</strong> ${bookingData.time}</p>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Notes</h3>
                        <p>${bookingData.notes}</p>
                    </div>
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Cr√©er la r√©servation" pour l'enregistrer.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=900,height=700');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Pr√©visualisation Modification R√©servation
        window.previewEditBooking = () => {
            const bookingData = {
                clientName: document.getElementById('editClientName').value || '[Nom du client]',
                clientEmail: document.getElementById('editClientEmail').value || '[Email]',
                phone: document.getElementById('editPhone').value || '[T√©l√©phone]',
                date: document.getElementById('editDate').value || '√Ä d√©finir',
                time: document.getElementById('editTime').value || '√Ä d√©finir',
                service: document.getElementById('editService').selectedOptions[0]?.text || '[Service]',
                status: document.getElementById('editStatus').value || 'pending',
                notes: document.getElementById('editNotes').value || 'Aucune note'
            };
            
            const statusColors = {
                pending: '#F59E0B',
                confirmed: '#10B981',
                cancelled: '#EF4444'
            };
            
            const statusLabels = {
                pending: 'En attente',
                confirmed: 'Confirm√©e',
                cancelled: 'Annul√©e'
            };
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        ‚úèÔ∏è Pr√©visualisation de la Modification
                    </h2>
                    <div style="background: ${statusColors[bookingData.status]}; color: white; padding: 10px; border-radius: 8px; margin: 20px 0; text-align: center; font-weight: bold;">
                        Statut: ${statusLabels[bookingData.status]}
                    </div>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Informations Client</h3>
                        <p><strong>Nom:</strong> ${bookingData.clientName}</p>
                        <p><strong>Email:</strong> ${bookingData.clientEmail}</p>
                        <p><strong>T√©l√©phone:</strong> ${bookingData.phone}</p>
                    </div>
                    <div style="background: #e0e7ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">D√©tails de la S√©ance</h3>
                        <p><strong>Service:</strong> ${bookingData.service}</p>
                        <p><strong>Date:</strong> ${bookingData.date}</p>
                        <p><strong>Heure:</strong> ${bookingData.time}</p>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Notes</h3>
                        <p>${bookingData.notes}</p>
                    </div>
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Enregistrer" pour sauvegarder les modifications.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=900,height=700');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Pr√©visualisation Param√®tres - Aper√ßu du site complet
        window.previewSettings = () => {
            const settingsData = {
                companyName: document.getElementById('companyName').value || 'Votre Entreprise',
                companyActivity: document.getElementById('companyActivity').value || 'Th√©rapeute',
                companyAddress: document.getElementById('companyAddress').value || 'Votre adresse',
                companyPhone: document.getElementById('companyPhone').value || '06 00 00 00 00',
                companyEmail: document.getElementById('companyEmail').value || 'contact@exemple.fr',
                slogan: document.getElementById('siteSlogan').value || 'Votre bien-√™tre, notre priorit√©',
                primaryColor: document.getElementById('siteColorPrimary').value || '#8B5CF6',
                secondaryColor: document.getElementById('siteColorSecondary').value || '#EC4899',
                fontPrimary: document.getElementById('siteFontPrimary')?.value || "'Poppins', sans-serif",
                fontSecondary: document.getElementById('siteFontSecondary')?.value || "'Cormorant Garamond', serif",
                baseFontSize: document.getElementById('siteBaseFontSize')?.value || '16',
                sectionPadding: document.getElementById('siteSectionPadding')?.value || '80',
                borderRadius: document.getElementById('siteBorderRadius')?.value || '12',
                shadowIntensity: document.getElementById('siteShadowIntensity')?.value || 'medium'
            };

            const shadows = {
                light: '0 2px 10px rgba(0,0,0,0.05)',
                medium: '0 4px 20px rgba(0,0,0,0.1)',
                strong: '0 8px 30px rgba(0,0,0,0.15)'
            };
            
            const previewHTML = `
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aper√ßu - ${settingsData.companyName}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&family=Lato:wght@300;400;700&family=Raleway:wght@300;400;500;600;700&family=Nunito:wght@300;400;600;700&family=Playfair+Display:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=Libre+Baskerville:wght@400;700&family=Crimson+Text:wght@400;600;700&family=Lora:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: ${settingsData.primaryColor};
            --secondary: ${settingsData.secondaryColor};
            --font-primary: ${settingsData.fontPrimary};
            --font-secondary: ${settingsData.fontSecondary};
            --base-size: ${settingsData.baseFontSize}px;
            --section-padding: ${settingsData.sectionPadding}px;
            --radius: ${settingsData.borderRadius}px;
            --shadow: ${shadows[settingsData.shadowIntensity]};
        }
        body {
            font-family: var(--font-primary);
            font-size: var(--base-size);
            line-height: 1.6;
            color: #333;
        }
        .preview-banner {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: calc(var(--section-padding) / 2) 0;
            text-align: center;
        }
        header h1 {
            font-family: var(--font-secondary);
            font-size: calc(var(--base-size) * 2.5);
            margin-bottom: 10px;
        }
        header p {
            font-size: calc(var(--base-size) * 1.2);
            opacity: 0.95;
        }
        nav {
            background: white;
            padding: 20px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 50px;
            z-index: 999;
        }
        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: var(--radius);
            transition: all 0.3s;
        }
        nav a:hover {
            background: var(--primary);
            color: white;
        }
        section {
            padding: var(--section-padding) 5%;
        }
        section:nth-child(even) { background: #f9fafb; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h2 {
            font-family: var(--font-secondary);
            font-size: calc(var(--base-size) * 2);
            color: var(--primary);
            margin-bottom: 30px;
            text-align: center;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover { transform: translateY(-5px); }
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: var(--radius);
            font-size: calc(var(--base-size) * 1.1);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
        footer {
            background: #1f2937;
            color: white;
            padding: calc(var(--section-padding) / 2) 5%;
            text-align: center;
        }
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }
        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        .contact-item i {
            color: var(--primary);
            font-size: calc(var(--base-size) * 1.5);
        }
    </style>
</head>
<body>
    <div class="preview-banner">
        üîç APER√áU DU SITE - Cette pr√©visualisation montre l'apparence avec vos modifications
    </div>
    
    <header>
        <h1>${settingsData.companyName}</h1>
        <p>${settingsData.slogan}</p>
    </header>

    <nav>
        <ul>
            <li><a href="#"><i class="fas fa-home"></i> Accueil</a></li>
            <li><a href="#"><i class="fas fa-spa"></i> Services</a></li>
            <li><a href="#"><i class="fas fa-calendar"></i> R√©servation</a></li>
            <li><a href="#"><i class="fas fa-phone"></i> Contact</a></li>
        </ul>
    </nav>

    <section>
        <div class="container">
            <h2>√Ä propos</h2>
            <div class="card">
                <p style="text-align: center; font-size: calc(var(--base-size) * 1.1);">
                    ${settingsData.companyActivity} - Un accompagnement personnalis√© pour votre bien-√™tre
                </p>
            </div>
        </div>
    </section>

    <section>
        <div class="container">
            <h2>Nos Services</h2>
            <div class="grid">
                <div class="card">
                    <h3 style="color: var(--primary); font-family: var(--font-secondary);">Service 1</h3>
                    <p>Description du service avec tous les d√©tails importants.</p>
                    <p style="color: var(--secondary); font-weight: bold; margin-top: 15px;">60‚Ç¨ - 1h</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">R√©server</button>
                </div>
                <div class="card">
                    <h3 style="color: var(--primary); font-family: var(--font-secondary);">Service 2</h3>
                    <p>Description du service avec tous les d√©tails importants.</p>
                    <p style="color: var(--secondary); font-weight: bold; margin-top: 15px;">50‚Ç¨ - 45min</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">R√©server</button>
                </div>
                <div class="card">
                    <h3 style="color: var(--primary); font-family: var(--font-secondary);">Service 3</h3>
                    <p>Description du service avec tous les d√©tails importants.</p>
                    <p style="color: var(--secondary); font-weight: bold; margin-top: 15px;">70‚Ç¨ - 1h30</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">R√©server</button>
                </div>
            </div>
        </div>
    </section>

    <section>
        <div class="container">
            <h2>Contact</h2>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                        <strong>Adresse</strong><br>
                        ${settingsData.companyAddress}
                    </div>
                </div>
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <div>
                        <strong>T√©l√©phone</strong><br>
                        ${settingsData.companyPhone}
                    </div>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <div>
                        <strong>Email</strong><br>
                        ${settingsData.companyEmail}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 ${settingsData.companyName} - Tous droits r√©serv√©s</p>
        <p style="margin-top: 10px; opacity: 0.8;">${settingsData.companyActivity}</p>
    </footer>
</body>
</html>
            `;
            
            const previewWindow = window.open('', 'SitePreview', 'width=1200,height=800');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };
        
        // Annuler les modifications des param√®tres
        window.cancelSettings = () => {
            if (confirm('√ätes-vous s√ªr de vouloir annuler toutes les modifications ? Les donn√©es non enregistr√©es seront perdues.')) {
                // Recharger les param√®tres depuis Firebase
                loadSettings();
            }
        };

        // R√©initialiser les param√®tres aux valeurs par d√©faut
        window.resetSettings = async () => {
            if (confirm('‚ö†Ô∏è ATTENTION : Cette action va r√©initialiser TOUS les param√®tres aux valeurs par d√©faut. √ätes-vous s√ªr ?')) {
                try {
                    const defaultSettings = {
                        companyName: 'Sabrine SJK',
                        companyActivity: 'Th√©rapeute √ânerg√©tique',
                        companyAddress: '',
                        companyEmail: 'contact@sabrinesjk.fr',
                        companyPhone: '',
                        companySiret: '',
                        companyIban: '',
                        siteColorPrimary: '#8B5CF6',
                        siteColorSecondary: '#EC4899',
                        siteLogo: '',
                        siteSlogan: 'Votre bien-√™tre, ma priorit√©',
                        socialFacebook: '',
                        socialInstagram: '',
                        socialLinkedin: '',
                        socialWhatsapp: '',
                        workingDays: {
                            monday: true,
                            tuesday: true,
                            wednesday: true,
                            thursday: true,
                            friday: true,
                            saturday: false,
                            sunday: false
                        },
                        openingTime: '09:00',
                        closingTime: '18:00',
                        defaultSessionDuration: 60,
                        notificationEmail: '',
                        autoConfirmBookings: false,
                        colorTemplate: 'purple-pink'
                    };

                    await setDoc(doc(db, 'settings', 'company'), defaultSettings);
                    loadSettings();
                    alert('‚úÖ Param√®tres r√©initialis√©s avec succ√®s !');
                } catch (error) {
                    console.error('Erreur r√©initialisation:', error);
                    alert('‚ùå Erreur lors de la r√©initialisation des param√®tres.');
                }
            }
        };

        // ===== GESTION DES PRODUITS ET SERVICES =====
        
        // Migrer les services existants vers la base de donn√©es
        async function migrateExistingServices() {
            try {
                const existingServices = [
                    // S√©ances Intuitives
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Adulte (Pr√©sentiel)',
                        description: 'S√©ance intuitive guid√©e pour adulte en pr√©sentiel - Profonde d√©tente et r√©√©quilibrage √©nerg√©tique',
                        price: 60,
                        duration: 60,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Adulte (Distanciel)',
                        description: 'S√©ance intuitive guid√©e pour adulte √† distance',
                        price: 50,
                        duration: 60,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Enfant (Pr√©sentiel)',
                        description: 'S√©ance intuitive adapt√©e aux enfants de moins de 12 ans en pr√©sentiel',
                        price: 40,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Enfant (Distanciel)',
                        description: 'S√©ance intuitive adapt√©e aux enfants de moins de 12 ans √† distance',
                        price: 30,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Animal (Pr√©sentiel)',
                        description: 'S√©ance √©nerg√©tique pour animaux en pr√©sentiel - Dur√©e adapt√©e',
                        price: 40,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Animal (Distanciel)',
                        description: 'S√©ance √©nerg√©tique pour animaux √† distance',
                        price: 30,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    // Reiki & Lahochi
                    { 
                        type: 'service',
                        name: 'Reiki ou Lahochi',
                        description: 'S√©ance de Reiki (1h-1h15) ou Lahochi (env. 1h) - Profonde d√©tente, r√©√©quilibrage √©nerg√©tique, lib√©ration √©motionnelle',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Forfait 4 S√©ances Reiki/Lahochi',
                        description: 'Forfait 4 s√©ances de Reiki ou Lahochi √† tarif avantageux - Paiement en 3 ou 4 fois possible',
                        price: 210,
                        duration: 240,
                        category: 'soin-energetique',
                        active: true
                    },
                    // Soins √ânerg√©tiques Sp√©cialis√©s
                    { 
                        type: 'service',
                        name: 'S√©ance Sonore √ânerg√©tique',
                        description: 'Travail vibratoire sur les 7 chakras - Lib√©ration des tensions, d√©tente du syst√®me nerveux, apaisement du mental',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Magn√©tisme Cr√¢nien + Harmonisation Chakras',
                        description: 'Lib√®re la t√™te, les pens√©es lourdes, tensions nerveuses - Excellent pour migraines, anxi√©t√©, troubles du sommeil',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Micro-Massage √ânerg√©tique',
                        description: 'Micro-massage t√™te, visage, ventre, dos - Lib√®re les m√©moires √©motionnelles du corps + moment sonore en fin de s√©ance',
                        price: 60,
                        duration: 60,
                        category: 'massage',
                        active: true
                    },
                    // Accompagnements Holistiques
                    { 
                        type: 'service',
                        name: 'Accompagnement Holistique (s√©ance seule)',
                        description: 'Pour blessures √©motionnelles, anxi√©t√©, estime de soi, transg√©n√©rationnel, deuil, s√©paration - Aide √† comprendre, lib√©rer et transformer',
                        price: 60,
                        duration: 60,
                        category: 'consultation',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Holistique (Forfait 3 s√©ances)',
                        description: 'Forfait 3 s√©ances d\'accompagnement holistique profond - Paiement en 3 ou 4 fois possible',
                        price: 160,
                        duration: 180,
                        category: 'consultation',
                        active: true
                    },
                    // S√©ances Sp√©cifiques
                    { 
                        type: 'service',
                        name: 'Traitement Verrue (Forfait complet)',
                        description: 'Travail √©nerg√©tique + magn√©tisme cibl√© en 3 phases (s√©ance principale 30min + 2 renforts de 15min)',
                        price: 60,
                        duration: 60,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Op√©ration',
                        description: 'Accompagnement avant, pendant et apr√®s op√©ration - 3 s√©ances (45min + 20min + 25min) pour ancrage, calme et meilleure r√©cup√©ration',
                        price: 70,
                        duration: 90,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Chimio/Radioth√©rapie (Base)',
                        description: 'Soutien avant, pendant et apr√®s chaque cycle - 3 s√©ances (1h-1h30) - Coupeur de feu inclus - Forfait ajust√© selon nb de cycles',
                        price: 70,
                        duration: 90,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Coupeur de Feu',
                        description: 'Soulagement imm√©diat apr√®s br√ªlures, radioth√©rapie, inflammations, coups de soleil - Don libre minimum 30‚Ç¨',
                        price: 30,
                        duration: 15,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Nettoyage √ânerg√©tique de Lieux',
                        description: 'Lib√©ration des √©nergies lourdes, m√©moires, pr√©sences - Ram√®ne harmonie, paix, protection et douceur dans la maison',
                        price: 100,
                        duration: 120,
                        category: 'autre',
                        active: true
                    }
                ];

                // V√©rifier si des produits existent d√©j√†
                const productsSnap = await getDocs(collection(db, 'products'));
                
                // Si moins de 18 services, on force la migration compl√®te
                if (productsSnap.size < 18) {
                    console.log('üîÑ Migration automatique des services (' + productsSnap.size + '/18 services d√©tect√©s)...');
                    
                    // Supprimer tous les services existants
                    const deletePromises = [];
                    productsSnap.forEach(docSnap => {
                        deletePromises.push(deleteDoc(doc(db, 'products', docSnap.id)));
                    });
                    await Promise.all(deletePromises);
                    console.log('üóëÔ∏è Anciens services supprim√©s');
                    
                    // Migrer les 18 services officiels
                    for (const service of existingServices) {
                        service.createdAt = new Date().toISOString();
                        service.updatedAt = new Date().toISOString();
                        await addDoc(collection(db, 'products'), service);
                    }
                    console.log('‚úÖ 18 services migr√©s avec succ√®s');
                    return true;
                }
                console.log('‚ÑπÔ∏è 18 services d√©j√† pr√©sents');
                return false;
            } catch (error) {
                console.error('Erreur migration services:', error);
                return false;
            }
        }
        
        // Fonction pour forcer la synchronisation compl√®te des services
        window.forceSyncServices = async function() {
            if (!confirm('‚ö†Ô∏è Cela va remplacer tous les services existants par la liste officielle de 18 services. Continuer ?')) {
                return;
            }
            
            try {
                // Supprimer tous les produits existants
                const productsSnap = await getDocs(collection(db, 'products'));
                const deletePromises = [];
                productsSnap.forEach(docSnap => {
                    deletePromises.push(deleteDoc(doc(db, 'products', docSnap.id)));
                });
                await Promise.all(deletePromises);
                console.log('üóëÔ∏è Anciens services supprim√©s (' + productsSnap.size + ' services)');
                
                // D√©finir les 18 services officiels DIRECTEMENT
                const existingServices = [
                    // S√©ances Intuitives
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Adulte (Pr√©sentiel)',
                        description: 'S√©ance intuitive guid√©e pour adulte en pr√©sentiel - Profonde d√©tente et r√©√©quilibrage √©nerg√©tique',
                        price: 60,
                        duration: 60,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Adulte (Distanciel)',
                        description: 'S√©ance intuitive guid√©e pour adulte √† distance',
                        price: 50,
                        duration: 60,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Enfant (Pr√©sentiel)',
                        description: 'S√©ance intuitive adapt√©e aux enfants de moins de 12 ans en pr√©sentiel',
                        price: 40,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Enfant (Distanciel)',
                        description: 'S√©ance intuitive adapt√©e aux enfants de moins de 12 ans √† distance',
                        price: 30,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Animal (Pr√©sentiel)',
                        description: 'S√©ance √©nerg√©tique pour animaux en pr√©sentiel - Dur√©e adapt√©e',
                        price: 40,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'S√©ance Intuitive Animal (Distanciel)',
                        description: 'S√©ance √©nerg√©tique pour animaux √† distance',
                        price: 30,
                        duration: 45,
                        category: 'seance-intuitive',
                        active: true
                    },
                    // Reiki & Lahochi
                    { 
                        type: 'service',
                        name: 'Reiki ou Lahochi',
                        description: 'S√©ance de Reiki (1h-1h15) ou Lahochi (env. 1h) - Profonde d√©tente, r√©√©quilibrage √©nerg√©tique, lib√©ration √©motionnelle',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Forfait 4 S√©ances Reiki/Lahochi',
                        description: 'Forfait 4 s√©ances de Reiki ou Lahochi √† tarif avantageux - Paiement en 3 ou 4 fois possible',
                        price: 210,
                        duration: 240,
                        category: 'soin-energetique',
                        active: true
                    },
                    // Soins √ânerg√©tiques Sp√©cialis√©s
                    { 
                        type: 'service',
                        name: 'S√©ance Sonore √ânerg√©tique',
                        description: 'Travail vibratoire sur les 7 chakras - Lib√©ration des tensions, d√©tente du syst√®me nerveux, apaisement du mental',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Magn√©tisme Cr√¢nien + Harmonisation Chakras',
                        description: 'Lib√®re la t√™te, les pens√©es lourdes, tensions nerveuses - Excellent pour migraines, anxi√©t√©, troubles du sommeil',
                        price: 60,
                        duration: 60,
                        category: 'soin-energetique',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Micro-Massage √ânerg√©tique',
                        description: 'Micro-massage t√™te, visage, ventre, dos - Lib√®re les m√©moires √©motionnelles du corps + moment sonore en fin de s√©ance',
                        price: 60,
                        duration: 60,
                        category: 'massage',
                        active: true
                    },
                    // Accompagnements Holistiques
                    { 
                        type: 'service',
                        name: 'Accompagnement Holistique (s√©ance seule)',
                        description: 'Pour blessures √©motionnelles, anxi√©t√©, estime de soi, transg√©n√©rationnel, deuil, s√©paration - Aide √† comprendre, lib√©rer et transformer',
                        price: 60,
                        duration: 60,
                        category: 'consultation',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Holistique (Forfait 3 s√©ances)',
                        description: 'Forfait 3 s√©ances d\'accompagnement holistique profond - Paiement en 3 ou 4 fois possible',
                        price: 160,
                        duration: 180,
                        category: 'consultation',
                        active: true
                    },
                    // S√©ances Sp√©cifiques
                    { 
                        type: 'service',
                        name: 'Traitement Verrue (Forfait complet)',
                        description: 'Travail √©nerg√©tique + magn√©tisme cibl√© en 3 phases (s√©ance principale 30min + 2 renforts de 15min)',
                        price: 60,
                        duration: 60,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Op√©ration',
                        description: 'Accompagnement avant, pendant et apr√®s op√©ration - 3 s√©ances (45min + 20min + 25min) pour ancrage, calme et meilleure r√©cup√©ration',
                        price: 70,
                        duration: 90,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Accompagnement Chimio/Radioth√©rapie (Base)',
                        description: 'Soutien avant, pendant et apr√®s chaque cycle - 3 s√©ances (1h-1h30) - Coupeur de feu inclus - Forfait ajust√© selon nb de cycles',
                        price: 70,
                        duration: 90,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Coupeur de Feu',
                        description: 'Soulagement imm√©diat apr√®s br√ªlures, radioth√©rapie, inflammations, coups de soleil - Don libre minimum 30‚Ç¨',
                        price: 30,
                        duration: 15,
                        category: 'autre',
                        active: true
                    },
                    { 
                        type: 'service',
                        name: 'Nettoyage √ânerg√©tique de Lieux',
                        description: 'Lib√©ration des √©nergies lourdes, m√©moires, pr√©sences - Ram√®ne harmonie, paix, protection et douceur dans la maison',
                        price: 100,
                        duration: 120,
                        category: 'autre',
                        active: true
                    }
                ];
                
                // Ajouter tous les services DIRECTEMENT
                console.log('üì¶ Ajout de ' + existingServices.length + ' services...');
                let addedCount = 0;
                for (const service of existingServices) {
                    service.createdAt = new Date().toISOString();
                    service.updatedAt = new Date().toISOString();
                    await addDoc(collection(db, 'products'), service);
                    addedCount++;
                    console.log('‚úì Service ' + addedCount + '/' + existingServices.length + ' : ' + service.name);
                }
                
                console.log('‚úÖ ' + addedCount + ' services ajout√©s avec succ√®s');
                
                // Recharger l'affichage
                await loadProducts();
                
                alert('‚úÖ Synchronisation termin√©e !\n\n' + addedCount + ' services ont √©t√© charg√©s avec succ√®s.');
            } catch (error) {
                console.error('‚ùå Erreur sync services:', error);
                alert('‚ùå Erreur lors de la synchronisation : ' + error.message);
            }
        };
        
        // Charger tous les produits
        async function loadProducts() {
            try {
                // Tenter la migration automatique au premier chargement
                const migrated = await migrateExistingServices();
                
                const productsSnap = await getDocs(collection(db, 'products'));
                const container = document.getElementById('productsList');
                
                if (productsSnap.empty) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem;">
                            <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                                Aucun produit ou service enregistr√©.
                            </p>
                            <button class="btn btn-primary" onclick="migrateAndReload()">
                                <i class="fas fa-sync"></i> Charger les services par d√©faut
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '';
                const products = [];
                productsSnap.forEach(docSnap => {
                    products.push({ id: docSnap.id, ...docSnap.data() });
                });
                
                // Trier par date de cr√©ation (plus r√©cents en premier)
                products.sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });
                
                products.forEach(product => {
                    const productCard = createProductCard(product.id, product);
                    container.appendChild(productCard);
                });
                
                if (migrated) {
                    setTimeout(() => {
                        alert('‚úÖ Vos services existants ont √©t√© import√©s avec succ√®s !');
                    }, 500);
                }
            } catch (error) {
                console.error('Erreur chargement produits:', error);
                const container = document.getElementById('productsList');
                container.innerHTML = '<p style="text-align: center; color: #EF4444; padding: 3rem;">‚ùå Erreur lors du chargement des produits. Veuillez r√©essayer.</p>';
            }
        }
        
        // Fonction pour forcer la migration
        window.migrateAndReload = async () => {
            try {
                await migrateExistingServices();
                loadProducts();
            } catch (error) {
                console.error('Erreur:', error);
                alert('‚ùå Erreur lors de la migration des services');
            }
        };

        // Cr√©er une carte produit
        function createProductCard(id, product) {
            const card = document.createElement('div');
            card.className = `product-card ${product.active ? '' : 'inactive'}`;
            
            const categoryLabels = {
                'soin-energetique': 'Soin √ânerg√©tique',
                'massage': 'Massage',
                'meditation': 'M√©ditation',
                'consultation': 'Consultation',
                'formation': 'Formation',
                'accessoire': 'Accessoire',
                'autre': 'Autre'
            };
            
            card.innerHTML = `
                <div class="product-card-header">
                    <div>
                        <span class="product-badge ${product.type}">${product.type === 'service' ? 'Service' : 'Produit'}</span>
                        ${!product.active ? '<span style="color: #EF4444; font-size: 0.85rem; margin-left: 0.5rem;">‚óè Inactif</span>' : ''}
                    </div>
                </div>
                <h3>${product.name || 'Sans nom'}</h3>
                <div class="product-category">${categoryLabels[product.category] || product.category}</div>
                <div class="product-description">${product.description || 'Pas de description'}</div>
                <div class="product-info">
                    <div class="product-info-item">
                        <i class="fas fa-euro-sign"></i>
                        <span class="product-price">${parseFloat(product.price || 0).toFixed(2)} ‚Ç¨</span>
                    </div>
                    ${product.duration ? `
                    <div class="product-info-item">
                        <i class="fas fa-clock"></i>
                        <span>${product.duration} min</span>
                    </div>
                    ` : ''}
                </div>
                <div class="product-actions">
                    <button class="btn-icon btn-edit" onclick="editProduct('${id}')">
                        <i class="fas fa-edit"></i> Modifier
                    </button>
                    <button class="btn-icon btn-toggle" onclick="toggleProduct('${id}', ${!product.active})">
                        <i class="fas fa-${product.active ? 'eye-slash' : 'eye'}"></i> ${product.active ? 'D√©sactiver' : 'Activer'}
                    </button>
                    <button class="btn-icon btn-delete" onclick="deleteProduct('${id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            return card;
        }

        // Ouvrir modal produit (cr√©ation)
        window.openProductModal = () => {
            document.getElementById('productModalTitle').textContent = 'Nouveau Produit/Service';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productActive').checked = true;
            document.getElementById('productModal').style.display = 'flex';
        };

        // Fermer modal produit
        window.closeProductModal = () => {
            document.getElementById('productModal').style.display = 'none';
        };

        // √âditer un produit
        window.editProduct = async (id) => {
            try {
                const productDoc = await getDoc(doc(db, 'products', id));
                if (productDoc.exists()) {
                    const product = productDoc.data();
                    document.getElementById('productModalTitle').textContent = 'Modifier Produit/Service';
                    document.getElementById('productId').value = id;
                    document.getElementById('productType').value = product.type || 'service';
                    document.getElementById('productName').value = product.name || '';
                    document.getElementById('productDescription').value = product.description || '';
                    document.getElementById('productPrice').value = product.price || '';
                    document.getElementById('productDuration').value = product.duration || '';
                    document.getElementById('productCategory').value = product.category || 'soin-energetique';
                    document.getElementById('productImage').value = product.image || '';
                    document.getElementById('productActive').checked = product.active !== false;
                    document.getElementById('productModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Erreur chargement produit:', error);
                alert('Erreur lors du chargement du produit');
            }
        };

        // Activer/D√©sactiver un produit
        window.toggleProduct = async (id, newState) => {
            try {
                await updateDoc(doc(db, 'products', id), { active: newState });
                loadProducts();
            } catch (error) {
                console.error('Erreur toggle produit:', error);
                alert('Erreur lors de la modification du statut');
            }
        };

        // Supprimer un produit
        window.deleteProduct = async (id) => {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce produit/service ?')) {
                try {
                    await deleteDoc(doc(db, 'products', id));
                    loadProducts();
                    alert('Produit/service supprim√© avec succ√®s');
                } catch (error) {
                    console.error('Erreur suppression produit:', error);
                    alert('Erreur lors de la suppression');
                }
            }
        };

        // Pr√©visualiser un produit
        window.previewProduct = () => {
            const productData = {
                type: document.getElementById('productType').value,
                name: document.getElementById('productName').value || '[Nom du produit]',
                description: document.getElementById('productDescription').value || '[Description]',
                price: document.getElementById('productPrice').value || '0',
                duration: document.getElementById('productDuration').value,
                category: document.getElementById('productCategory').selectedOptions[0]?.text || '[Cat√©gorie]',
                image: document.getElementById('productImage').value,
                active: document.getElementById('productActive').checked
            };
            
            const previewHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: white;">
                    <h2 style="color: #8B5CF6; border-bottom: 3px solid #EC4899; padding-bottom: 10px;">
                        ${productData.type === 'service' ? 'üíÜ' : 'üì¶'} Pr√©visualisation ${productData.type === 'service' ? 'du Service' : 'du Produit'}
                    </h2>
                    
                    ${productData.image ? `<img src="${productData.image}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 12px; margin: 20px 0;" onerror="this.style.display='none'">` : ''}
                    
                    <div style="background: linear-gradient(135deg, #8B5CF6, #EC4899); color: white; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h1 style="margin: 0; font-size: 1.8em;">${productData.name}</h1>
                        <p style="margin: 5px 0 0 0; opacity: 0.9;">${productData.category}</p>
                    </div>
                    
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-top: 0;">Description</h3>
                        <p style="line-height: 1.6;">${productData.description}</p>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin: 20px 0;">
                        <div style="flex: 1; background: #e0e7ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.85rem; color: #6366F1; font-weight: 600; margin-bottom: 5px;">PRIX</div>
                            <div style="font-size: 2rem; font-weight: 700; color: #8B5CF6;">${parseFloat(productData.price).toFixed(2)} ‚Ç¨</div>
                        </div>
                        ${productData.duration ? `
                        <div style="flex: 1; background: #fef3c7; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.85rem; color: #D97706; font-weight: 600; margin-bottom: 5px;">DUR√âE</div>
                            <div style="font-size: 2rem; font-weight: 700; color: #F59E0B;">${productData.duration} min</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="text-align: center; padding: 15px; background: ${productData.active ? '#D1FAE5' : '#FEE2E2'}; border-radius: 8px; margin: 20px 0;">
                        <strong style="color: ${productData.active ? '#059669' : '#DC2626'};">
                            ${productData.active ? '‚úÖ Actif - Visible sur le site' : '‚ùå Inactif - Non visible sur le site'}
                        </strong>
                    </div>
                    
                    <p style="text-align: center; margin-top: 20px; color: #6b7280;">
                        ‚ÑπÔ∏è Ceci est une pr√©visualisation. Cliquez sur "Enregistrer" pour sauvegarder.
                    </p>
                </div>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=700,height=800');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        };

        // ===== CHARGER INFOS CONTACT =====
        async function loadContactInfo() {
            try {
                const settingsDoc = await getDoc(doc(db, 'settings', 'company'));
                if (settingsDoc.exists()) {
                    const settings = settingsDoc.data();
                    
                    // Mise √† jour des infos de contact - T√©l√©phone
                    if (settings.companyPhone) {
                        const phoneClean = settings.companyPhone.replace(/\s/g, '');
                        // Hero section
                        const heroPhone = document.getElementById('heroPhone');
                        if (heroPhone) heroPhone.textContent = settings.companyPhone;
                        
                        // Modal booking
                        const modalPhone = document.getElementById('modalPhone');
                        const modalPhoneLink = document.getElementById('modalPhoneLink');
                        if (modalPhone) modalPhone.textContent = settings.companyPhone;
                        if (modalPhoneLink) modalPhoneLink.href = `tel:${phoneClean}`;
                        
                        // Contact section
                        const contactPhone = document.getElementById('contactPhone');
                        const contactPhoneLink = document.getElementById('contactPhoneLink');
                        if (contactPhone) contactPhone.textContent = settings.companyPhone;
                        if (contactPhoneLink) contactPhoneLink.href = `tel:${phoneClean}`;
                    }
                    
                    // Mise √† jour des infos de contact - Email
                    if (settings.companyEmail) {
                        // Modal booking
                        const modalEmail = document.getElementById('modalEmail');
                        const modalEmailLink = document.getElementById('modalEmailLink');
                        if (modalEmail) modalEmail.textContent = settings.companyEmail;
                        if (modalEmailLink) modalEmailLink.href = `mailto:${settings.companyEmail}`;
                        
                        // Contact section
                        const contactEmail = document.getElementById('contactEmail');
                        const contactEmailLink = document.querySelector('.contact-card a[href^="mailto:"]');
                        if (contactEmail) contactEmail.textContent = settings.companyEmail;
                        if (contactEmailLink) contactEmailLink.href = `mailto:${settings.companyEmail}`;
                    }
                    
                    if (settings.companyAddress) {
                        document.getElementById('contactAddress').innerHTML = settings.companyAddress.replace(/\n/g, '<br>');
                    }
                    
                    // Mise √† jour des horaires
                    if (settings.openingTime && settings.closingTime) {
                        const days = [];
                        if (settings.workingDays) {
                            if (settings.workingDays.monday && settings.workingDays.friday) days.push('Lundi - Vendredi');
                            if (settings.workingDays.saturday) days.push('Samedi');
                        }
                        const daysText = days.length > 0 ? days.join(', ') : 'Lundi - Vendredi';
                        document.getElementById('contactHours').innerHTML = 
                            `${daysText}<br>${settings.openingTime} - ${settings.closingTime}`;
                    }
                    
                    // Mise √† jour des liens sociaux
                    if (settings.socialFacebook) {
                        document.getElementById('socialFacebookLink').href = settings.socialFacebook;
                        document.getElementById('socialFacebookLink').style.display = 'flex';
                    }
                    if (settings.socialInstagram) {
                        document.getElementById('socialInstagramLink').href = settings.socialInstagram;
                    }
                    if (settings.socialLinkedin) {
                        document.getElementById('socialLinkedinLink').href = settings.socialLinkedin;
                        document.getElementById('socialLinkedinLink').style.display = 'flex';
                    }
                    if (settings.socialWhatsapp) {
                        const whatsappNumber = settings.socialWhatsapp.replace(/\s/g, '');
                        document.getElementById('socialWhatsappLink').href = `https://wa.me/${whatsappNumber}`;
                        document.getElementById('socialWhatsappLink').style.display = 'flex';
                    }
                }
            } catch (error) {
                console.error('Erreur chargement infos contact:', error);
            }
        }

        // Adresse de r√©f√©rence du cabinet
        const CABINET_ADDRESS = '180 rue des mimosas, Hameau de Franquevaux, 30640 Beauvoisin, France';
        
        // Fonction pour calculer la distance entre deux adresses
        async function calculateDistance(clientAddress) {
            try {
                console.log('üîç Calcul distance pour:', clientAddress);
                
                // G√©ocodage des adresses avec Nominatim (OpenStreetMap)
                const geocodeCabinet = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(CABINET_ADDRESS)}`, {
                    headers: { 'User-Agent': 'SabrineSJK-Website' }
                });
                const cabinetData = await geocodeCabinet.json();
                console.log('üìç Cabinet trouv√©:', cabinetData.length > 0 ? 'OUI' : 'NON', cabinetData[0]?.display_name);
                
                // Petit d√©lai pour respecter les limites de Nominatim (1 req/sec)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const geocodeClient = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(clientAddress)}`, {
                    headers: { 'User-Agent': 'SabrineSJK-Website' }
                });
                const clientData = await geocodeClient.json();
                console.log('üìç Client trouv√©:', clientData.length > 0 ? 'OUI' : 'NON', clientData[0]?.display_name);
                
                if (!cabinetData.length || !clientData.length) {
                    console.warn('‚ö†Ô∏è Adresse non trouv√©e - Cabinet:', cabinetData.length, 'Client:', clientData.length);
                    throw new Error('Adresse non trouv√©e');
                }
                
                const cabinetCoords = { lat: parseFloat(cabinetData[0].lat), lon: parseFloat(cabinetData[0].lon) };
                const clientCoords = { lat: parseFloat(clientData[0].lat), lon: parseFloat(clientData[0].lon) };
                
                console.log('üó∫Ô∏è Coordonn√©es - Cabinet:', cabinetCoords, 'Client:', clientCoords);
                
                // Calcul de la distance "√† vol d'oiseau" (Haversine)
                const R = 6371; // Rayon de la Terre en km
                const dLat = (clientCoords.lat - cabinetCoords.lat) * Math.PI / 180;
                const dLon = (clientCoords.lon - cabinetCoords.lon) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                          Math.cos(cabinetCoords.lat * Math.PI / 180) * Math.cos(clientCoords.lat * Math.PI / 180) *
                          Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c;
                
                // Ajouter 30% pour approximer la distance routi√®re
                const roadDistance = distance * 1.3;
                
                console.log('‚úÖ Distance calcul√©e:', distance.toFixed(1), 'km (vol d\'oiseau)', '‚Üí', roadDistance.toFixed(1), 'km (route)');
                
                return parseFloat(roadDistance.toFixed(1));
            } catch (error) {
                console.error('‚ùå Erreur calcul distance:', error);
                return null;
            }
        }
        
        // Fonction pour g√©rer l'affichage des frais de d√©placement
        function updateTravelCost(prefix) {
            const locationSelect = document.getElementById(`${prefix}-location`);
            const addressGroup = document.getElementById(`${prefix}-address-group`);
            const addressInput = document.getElementById(`${prefix}-address`);
            const distanceInput = document.getElementById(`${prefix}-distance`);
            const travelInfo = document.getElementById(`${prefix}-travel-info`);
            const travelCost = document.getElementById(`${prefix}-travel-cost`);
            
            const location = locationSelect.value;
            
            if (location === 'domicile') {
                addressGroup.style.display = 'block';
                addressInput.required = true;
                distanceInput.required = true;
                
                // Calculer les frais quand la distance est saisie
                if (distanceInput.value && parseFloat(distanceInput.value) > 0) {
                    const km = parseFloat(distanceInput.value);
                    const cost = Math.round(km);
                    
                    travelInfo.style.display = 'block';
                    travelCost.textContent = `${cost}‚Ç¨ (${km} km aller-retour)`;
                    
                    // Stocker le co√ªt pour l'utiliser lors de la soumission
                    document.getElementById(`${prefix}-travel-cost-value`).value = cost;
                } else {
                    travelInfo.style.display = 'none';
                    document.getElementById(`${prefix}-travel-cost-value`).value = 0;
                }
            } else {
                addressGroup.style.display = 'none';
                addressInput.required = false;
                if (distanceInput) distanceInput.required = false;
                travelInfo.style.display = 'none';
                document.getElementById(`${prefix}-travel-cost-value`).value = 0;
            }
        }
        
        // Event listeners pour les formulaires
        function initializeFormListeners() {
            // Quick booking form
            const quickLocation = document.getElementById('quick-location');
            const quickDistance = document.getElementById('quick-distance');
            
            if (quickLocation) {
                quickLocation.addEventListener('change', () => updateTravelCost('quick'));
            }
            
            if (quickDistance) {
                quickDistance.addEventListener('input', () => updateTravelCost('quick'));
            }
            
            // Booking modal form
            const bookingLocation = document.getElementById('booking-location');
            const bookingDistance = document.getElementById('booking-distance');
            
            if (bookingLocation) {
                bookingLocation.addEventListener('change', () => updateTravelCost('booking'));
            }
            
            if (bookingDistance) {
                bookingDistance.addEventListener('input', () => updateTravelCost('booking'));
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Charger les publications au chargement
            loadAllPublicPosts();
            
            // Charger les infos de contact
            loadContactInfo();
            
            // Initialiser les √©couteurs pour les frais de d√©placement
            initializeFormListeners();
            
            // Compteur de caract√®res
            document.getElementById('publication-content').addEventListener('input', updateCharCount);
            
            // Remember me
            const savedEmail = localStorage.getItem('rememberedEmail');
            if (savedEmail) {
                document.getElementById('loginEmail').value = savedEmail;
                document.getElementById('rememberMe').checked = true;
            }

            // Quote form
            document.getElementById('quoteForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const items = [];
                document.querySelectorAll('.quote-item').forEach(item => {
                    items.push({
                        description: item.querySelector('.item-description').value,
                        quantity: parseFloat(item.querySelector('.item-quantity').value),
                        priceHT: parseFloat(item.querySelector('.item-price').value),
                        vat: parseFloat(item.querySelector('.item-vat').value)
                    });
                });
                
                const totalHT = items.reduce((sum, item) => sum + (item.quantity * item.priceHT), 0);
                const totalVAT = items.reduce((sum, item) => sum + (item.quantity * item.priceHT * item.vat / 100), 0);
                
                const quoteData = {
                    number: document.getElementById('quoteNumber').value,
                    date: document.getElementById('quoteDate').value,
                    validity: parseInt(document.getElementById('quoteValidity').value),
                    clientName: document.getElementById('quoteClientName').value,
                    clientEmail: document.getElementById('quoteClientEmail').value,
                    clientPhone: document.getElementById('quoteClientPhone').value,
                    clientAddress: document.getElementById('quoteClientAddress').value,
                    items: items,
                    totalHT: totalHT,
                    totalVAT: totalVAT,
                    totalTTC: totalHT + totalVAT,
                    status: document.getElementById('quoteStatus').value,
                    createdAt: new Date().toISOString()
                };
                
                try {
                    const quoteId = document.getElementById('quoteId').value;
                    if (quoteId) {
                        await setDoc(doc(db, 'quotes', quoteId), quoteData);
                        alert('‚úÖ Devis modifi√©');
                    } else {
                        await addDoc(collection(db, 'quotes'), quoteData);
                        alert('‚úÖ Devis cr√©√©');
                    }
                    closeQuoteModal();
                    loadQuotes();
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de l\'enregistrement');
                }
            });

            // Invoice form
            document.getElementById('invoiceForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const items = [];
                document.querySelectorAll('.invoice-item').forEach(item => {
                    items.push({
                        description: item.querySelector('.item-description').value,
                        quantity: parseFloat(item.querySelector('.item-quantity').value),
                        priceHT: parseFloat(item.querySelector('.item-price').value),
                        vat: parseFloat(item.querySelector('.item-vat').value)
                    });
                });
                
                const totalHT = items.reduce((sum, item) => sum + (item.quantity * item.priceHT), 0);
                const totalVAT = items.reduce((sum, item) => sum + (item.quantity * item.priceHT * item.vat / 100), 0);
                
                const invoiceData = {
                    number: document.getElementById('invoiceNumber').value,
                    date: document.getElementById('invoiceDate').value,
                    dueDate: document.getElementById('invoiceDueDate').value,
                    clientName: document.getElementById('invoiceClientName').value,
                    clientEmail: document.getElementById('invoiceClientEmail').value,
                    clientPhone: document.getElementById('invoiceClientPhone').value,
                    clientAddress: document.getElementById('invoiceClientAddress').value,
                    items: items,
                    totalHT: totalHT,
                    totalVAT: totalVAT,
                    totalTTC: totalHT + totalVAT,
                    status: document.getElementById('invoiceStatus').value,
                    createdAt: new Date().toISOString()
                };
                
                try {
                    const invoiceId = document.getElementById('invoiceId').value;
                    if (invoiceId) {
                        await setDoc(doc(db, 'invoices', invoiceId), invoiceData);
                        alert('‚úÖ Facture modifi√©e');
                    } else {
                        const docRef = await addDoc(collection(db, 'invoices'), invoiceData);
                        
                        // Cr√©er automatiquement une r√©servation correspondante
                        await createBookingFromInvoice(docRef.id, invoiceData);
                        
                        alert('‚úÖ Facture cr√©√©e et r√©servation associ√©e !');
                    }
                    closeInvoiceModal();
                    loadInvoices();
                    loadTreasury();
                    loadAdminBookings();
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de l\'enregistrement');
                }
            });

            // Product form
            document.getElementById('productForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const productData = {
                    type: document.getElementById('productType').value,
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    price: parseFloat(document.getElementById('productPrice').value) || 0,
                    duration: parseInt(document.getElementById('productDuration').value) || null,
                    category: document.getElementById('productCategory').value,
                    image: document.getElementById('productImage').value,
                    active: document.getElementById('productActive').checked,
                    updatedAt: new Date().toISOString()
                };
                
                try {
                    const productId = document.getElementById('productId').value;
                    if (productId) {
                        await setDoc(doc(db, 'products', productId), productData);
                        alert('‚úÖ Produit/service modifi√©');
                    } else {
                        productData.createdAt = new Date().toISOString();
                        await addDoc(collection(db, 'products'), productData);
                        alert('‚úÖ Produit/service cr√©√©');
                    }
                    closeProductModal();
                    loadProducts();
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de l\'enregistrement');
                }
            });

            // Expense form
            document.getElementById('expenseForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const expenseData = {
                    date: document.getElementById('expenseDate').value,
                    category: document.getElementById('expenseCategory').value,
                    description: document.getElementById('expenseDescription').value,
                    amountHT: parseFloat(document.getElementById('expenseAmountHT').value) || 0,
                    vat: parseFloat(document.getElementById('expenseVAT').value),
                    amountTTC: parseFloat(document.getElementById('expenseAmountTTC').value),
                    supplier: document.getElementById('expenseSupplier').value,
                    notes: document.getElementById('expenseNotes').value,
                    createdAt: new Date().toISOString()
                };
                
                try {
                    const expenseId = document.getElementById('expenseId').value;
                    if (expenseId) {
                        await setDoc(doc(db, 'expenses', expenseId), expenseData);
                        alert('‚úÖ D√©pense modifi√©e');
                    } else {
                        await addDoc(collection(db, 'expenses'), expenseData);
                        alert('‚úÖ D√©pense cr√©√©e');
                    }
                    closeExpenseModal();
                    loadExpenses();
                    loadTreasury();
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de l\'enregistrement');
                }
            });

            // Settings form
            document.getElementById('settingsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const settingsData = {
                    // Informations soci√©t√©
                    companyName: document.getElementById('companyName').value,
                    companyActivity: document.getElementById('companyActivity').value,
                    companyAddress: document.getElementById('companyAddress').value,
                    companyEmail: document.getElementById('companyEmail').value,
                    companyPhone: document.getElementById('companyPhone').value,
                    companySiret: document.getElementById('companySiret').value,
                    companyVat: document.getElementById('companyVat').value,
                    companyIban: document.getElementById('companyIban').value,
                    companyBic: document.getElementById('companyBic').value,
                    ownerFirstName: document.getElementById('ownerFirstName').value,
                    ownerLastName: document.getElementById('ownerLastName').value,
                    companyLegalMentions: document.getElementById('companyLegalMentions').value,
                    companyPaymentTerms: document.getElementById('companyPaymentTerms').value,
                    quoteValidityDays: parseInt(document.getElementById('quoteValidityDays').value) || 30,
                    
                    // Apparence du site
                    siteColorPrimary: document.getElementById('siteColorPrimary').value,
                    siteColorSecondary: document.getElementById('siteColorSecondary').value,
                    siteLogo: document.getElementById('siteLogo').value,
                    siteSlogan: document.getElementById('siteSlogan').value,
                    colorTemplate: document.querySelector('.color-template.active')?.dataset?.template || 'purple-pink',
                    
                    // Typographie et espacements
                    siteFontPrimary: document.getElementById('siteFontPrimary')?.value || "'Poppins', sans-serif",
                    siteFontSecondary: document.getElementById('siteFontSecondary')?.value || "'Cormorant Garamond', serif",
                    siteBaseFontSize: parseInt(document.getElementById('siteBaseFontSize')?.value) || 16,
                    siteSectionPadding: parseInt(document.getElementById('siteSectionPadding')?.value) || 80,
                    siteBorderRadius: parseInt(document.getElementById('siteBorderRadius')?.value) || 12,
                    siteShadowIntensity: document.getElementById('siteShadowIntensity')?.value || 'medium',
                    
                    // R√©seaux sociaux
                    socialFacebook: document.getElementById('socialFacebook').value,
                    socialInstagram: document.getElementById('socialInstagram').value,
                    socialLinkedin: document.getElementById('socialLinkedin').value,
                    socialWhatsapp: document.getElementById('socialWhatsapp').value,
                    
                    // Horaires
                    workingDays: {
                        monday: document.getElementById('dayMonday').checked,
                        tuesday: document.getElementById('dayTuesday').checked,
                        wednesday: document.getElementById('dayWednesday').checked,
                        thursday: document.getElementById('dayThursday').checked,
                        friday: document.getElementById('dayFriday').checked,
                        saturday: document.getElementById('daySaturday').checked,
                        sunday: document.getElementById('daySunday').checked
                    },
                    openingTime: document.getElementById('openingTime').value,
                    closingTime: document.getElementById('closingTime').value,
                    defaultSessionDuration: parseInt(document.getElementById('defaultSessionDuration').value) || 60,
                    
                    // Notifications
                    notificationEmail: document.getElementById('notificationEmail').value,
                    autoConfirmBookings: document.getElementById('autoConfirmBookings').checked,
                    
                    updatedAt: new Date().toISOString()
                };
                
                try {
                    await setDoc(doc(db, 'settings', 'company'), settingsData);
                    alert('‚úÖ Tous les param√®tres ont √©t√© enregistr√©s avec succ√®s !');
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de l\'enregistrement');
                }
            });

            // Publication form
            document.getElementById('publicationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const postId = document.getElementById('publicationId').value;
                const title = document.getElementById('publication-title').value;
                const content = document.getElementById('publication-content').value;
                const image = document.getElementById('publication-image').value;
                const tagsInput = document.getElementById('publication-tags').value;
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
                
                const postData = {
                    title,
                    content,
                    image: image || null,
                    tags,
                    updatedAt: new Date().toISOString()
                };
                
                try {
                    if (postId) {
                        // Modification
                        await setDoc(doc(db, 'publications', postId), postData, { merge: true });
                        alert('‚úÖ Publication modifi√©e avec succ√®s !');
                    } else {
                        // Cr√©ation
                        postData.createdAt = new Date().toISOString();
                        postData.author = currentUserData.name || currentUserData.email;
                        await addDoc(collection(db, 'publications'), postData);
                        alert('‚úÖ Publication cr√©√©e avec succ√®s !');
                    }
                    
                    cancelPublicationForm();
                    loadPublications();
                    loadAllPublicPosts();
                } catch (error) {
                    console.error('Erreur publication:', error);
                    alert('‚ùå Erreur lors de la publication. R√©essayez.');
                }
            });

            // Login
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const remember = document.getElementById('rememberMe').checked;

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    if (remember) localStorage.setItem('rememberedEmail', email);
                    else localStorage.removeItem('rememberedEmail');
                    
                    const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
                    if (userDoc.exists()) {
                        currentUser = userCredential.user;
                        currentUserData = userDoc.data();
                        closeLoginModal();
                        updateUIForUser(currentUserData);
                        
                        if (currentUserData.role === 'admin') showAdminDashboard();
                        else showClientSpace(email);
                    }
                } catch (error) {
                    document.getElementById('loginError').textContent = 'Email ou mot de passe incorrect';
                    document.getElementById('loginError').style.display = 'block';
                }
            });

            // Register
            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log('üìù Formulaire d\'inscription soumis');
                
                const firstName = document.getElementById('registerFirstName').value;
                const lastName = document.getElementById('registerLastName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const birthDate = document.getElementById('registerBirthDate').value;

                console.log('üìã Donn√©es:', { firstName, lastName, email, birthDate });

                try {
                    console.log('üîê Cr√©ation du compte...');
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('‚úÖ Compte cr√©√©:', userCredential.user.uid);
                    
                    console.log('üíæ Enregistrement dans Firestore...');
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        email, firstName, lastName,
                        name: `${firstName} ${lastName}`,
                        birthDate, role: 'client',
                        createdAt: new Date().toISOString()
                    });
                    console.log('‚úÖ Document cr√©√© dans Firestore');

                    currentUser = userCredential.user;
                    currentUserData = { email, name: `${firstName} ${lastName}`, role: 'client' };
                    
                    closeRegisterModal();
                    updateUIForUser(currentUserData);
                    showClientSpace(email);
                    console.log('‚úÖ Inscription termin√©e avec succ√®s');
                } catch (error) {
                    console.error('‚ùå Erreur inscription:', error);
                    const errorMsg = error.code === 'auth/email-already-in-use' 
                        ? '‚ö†Ô∏è Cet email est d√©j√† utilis√©. Connectez-vous ou utilisez un autre email.' 
                        : error.code === 'auth/weak-password'
                        ? '‚ö†Ô∏è Le mot de passe doit contenir au moins 6 caract√®res'
                        : `‚ùå Erreur: ${error.message}`;
                    document.getElementById('registerError').textContent = errorMsg;
                    document.getElementById('registerError').style.display = 'block';
                }
            });

            // Google Sign-In
            document.getElementById('btnGoogleLogin').addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    const result = await signInWithPopup(auth, provider);
                    const userDoc = await getDoc(doc(db, 'users', result.user.uid));
                    
                    if (!userDoc.exists()) {
                        const [firstName, ...lastNameParts] = (result.user.displayName || '').split(' ');
                        await setDoc(doc(db, 'users', result.user.uid), {
                            email: result.user.email,
                            firstName, lastName: lastNameParts.join(' '),
                            name: result.user.displayName,
                            role: 'client', provider: 'google',
                            createdAt: new Date().toISOString()
                        });
                    }
                    
                    currentUser = result.user;
                    currentUserData = userDoc.exists() ? userDoc.data() : { email: result.user.email, name: result.user.displayName, role: 'client' };
                    closeLoginModal();
                    updateUIForUser(currentUserData);
                    
                    if (currentUserData.role === 'admin') showAdminDashboard();
                    else showClientSpace(result.user.email);
                } catch (error) {
                    if (error.code === 'auth/unauthorized-domain') {
                        document.getElementById('loginError').textContent = 'Domaine non autoris√©. Ajoutez votre domaine dans Firebase Console.';
                    } else {
                        document.getElementById('loginError').textContent = 'Erreur de connexion Google';
                    }
                    document.getElementById('loginError').style.display = 'block';
                }
            });

            // Logout
            document.getElementById('btnLogout').addEventListener('click', async () => {
                document.getElementById('userDropdown').style.display = 'none';
                await signOut(auth);
                currentUser = null;
                currentUserData = null;
                updateUIForLogout();
            });

            // Navigation buttons
            document.getElementById('btnOpenLogin').addEventListener('click', (e) => {
                e.preventDefault();
                openLoginModal();
            });

            document.getElementById('btnShowRegisterModal').addEventListener('click', (e) => {
                e.preventDefault();
                closeLoginModal();
                openRegisterModal();
            });

            document.getElementById('btnShowLoginFromRegister').addEventListener('click', (e) => {
                e.preventDefault();
                closeRegisterModal();
                openLoginModal();
            });

            document.getElementById('btnGoToClientSpace').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('userDropdown').style.display = 'none';
                showClientSpace(currentUser.email);
            });

            document.getElementById('btnGoToAdminSpace').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('userDropdown').style.display = 'none';
                showAdminDashboard();
            });

            // User dropdown toggle
            document.getElementById('btnUserMenu').addEventListener('click', (e) => {
                e.preventDefault();
                const dropdown = document.getElementById('userDropdown');
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            });

            // Auth state
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        currentUser = user;
                        currentUserData = userDoc.data();
                        updateUIForUser(currentUserData);
                        prefillForms();
                    }
                } else {
                    updateUIForLogout();
                }
            });

            // Note: La soumission du formulaire bookingForm est maintenant g√©r√©e via le r√©capitulatif
            // Le bouton ouvre le modal de r√©capitulatif au lieu de soumettre directement

            // Quick booking form (section reservation)
            document.getElementById('quickBookingForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const firstName = document.getElementById('quick-firstname').value;
                const lastName = document.getElementById('quick-lastname').value;
                const serviceName = document.getElementById('quick-service').options[document.getElementById('quick-service').selectedIndex].text;
                const location = document.getElementById('quick-location').value;
                const address = document.getElementById('quick-address').value;
                
                // Construire les notes avec les infos de d√©placement
                let notes = document.getElementById('quick-message').value;
                if (location === 'domicile' && address) {
                    const travelCostText = document.getElementById('quick-travel-cost').textContent;
                    notes += `\n\nüìç S√©ance √† domicile\nAdresse: ${address}\n${travelCostText}`;
                } else if (location === 'cabinet') {
                    notes += '\n\nüìç S√©ance au cabinet (180 rue des mimosas, Beauvoisin)';
                } else if (location === 'distance') {
                    notes += '\n\nüìç S√©ance √† distance (visio/t√©l√©phone)';
                }
                
                const bookingData = {
                    clientName: `${firstName} ${lastName}`,
                    clientEmail: document.getElementById('quick-email').value,
                    phone: document.getElementById('quick-phone').value,
                    date: document.getElementById('quick-date').value,
                    time: document.getElementById('quick-time').value,
                    serviceName: serviceName,
                    location: location,
                    address: address || '',
                    notes: notes,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                try {
                    await addDoc(collection(db, 'bookings'), bookingData);
                    alert('‚úÖ Demande de r√©servation envoy√©e ! Vous recevrez une confirmation par email.');
                    document.getElementById('quickBookingForm').reset();
                    document.getElementById('quick-address-group').style.display = 'none';
                    document.getElementById('quick-travel-info').style.display = 'none';
                } catch (error) {
                    console.error('Erreur r√©servation:', error);
                    alert('‚ùå Erreur lors de la r√©servation. R√©essayez ou contactez-nous directement.');
                }
            });

            // Client quick booking form (espace client)
            document.getElementById('clientQuickBookingForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const firstName = document.getElementById('client-quick-firstname').value;
                const lastName = document.getElementById('client-quick-lastname').value;
                const serviceName = document.getElementById('client-quick-service').options[document.getElementById('client-quick-service').selectedIndex].text;
                
                const bookingData = {
                    clientName: `${firstName} ${lastName}`,
                    clientEmail: document.getElementById('client-quick-email').value,
                    phone: document.getElementById('client-quick-phone').value,
                    date: document.getElementById('client-quick-date').value,
                    time: document.getElementById('client-quick-time').value,
                    serviceName: serviceName,
                    notes: document.getElementById('client-quick-message').value,
                    status: 'pending',
                    userId: currentUser ? currentUser.uid : null,
                    createdAt: new Date().toISOString()
                };

                try {
                    await addDoc(collection(db, 'bookings'), bookingData);
                    alert('‚úÖ Demande de r√©servation envoy√©e ! Vous recevrez une confirmation par email.');
                    document.getElementById('clientQuickBookingForm').reset();
                    // Revenir √† l'onglet "Mes R√©servations"
                    switchClientTab('bookings');
                    // Recharger les donn√©es
                    if (currentUser) {
                        await loadClientData(currentUser.email);
                    }
                } catch (error) {
                    console.error('Erreur r√©servation:', error);
                    alert('‚ùå Erreur lors de la r√©servation. R√©essayez ou contactez-nous directement.');
                }
            });

            // Pr√©-remplir les formulaires si connect√©
            function prefillForms() {
                if (currentUserData) {
                    // Quick booking form (public)
                    if (document.getElementById('quick-firstname')) {
                        document.getElementById('quick-firstname').value = currentUserData.firstName || '';
                        document.getElementById('quick-lastname').value = currentUserData.lastName || '';
                        document.getElementById('quick-email').value = currentUserData.email || '';
                    }
                    // Client quick booking form
                    if (document.getElementById('client-quick-firstname')) {
                        document.getElementById('client-quick-firstname').value = currentUserData.firstName || '';
                        document.getElementById('client-quick-lastname').value = currentUserData.lastName || '';
                        document.getElementById('client-quick-email').value = currentUserData.email || '';
                    }
                }
            }

            // Calendar public
            const calendarEl = document.getElementById('calendar');
            if (calendarEl && typeof FullCalendar !== 'undefined') {
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'fr',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth'
                    },
                    buttonText: { today: "Aujourd'hui" },
                    firstDay: 1,
                    dateClick: (info) => {
                        document.getElementById('quick-date').value = info.dateStr;
                        document.querySelector('.booking-form-container').scrollIntoView({ behavior: 'smooth' });
                    }
                });
                calendar.render();
            }

            // Calendar client (espace client)
            let clientCalendar = null;
            function initClientCalendar() {
                const calendarClientEl = document.getElementById('calendarClient');
                if (calendarClientEl && typeof FullCalendar !== 'undefined' && !clientCalendar) {
                    clientCalendar = new FullCalendar.Calendar(calendarClientEl, {
                        initialView: 'dayGridMonth',
                        locale: 'fr',
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth'
                        },
                        buttonText: { today: "Aujourd'hui" },
                        firstDay: 1,
                        dateClick: (info) => {
                            document.getElementById('client-quick-date').value = info.dateStr;
                            document.querySelector('.booking-form-container').scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                    clientCalendar.render();
                }
            }

            // Smooth scroll
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href !== '#') {
                        e.preventDefault();
                        document.querySelector(href)?.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Synchronisation des color pickers avec les champs texte
            const colorPrimary = document.getElementById('siteColorPrimary');
            const colorPrimaryText = document.getElementById('siteColorPrimaryText');
            const colorSecondary = document.getElementById('siteColorSecondary');
            const colorSecondaryText = document.getElementById('siteColorSecondaryText');

            if (colorPrimary && colorPrimaryText) {
                colorPrimary.addEventListener('input', (e) => {
                    colorPrimaryText.value = e.target.value;
                });
                colorPrimaryText.addEventListener('input', (e) => {
                    if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                        colorPrimary.value = e.target.value;
                    }
                });
            }

            if (colorSecondary && colorSecondaryText) {
                colorSecondary.addEventListener('input', (e) => {
                    colorSecondaryText.value = e.target.value;
                });
                colorSecondaryText.addEventListener('input', (e) => {
                    if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                        colorSecondary.value = e.target.value;
                    }
                });
            }
        });
    </script>
</body>
</html>
